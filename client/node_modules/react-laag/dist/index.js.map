{"version":3,"file":"index.js","sources":["../src/ToggleLayer/useEvent.tsx","../src/ToggleLayer/useOutsideClick.tsx","../src/ToggleLayer/useOnScroll.tsx","../src/ToggleLayer/useOnWindowResize.tsx","../src/ToggleLayer/useIsomorphicLayoutEffect.tsx","../src/ToggleLayer/useTrackElementResize.tsx","../src/ToggleLayer/util.tsx","../src/ToggleLayer/useStyleState.tsx","../src/ToggleLayer/anchor.tsx","../src/ToggleLayer/style/getAbsolutePositions.tsx","../src/ToggleLayer/rect/getLayerRectByAnchor.tsx","../src/ToggleLayer/rect/index.tsx","../src/ToggleLayer/style/getSuitableAnchor.tsx","../src/ToggleLayer/style/getSecondaryOffset.tsx","../src/ToggleLayer/style/getArrowStyle.tsx","../src/ToggleLayer/style/index.tsx","../src/ToggleLayer/getPositioning.tsx","../src/ToggleLayer/useElementRef.tsx","../src/ToggleLayer/findScrollContainers.tsx","../src/ToggleLayer/useElementState.tsx","../src/ToggleLayer/useIsOpen.tsx","../src/ToggleLayer/ToggleLayer.tsx","../src/ToggleLayer/Arrow.tsx","../src/ToggleLayer/useToggleLayer.tsx","../src/useHover.tsx","../src/useBreakpoint.tsx","../src/Transition.tsx","../src/useTooltip.tsx"],"sourcesContent":["import * as React from \"react\";\n\ntype EventListenable = {\n  addEventListener: any;\n  removeEventListener: any;\n};\n\nexport default function useEvent<T extends EventListener>(\n  element: EventListenable | EventListenable[] | null,\n  event: string | string[],\n  callback: T,\n  enabled = true,\n  capture = false\n) {\n  return React.useEffect(() => {\n    if (!enabled || !element) {\n      return;\n    }\n\n    const cb = callback;\n\n    const el = Array.isArray(element) ? element : [element];\n    const ev = Array.isArray(event) ? event : [event];\n\n    el.forEach(e => {\n      ev.forEach(event => {\n        e.addEventListener(event as any, cb, capture);\n      });\n    });\n\n    return () => {\n      el.forEach(e => {\n        ev.forEach(event => {\n          e.removeEventListener(event as any, cb, capture);\n        });\n      });\n    };\n  }, [callback, element, enabled, event, capture]);\n}\n","import React from \"react\";\n\nimport useEvent from \"./useEvent\";\n\nexport const OutsideClickContext = React.createContext({} as (\n  layer: React.RefObject<HTMLElement | null | undefined>\n) => void);\n\nfunction isChildOf(parent: HTMLElement, target: HTMLElement) {\n  if (parent === target) {\n    return true;\n  }\n\n  const hasChildren = parent.children && parent.children.length > 0;\n\n  if (hasChildren) {\n    // tslint:disable-next-line\n    for (let i = 0; i < parent.children.length; i++) {\n      const child = parent.children[i];\n      if (child && isChildOf(child as HTMLElement, target)) {\n        return true;\n      }\n    }\n  }\n\n  return false;\n}\n\ntype OutsideClickGroupProviderProps = {\n  refs: React.MutableRefObject<\n    Set<React.RefObject<HTMLElement | null | undefined>>\n  >;\n  children: any;\n};\n\nexport function OutsideClickGroupProvider({\n  refs,\n  children\n}: OutsideClickGroupProviderProps) {\n  const isPartOfGroup =\n    typeof React.useContext(OutsideClickContext) === \"function\";\n\n  if (isPartOfGroup) {\n    return children;\n  }\n\n  return (\n    <OutsideClickContext.Provider\n      value={React.useCallback(layerRef => {\n        refs.current.add(layerRef);\n      }, [])}\n    >\n      {children}\n    </OutsideClickContext.Provider>\n  );\n}\n\nfunction useRegisterGroup(\n  refs: React.MutableRefObject<\n    Set<React.RefObject<HTMLElement | null | undefined>>\n  >\n) {\n  const registerRefToGroup = React.useContext(OutsideClickContext);\n\n  React.useEffect(() => {\n    const [layerRef] = refs.current.values();\n\n    if (typeof registerRefToGroup === \"function\" && layerRef) {\n      registerRefToGroup(layerRef);\n    }\n  }, [registerRefToGroup, refs]);\n}\n\nfunction useOutsideClick(\n  refs: React.MutableRefObject<\n    Set<React.RefObject<HTMLElement | null | undefined>>\n  >,\n  callback: () => void\n) {\n  const [events] = React.useState([\"click\"]);\n\n  useRegisterGroup(refs);\n\n  useEvent(\n    typeof document !== \"undefined\" ? document : null,\n    events,\n    React.useCallback(\n      (evt: any) => {\n        for (const ref of refs.current) {\n          if (!ref.current) {\n            continue;\n          }\n\n          if (isChildOf(ref.current, evt.target as HTMLElement)) {\n            return;\n          }\n        }\n\n        callback();\n      },\n      [callback]\n    ),\n    true,\n\n    true\n  );\n}\n\nexport default useOutsideClick;\n","import * as React from \"react\";\n\nimport useEvent from \"./useEvent\";\n\nfunction useOnScroll(\n  elements: HTMLElement[],\n  onScroll: (event: Event) => void,\n  environment?: Window,\n  trackScroll = true\n) {\n  const memoElements = React.useMemo(\n    () =>\n      typeof environment !== \"undefined\" ? [environment, ...elements] : [],\n    [elements]\n  );\n  useEvent(memoElements, \"scroll\", onScroll, trackScroll);\n}\n\nexport default useOnScroll;\n","import useEvent from \"./useEvent\";\n\nfunction useOnWindowResize(\n  onResize: (event: Event) => void,\n  environment?: Window,\n  trackResize = true\n) {\n  useEvent(\n    typeof environment !== \"undefined\" ? environment : null,\n    \"resize\",\n    onResize,\n    trackResize\n  );\n}\n\nexport default useOnWindowResize;\n","import * as React from \"react\";\nconst useIsomorphicLayoutEffect =\n  typeof window !== \"undefined\" ? React.useLayoutEffect : React.useEffect;\n\nexport default useIsomorphicLayoutEffect;\n","import * as React from \"react\";\nimport useIsomorphicLayoutEffect from \"./useIsomorphicLayoutEffect\";\n\nexport default function useTrackElementResize(\n  injectedResizeObserver: any,\n  layerRef: React.RefObject<HTMLElement>,\n  triggerElement: HTMLElement | null,\n  isOpen: boolean,\n  callback: () => void,\n  environment?: Window\n) {\n  const callbackRef = React.useRef(callback);\n  callbackRef.current = callback;\n\n  const ResizeObserver =\n    injectedResizeObserver ||\n    (typeof environment === \"undefined\"\n      ? class ResizeObserver {}\n      : (environment as any).ResizeObserver);\n\n  if (!ResizeObserver) {\n    throw new Error(\n      \"This browser does not support `ResizeObserver` out of the box. Please provide a polyfill as a prop.\"\n    );\n  }\n\n  const resizeObserver = React.useRef(\n    new ResizeObserver(() => {\n      if (layerRef.current) {\n        callbackRef.current();\n      }\n    })\n  );\n\n  useIsomorphicLayoutEffect(() => {\n    if (isOpen) {\n      if (triggerElement) {\n        resizeObserver.current.observe(triggerElement);\n      }\n    } else {\n      if (triggerElement) {\n        resizeObserver.current.unobserve(triggerElement);\n      }\n      if (layerRef.current) {\n        resizeObserver.current.unobserve(layerRef.current);\n      }\n    }\n  }, [isOpen, triggerElement]);\n\n  React.useEffect(() => {\n    return () => {\n      resizeObserver.current.disconnect();\n    };\n  }, []);\n\n  return resizeObserver.current;\n}\n","import { ResultingStyles } from \"./types\";\n\nexport const EMPTY_STYLE: React.CSSProperties = {};\n\nexport function isSet<T>(value: T) {\n  return value !== undefined && value !== null;\n}\n\nfunction areStylesTheSame(a: React.CSSProperties, b: React.CSSProperties) {\n  const aKeys = Object.keys(a);\n  const bKeys = Object.keys(b);\n\n  if (aKeys.length !== bKeys.length) {\n    return false;\n  }\n\n  for (let i = 0; i < Math.max(aKeys.length, bKeys.length); i++) {\n    const key: keyof React.CSSProperties = aKeys[i] || (bKeys[i] as any);\n\n    if (a[key] !== b[key]) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nexport function shouldUpdateStyles(\n  prev: ResultingStyles,\n  next: ResultingStyles\n) {\n  if (\n    areStylesTheSame(prev.layer, next.layer) &&\n    areStylesTheSame(prev.arrow, next.arrow)\n  ) {\n    return false;\n  }\n\n  return true;\n}\n\n// creates a ClientRect-like object from the viewport's dimensions\nexport function getWindowClientRect(environment?: Window): ClientRect {\n  return {\n    top: 0,\n    left: 0,\n    right: environment ? environment.innerWidth : 0,\n    bottom: environment ? environment.innerHeight : 0,\n    height: environment ? environment.innerHeight : 0,\n    width: environment ? environment.innerWidth : 0\n  };\n}\n\nconst convertFloat = (value: string) => parseFloat(value.replace(\"px\", \"\"));\n\n// get the outer width / height of an element\n// We effectively want the same width / height that `getBoundingClientRect()`\n// gives, minus optional `scale` transforms\nexport function getContentBox(element: HTMLElement, environment?: Window) {\n  if (!environment) {\n    return { width: 0, height: 0 };\n  }\n\n  const {\n    width,\n    height,\n    boxSizing,\n    borderLeft,\n    borderRight,\n    borderTop,\n    borderBottom,\n    paddingLeft,\n    paddingRight,\n    paddingTop,\n    paddingBottom\n  } = environment.getComputedStyle(element);\n\n  return {\n    width:\n      boxSizing === \"border-box\"\n        ? convertFloat(width!)\n        : [width, borderLeft, borderRight, paddingLeft, paddingRight].reduce(\n            (total, value) => total + (value ? convertFloat(value!) : 0),\n            0\n          ),\n    height:\n      boxSizing === \"border-box\"\n        ? convertFloat(height!)\n        : [height, borderTop, borderBottom, paddingTop, paddingBottom].reduce(\n            (total, value) => total + (value ? convertFloat(value!) : 0),\n            0\n          )\n  };\n}\n\n// converts a ClientRect (or DOMRect) to a plain js-object\n// usefull for destructuring for instance\nexport function clientRectToObject(clientRect: ClientRect): ClientRect {\n  return {\n    top: clientRect.top,\n    left: clientRect.left,\n    right: clientRect.right,\n    bottom: clientRect.bottom,\n    width: clientRect.width,\n    height: clientRect.height\n  };\n}\n\nexport function getElementFromAnchorNode(anchorNode: Node): HTMLElement | null {\n  let currentElement = anchorNode as HTMLElement;\n\n  while (!currentElement.getBoundingClientRect) {\n    if (!currentElement.parentElement) {\n      return null;\n    }\n\n    currentElement = currentElement.parentElement;\n  }\n\n  return currentElement;\n}\n\nexport function minMax(\n  value: number,\n  { min, max }: { min: number; max: number }\n): number {\n  return value < min ? min : value > max ? max : value;\n}\n","import * as React from \"react\";\n\nimport { AnchorEnum, ResultingStyles, LayerSide } from \"./types\";\nimport { EMPTY_STYLE } from \"./util\";\n\nexport default function useStyleState(anchor: AnchorEnum) {\n  const [INITIAL_STYLES] = React.useState<ResultingStyles>({\n    layer: EMPTY_STYLE,\n    arrow: EMPTY_STYLE,\n    layerSide: anchor.split(\"_\")[0].toLowerCase() as LayerSide\n  });\n\n  const [styles, setStyles] = React.useState<ResultingStyles>(INITIAL_STYLES);\n  const lastStyles = React.useRef<ResultingStyles>(styles);\n\n  return {\n    styles,\n    lastStyles,\n    setStyles,\n    resetLastStyles: () => {\n      lastStyles.current = INITIAL_STYLES;\n    }\n  };\n}\n","import {\n  AnchorEnum,\n  Direction,\n  Primary,\n  Side,\n  LayerSide,\n  Rects\n} from \"./types\";\n\nexport const Anchor: Record<Exclude<AnchorEnum, \"CENTER\">, AnchorEnum> = {\n  BOTTOM_LEFT: \"BOTTOM_LEFT\",\n  BOTTOM_RIGHT: \"BOTTOM_RIGHT\",\n  BOTTOM_CENTER: \"BOTTOM_CENTER\",\n  TOP_LEFT: \"TOP_LEFT\",\n  TOP_CENTER: \"TOP_CENTER\",\n  TOP_RIGHT: \"TOP_RIGHT\",\n  LEFT_BOTTOM: \"LEFT_BOTTOM\",\n  LEFT_CENTER: \"LEFT_CENTER\",\n  LEFT_TOP: \"LEFT_TOP\",\n  RIGHT_BOTTOM: \"RIGHT_BOTTOM\",\n  RIGHT_CENTER: \"RIGHT_CENTER\",\n  RIGHT_TOP: \"RIGHT_TOP\"\n};\n\nexport const POSSIBLE_ANCHORS = Object.keys(Anchor) as AnchorEnum[];\n\nexport const PRIMARY_OPPOSITES: Record<Primary, Primary> = {\n  TOP: \"BOTTOM\",\n  BOTTOM: \"TOP\",\n  LEFT: \"RIGHT\",\n  RIGHT: \"LEFT\"\n};\n\nexport function getPrimaryDirection(anchor: AnchorEnum): Direction {\n  return anchor.startsWith(\"TOP_\") || anchor.startsWith(\"BOTTOM_\") ? \"Y\" : \"X\";\n}\n\nfunction primaryIsY(primary: Primary) {\n  return primary === \"TOP\" || primary === \"BOTTOM\";\n}\n\nfunction getPrimaryByIndex(\n  index: number,\n  preferedPrimary: Primary,\n  preferedX: \"LEFT\" | \"RIGHT\",\n  preferedY: \"TOP\" | \"BOTTOM\"\n): Primary {\n  const prefferedIsY = primaryIsY(preferedPrimary);\n\n  if (index < 3) {\n    return preferedPrimary;\n  }\n  if (index < 6) {\n    return prefferedIsY ? preferedX : preferedY;\n  }\n  if (index < 9) {\n    if (prefferedIsY) {\n      return [\"LEFT\", \"RIGHT\"].filter(x => x !== preferedX)[0] as Primary;\n    } else {\n      return [\"TOP\", \"BOTTOM\"].filter(x => x !== preferedY)[0] as Primary;\n    }\n  }\n\n  if (prefferedIsY) {\n    return [\"TOP\", \"BOTTOM\"].filter(x => x !== preferedPrimary)[0] as Primary;\n  } else {\n    return [\"LEFT\", \"RIGHT\"].filter(x => x !== preferedPrimary)[0] as Primary;\n  }\n}\n\nfunction getSecondaryByIndex(\n  index: number,\n  preferedPrimary: Primary,\n  preferedSecondary: Side,\n  rects: Rects\n): Side {\n  const prefferedIsY = primaryIsY(preferedPrimary);\n\n  const triggerHasBiggerHeight = rects.trigger.height > rects.layer.height;\n  const triggerHasBiggerWidth = rects.trigger.width > rects.layer.width;\n\n  switch (index) {\n    case 9:\n    case 0:\n      return preferedSecondary;\n\n    case 1:\n    case 10: {\n      if (preferedSecondary === \"CENTER\") {\n        return prefferedIsY ? \"RIGHT\" : \"BOTTOM\";\n      }\n\n      return \"CENTER\";\n    }\n\n    case 4:\n    case 7:\n      return \"CENTER\";\n\n    case 2:\n    case 11: {\n      if (prefferedIsY) {\n        return [\"LEFT\", \"RIGHT\"].filter(\n          x => x !== preferedSecondary\n        )[0] as Side;\n      } else {\n        return [\"TOP\", \"BOTTOM\"].filter(\n          x => x !== preferedSecondary\n        )[0] as Side;\n      }\n    }\n\n    case 3:\n    case 6: {\n      if (prefferedIsY) {\n        return preferedPrimary === \"BOTTOM\"\n          ? triggerHasBiggerHeight\n            ? \"BOTTOM\"\n            : \"TOP\"\n          : triggerHasBiggerHeight\n          ? \"TOP\"\n          : \"BOTTOM\";\n      }\n\n      return preferedPrimary === \"LEFT\"\n        ? triggerHasBiggerWidth\n          ? \"LEFT\"\n          : \"RIGHT\"\n        : triggerHasBiggerWidth\n        ? \"RIGHT\"\n        : \"LEFT\";\n    }\n\n    case 5:\n    case 8: {\n      if (prefferedIsY) {\n        return preferedPrimary === \"BOTTOM\"\n          ? triggerHasBiggerHeight\n            ? \"TOP\"\n            : \"BOTTOM\"\n          : triggerHasBiggerHeight\n          ? \"BOTTOM\"\n          : \"TOP\";\n      }\n\n      return preferedPrimary === \"LEFT\"\n        ? triggerHasBiggerWidth\n          ? \"RIGHT\"\n          : \"LEFT\"\n        : triggerHasBiggerWidth\n        ? \"LEFT\"\n        : \"RIGHT\";\n    }\n  }\n\n  /* istanbul ignore next */\n  return \"LEFT\";\n}\n\nexport function getSecondaryAnchorOptionsByPrimary(\n  primary: Primary,\n  anchorOptions: AnchorEnum[]\n) {\n  return anchorOptions.filter(anchor => anchor.startsWith(primary));\n}\n\ntype SplitAnchor = {\n  primary: Primary;\n  secondary: Side;\n};\n\nexport function splitAnchor(anchor: AnchorEnum): SplitAnchor {\n  const [primary, secondary] = anchor.split(\"_\") as [Primary, Side];\n\n  return { primary, secondary };\n}\n\nexport function getLayerSideByAnchor(anchor: AnchorEnum): LayerSide {\n  if (anchor === \"CENTER\") {\n    return \"center\";\n  }\n\n  return splitAnchor(anchor).primary.toLowerCase() as LayerSide;\n}\n\nexport function getAnchorPriority(\n  preferedAnchor: AnchorEnum,\n  possibleAnchors: AnchorEnum[],\n  preferedX: \"LEFT\" | \"RIGHT\",\n  preferedY: \"TOP\" | \"BOTTOM\",\n  rects: Rects\n) {\n  const { primary, secondary } =\n    preferedAnchor !== \"CENTER\"\n      ? splitAnchor(preferedAnchor)\n      : {\n          primary: preferedY as Primary,\n          secondary: \"CENTER\" as Side\n        };\n\n  let anchors = POSSIBLE_ANCHORS.map((_, index) => {\n    return `${getPrimaryByIndex(\n      index,\n      primary,\n      preferedX,\n      preferedY\n    )}_${getSecondaryByIndex(index, primary, secondary, rects)}` as AnchorEnum;\n  }).filter(anchor => possibleAnchors.indexOf(anchor) > -1);\n\n  // include prefered anchor if not included in possibleAnchors\n  if (anchors.indexOf(preferedAnchor) === -1) {\n    /* istanbul ignore next */\n    anchors = [preferedAnchor, ...anchors];\n  }\n\n  return anchors;\n}\n","import { Rects, Primary, Side, Direction, AnchorEnum } from \"../types\";\nimport { minMax } from \"../util\";\n\nimport { splitAnchor, getPrimaryDirection } from \"../anchor\";\n\ntype Scroll = { top: number; left: number };\n\nfunction getPrimaryStyle(\n  primary: Primary,\n  rects: Rects,\n  scroll: Scroll,\n  triggerOffset: number\n) {\n  const prop = primary === \"TOP\" || primary === \"BOTTOM\" ? \"top\" : \"left\";\n  const size = primary === \"TOP\" || primary === \"BOTTOM\" ? \"height\" : \"width\";\n\n  if (primary === \"TOP\" || primary === \"LEFT\") {\n    return {\n      [prop]:\n        rects.trigger[prop] -\n        rects.layer[size] -\n        (rects.relativeParent[prop] - scroll[prop]) -\n        triggerOffset\n    };\n  }\n\n  return {\n    [prop]:\n      rects.trigger[prop] +\n      rects.trigger[size] -\n      (rects.relativeParent[prop] - scroll[prop]) +\n      triggerOffset\n  };\n}\n\nfunction getCenter(\n  rects: Rects,\n  scroll: Scroll,\n  offsetSecondary: number,\n  prop: \"top\" | \"left\",\n  size: \"width\" | \"height\"\n) {\n  return minMax(\n    rects.trigger[prop] -\n      rects.relativeParent[prop] +\n      scroll[prop] +\n      rects.trigger[size] / 2 -\n      rects.layer[size] / 2 -\n      offsetSecondary,\n    getLimits(rects, scroll)[prop]\n  );\n}\n\nfunction getLimits(rects: Rects, scroll: Scroll) {\n  const topBase = rects.trigger.top - rects.relativeParent.top + scroll.top;\n  const leftBase = rects.trigger.left - rects.relativeParent.left + scroll.left;\n\n  return {\n    top: {\n      min: topBase - (rects.layer.height - rects.arrow.height),\n      max: topBase + (rects.trigger.height - rects.arrow.height)\n    },\n    left: {\n      min: leftBase - (rects.layer.width - rects.arrow.width),\n      max: leftBase + (rects.trigger.width - rects.arrow.width)\n    }\n  };\n}\n\nfunction getSecondaryStyle(\n  secondary: Side,\n  rects: Rects,\n  scroll: Scroll,\n  offsetSecondary: number,\n  primaryDirection: Direction\n) {\n  if (secondary === \"CENTER\") {\n    const prop = primaryDirection === \"X\" ? \"top\" : \"left\";\n    const size = primaryDirection === \"X\" ? \"height\" : \"width\";\n\n    return {\n      [prop]: getCenter(rects, scroll, offsetSecondary, prop, size)\n    };\n  }\n\n  const prop = secondary === \"TOP\" || secondary === \"BOTTOM\" ? \"top\" : \"left\";\n  const size =\n    secondary === \"TOP\" || secondary === \"BOTTOM\" ? \"height\" : \"width\";\n\n  if (secondary === \"TOP\" || secondary === \"LEFT\") {\n    return {\n      [prop]: minMax(\n        rects.trigger[prop] -\n          rects.relativeParent[prop] +\n          scroll[prop] +\n          offsetSecondary,\n        getLimits(rects, scroll)[prop]\n      )\n    };\n  }\n\n  return {\n    [prop]: minMax(\n      rects.trigger[prop] +\n        rects.trigger[size] -\n        rects.layer[size] -\n        (rects.relativeParent[prop] - scroll[prop]) -\n        offsetSecondary,\n      getLimits(rects, scroll)[prop]\n    )\n  };\n}\n\ntype GetAbsolutePositionsArgs = {\n  anchor: AnchorEnum;\n  rects: Rects;\n  scrollTop: number;\n  scrollLeft: number;\n  triggerOffset: number;\n  offsetSecondary: number;\n};\n\nexport default function getAbsolutePositions({\n  anchor,\n  rects,\n  triggerOffset,\n  offsetSecondary,\n  scrollLeft,\n  scrollTop\n}: GetAbsolutePositionsArgs) {\n  const scroll: Scroll = { left: scrollLeft, top: scrollTop };\n\n  if (anchor === \"CENTER\") {\n    return {\n      top: getCenter(rects, scroll, 0, \"top\", \"height\"),\n      left: getCenter(rects, scroll, 0, \"left\", \"width\")\n    };\n  }\n\n  const { primary, secondary } = splitAnchor(anchor);\n  const primaryDirection = getPrimaryDirection(anchor);\n\n  return {\n    ...getPrimaryStyle(primary, rects, scroll, triggerOffset),\n    ...getSecondaryStyle(\n      secondary,\n      rects,\n      scroll,\n      offsetSecondary,\n      primaryDirection\n    )\n  } as React.CSSProperties;\n}\n","import {\n  Direction,\n  Primary,\n  Side,\n  AnchorEnum,\n  LayerDimensions\n} from \"../types\";\n\nimport {\n  splitAnchor,\n  getPrimaryDirection,\n  getLayerSideByAnchor\n} from \"../anchor\";\n\nimport { clientRectToObject } from \"../util\";\n\n// if user provided `layerDimensions` to the `placement` prop,\n// anticipate the width / height based on the current anchor\nfunction fixLayerDimensions(\n  originalLayer: ClientRect,\n  anchor: AnchorEnum,\n  layerDimensions: LayerDimensions\n): ClientRect {\n  const dimensions =\n    typeof layerDimensions === \"function\"\n      ? layerDimensions(getLayerSideByAnchor(anchor))\n      : layerDimensions;\n\n  return {\n    ...clientRectToObject(originalLayer),\n    ...dimensions\n  };\n}\n\nconst propMap = {\n  TOP: { side1: \"bottom\", side2: \"top\", size: \"height\", factor: -1 },\n  BOTTOM: { side1: \"top\", side2: \"bottom\", size: \"height\", factor: 1 },\n  LEFT: { side1: \"right\", side2: \"left\", size: \"width\", factor: -1 },\n  RIGHT: { side1: \"left\", side2: \"right\", size: \"width\", factor: 1 }\n};\n\nfunction getPrimaryRect(\n  primary: Primary,\n  trigger: ClientRect,\n  layer: ClientRect,\n  triggerOffset: number\n) {\n  const { side1, side2, size, factor } = propMap[primary];\n\n  const value = trigger[side2] + triggerOffset * factor;\n\n  return {\n    [side1]: value,\n    [side2]: value + layer[size] * factor\n  };\n}\n\nfunction getCenter(\n  trigger: ClientRect,\n  layer: ClientRect,\n  offsetSecondary: number,\n  prop: \"top\" | \"left\",\n  size: \"width\" | \"height\"\n) {\n  const value =\n    trigger[prop] + trigger[size] / 2 - layer[size] / 2 - offsetSecondary;\n\n  return {\n    [prop]: value,\n    [prop === \"left\" ? \"right\" : \"bottom\"]: value + layer[size]\n  };\n}\n\nfunction getSecondaryRect(\n  secondary: Side,\n  trigger: ClientRect,\n  layer: ClientRect,\n  offsetSecondary: number,\n  primaryDirection: Direction\n) {\n  if (secondary === \"CENTER\") {\n    const prop = primaryDirection === \"X\" ? \"top\" : \"left\";\n    const size = primaryDirection === \"X\" ? \"height\" : \"width\";\n\n    return getCenter(trigger, layer, offsetSecondary, prop, size);\n  }\n\n  const { side1, side2, size, factor } = propMap[secondary];\n\n  const value = trigger[side2] - offsetSecondary * factor;\n\n  return {\n    [side2]: value,\n    [side1]: value - layer[size] * factor\n  };\n}\n\ntype GetLayerRectArgs = {\n  trigger: ClientRect;\n  layer: ClientRect;\n  anchor: AnchorEnum;\n  triggerOffset: number;\n  scrollOffset?: number;\n  offsetSecondary?: number;\n  layerDimensions: LayerDimensions | null;\n};\n\nexport default function getLayerRectByAnchor({\n  trigger,\n  layer,\n  anchor,\n  triggerOffset,\n  scrollOffset = 0,\n  offsetSecondary = 0,\n  layerDimensions\n}: GetLayerRectArgs): ClientRect {\n  let primaryRect: Partial<ClientRect>;\n  let secondaryRect: Partial<ClientRect>;\n\n  // get the correct anticipated ClientRect based on the provided Anchor\n  const layerRect = layerDimensions\n    ? fixLayerDimensions(layer, anchor, layerDimensions)\n    : layer;\n\n  if (anchor === \"CENTER\") {\n    primaryRect = getCenter(trigger, layerRect, 0, \"top\", \"height\");\n    secondaryRect = getCenter(trigger, layerRect, 0, \"left\", \"width\");\n  } else {\n    const { primary, secondary } = splitAnchor(anchor);\n\n    const primaryDirection = getPrimaryDirection(anchor);\n\n    primaryRect = getPrimaryRect(primary, trigger, layerRect, triggerOffset);\n    secondaryRect = getSecondaryRect(\n      secondary,\n      trigger,\n      layerRect,\n      offsetSecondary,\n      primaryDirection\n    );\n  }\n\n  const result = {\n    ...layerRect,\n    ...primaryRect,\n    ...secondaryRect\n  };\n\n  // correct scrollOffsets\n  result.top = result.top - scrollOffset;\n  result.right = result.right + scrollOffset;\n  result.left = result.left - scrollOffset;\n  result.bottom = result.bottom + scrollOffset;\n\n  return result;\n}\n","import {\n  Rects,\n  AnchorEnum,\n  OffsetSide,\n  LayerDimensions,\n  LayerSide\n} from \"../types\";\nimport getLayerRectByAnchor from \"./getLayerRectByAnchor\";\n\nconst ALL_OFFSET_SIDES: OffsetSide[] = [\"bottom\", \"top\", \"left\", \"right\"];\n\ntype LayerOffsets = Record<OffsetSide, number>;\n\nfunction getLayerOffsetsToParent(\n  layer: ClientRect,\n  parent: ClientRect\n): LayerOffsets {\n  return {\n    top: layer.top - parent.top,\n    bottom: parent.bottom - layer.bottom,\n    left: layer.left - parent.left,\n    right: parent.right - layer.right\n  };\n}\n\nfunction getLayerOffsetsToParents(layer: ClientRect, parents: ClientRect[]) {\n  return parents.map(parent => getLayerOffsetsToParent(layer, parent));\n}\n\nexport function isLayerCompletelyInvisible(\n  layer: ClientRect,\n  parents: ClientRect[]\n) {\n  return parents.some(parent => {\n    return (\n      layer.bottom <= parent.top ||\n      layer.right <= parent.left ||\n      layer.top >= parent.bottom ||\n      layer.left >= parent.right\n    );\n  });\n}\n\nexport function doesEntireLayerFitWithinScrollParents(\n  layer: ClientRect,\n  parents: ClientRect[]\n) {\n  const parentOffsets = getLayerOffsetsToParents(layer, parents);\n\n  return parentOffsets.every(offsets => {\n    return ALL_OFFSET_SIDES.every(side => offsets[side] >= 0);\n  });\n}\n\nexport function reduceOffsets(parentOffsets: LayerOffsets[]): LayerOffsets {\n  const parentOffsetsCombined = parentOffsets.reduce(\n    (result, offsets) => {\n      ALL_OFFSET_SIDES.forEach(side => {\n        result[side] = [...result[side], offsets[side]];\n      });\n      return result;\n    },\n    {\n      top: [] as number[],\n      bottom: [] as number[],\n      left: [] as number[],\n      right: [] as number[]\n    }\n  );\n\n  return ALL_OFFSET_SIDES.reduce(\n    (result, side) => {\n      result[side] = parentOffsetsCombined[side].sort((a, b) => a - b)[0];\n      return result;\n    },\n    {} as LayerOffsets\n  );\n}\n\nexport function getNegativeOffsetSides(parentOffsets: LayerOffsets[]) {\n  const offsets = reduceOffsets(parentOffsets);\n\n  return ALL_OFFSET_SIDES.filter(side => offsets[side] < 0);\n}\n\nfunction getVisibleLayerSurface(layer: ClientRect, parent: ClientRect) {\n  const offsets = getLayerOffsetsToParent(layer, parent);\n\n  const { width, height } = ALL_OFFSET_SIDES.filter(\n    side => offsets[side] < 0\n  ).reduce((rect, side) => {\n    const affectedProperty: \"width\" | \"height\" =\n      side === \"top\" || side === \"bottom\" ? \"height\" : \"width\";\n\n    return {\n      ...rect,\n      [affectedProperty]: rect[affectedProperty] + offsets[side]\n    };\n  }, layer);\n\n  const result = width * height;\n\n  return width < 0 && height < 0 ? -result : result;\n}\n\nexport function getVisibleLayerSurfaceWithinScrollParent(\n  layer: ClientRect,\n  parents: ClientRect[]\n) {\n  const surfaces = parents.map(parent => getVisibleLayerSurface(layer, parent));\n\n  // pick smallest\n  return surfaces.sort((a, b) => a - b)[0];\n}\n\nexport function doesAnchorFitWithinScrollParents(\n  anchor: AnchorEnum,\n  rects: Rects,\n  triggerOffset: number,\n  scrollOffset: number,\n  layerDimensions: LayerDimensions | null\n) {\n  const layerRect = getLayerRectByAnchor({\n    anchor,\n    trigger: rects.trigger,\n    layer: rects.layer,\n    triggerOffset,\n    scrollOffset,\n    layerDimensions\n  });\n\n  return doesEntireLayerFitWithinScrollParents(layerRect, rects.scrollParents);\n}\n\nexport function getLayerOffsetsToScrollParentsByAnchor(\n  anchor: AnchorEnum,\n  rects: Rects,\n  triggerOffset: number,\n  scrollOffset: number\n) {\n  return getLayerOffsetsToParents(\n    getLayerRectByAnchor({\n      anchor,\n      trigger: rects.trigger,\n      layer: rects.layer,\n      triggerOffset,\n      scrollOffset,\n      layerDimensions: null\n    }),\n    rects.scrollParents\n  );\n}\n\nexport function triggerIsBiggerThanLayer(\n  layerSide: LayerSide,\n  layer: ClientRect,\n  trigger: ClientRect\n): boolean {\n  return (\n    ((layerSide === \"top\" || layerSide === \"bottom\") &&\n      trigger.width > layer.width) ||\n    ((layerSide === \"left\" || layerSide === \"right\") &&\n      trigger.height > layer.height)\n  );\n}\n","import { Rects, AnchorEnum, LayerDimensions } from \"../types\";\nimport { getPrimaryDirection } from \"../anchor\";\nimport {\n  doesAnchorFitWithinScrollParents,\n  getVisibleLayerSurfaceWithinScrollParent\n} from \"../rect\";\nimport getLayerRectByAnchor from \"../rect/getLayerRectByAnchor\";\n\nfunction getOffsetSurface(\n  anchor: AnchorEnum,\n  layer: ClientRect,\n  triggerOffset: number,\n  scrollOffset: number\n) {\n  const primaryDirection = getPrimaryDirection(anchor);\n\n  const primarySize =\n    layer[primaryDirection === \"X\" ? \"width\" : \"height\"] -\n    triggerOffset -\n    scrollOffset * 2;\n\n  const secondarySize =\n    layer[primaryDirection === \"X\" ? \"height\" : \"width\"] -\n    triggerOffset -\n    scrollOffset * 2;\n\n  return primarySize * secondarySize;\n}\n\nfunction findAnchorByLayerSurface(\n  rects: Rects,\n  anchorOptions: AnchorEnum[],\n  triggerOffset: number,\n  scrollOffset: number,\n  layerDimensions: LayerDimensions | null\n): AnchorEnum {\n  const result = anchorOptions\n    .map(anchor => {\n      // get layerRect based on all offsets\n      const layerRect = getLayerRectByAnchor({\n        anchor,\n        layer: rects.layer,\n        trigger: rects.trigger,\n        scrollOffset,\n        triggerOffset,\n        layerDimensions\n      });\n\n      // get smallest visible layer surface for current anchor\n      const surface = getVisibleLayerSurfaceWithinScrollParent(\n        layerRect,\n        rects.scrollParents\n      );\n\n      // get surface of the offsets\n      // offsets are important for collision detection, but\n      // eventually we are interested in the 'meat' of the layer\n      const offsetSurface = getOffsetSurface(\n        anchor,\n        layerRect,\n        triggerOffset,\n        scrollOffset\n      );\n\n      return {\n        anchor,\n        square: surface - offsetSurface\n      };\n    })\n    // sort -> biggest surface first\n    .sort((a, b) => b.square - a.square);\n\n  return result[0].anchor;\n}\n\nexport default function findBestSuitableAnchor(\n  rects: Rects,\n  anchorOptions: AnchorEnum[],\n  triggerOffset: number,\n  scrollOffset: number,\n  layerDimensions: LayerDimensions | null\n): AnchorEnum {\n  // STRATEGY A\n  // find first that fits parent\n  const anchor = anchorOptions.find(anchor =>\n    doesAnchorFitWithinScrollParents(\n      anchor,\n      rects,\n      triggerOffset,\n      scrollOffset,\n      layerDimensions\n    )\n  );\n\n  if (anchor) {\n    return anchor;\n  }\n\n  // STRATEGY B\n  // find first with biggest surface\n  return findAnchorByLayerSurface(\n    rects,\n    anchorOptions,\n    triggerOffset,\n    scrollOffset,\n    layerDimensions\n  );\n}\n","import { Rects, AnchorEnum, OffsetSide } from \"../types\";\nimport {\n  getLayerOffsetsToScrollParentsByAnchor,\n  getNegativeOffsetSides,\n  doesAnchorFitWithinScrollParents,\n  reduceOffsets,\n  triggerIsBiggerThanLayer\n} from \"../rect\";\nimport {\n  splitAnchor,\n  getPrimaryDirection,\n  getSecondaryAnchorOptionsByPrimary,\n  getLayerSideByAnchor\n} from \"../anchor\";\n\n// finds out which side of the layer will be affected\nfunction getSecondaryOffsetSide(\n  currentAnchor: AnchorEnum,\n  firstAnchorThatDoesNotFit: AnchorEnum,\n  rects: Rects,\n  triggerOffset: number,\n  scrollOffset: number\n): OffsetSide | undefined {\n  const primaryDirection = getPrimaryDirection(currentAnchor);\n\n  const offsets = getLayerOffsetsToScrollParentsByAnchor(\n    firstAnchorThatDoesNotFit,\n    rects,\n    triggerOffset,\n    scrollOffset\n  );\n\n  const sides = getNegativeOffsetSides(offsets);\n\n  return sides.find(side => {\n    if (primaryDirection === \"X\") {\n      return side === \"top\" || side === \"bottom\";\n    }\n\n    return side === \"left\" || side === \"right\";\n  });\n}\n\nexport default function findSecondaryOffset(\n  anchor: AnchorEnum,\n  anchorOptions: AnchorEnum[],\n  rects: Rects,\n  triggerOffset: number,\n  scrollOffset: number\n) {\n  const { primary } = splitAnchor(anchor);\n\n  /**\n   * A.\n   * Check which other anchors available\n   */\n  const secondaryAnchorOptions = getSecondaryAnchorOptionsByPrimary(\n    primary,\n    anchorOptions\n  );\n\n  /**\n   * B.\n   * Check whether current anchor is the preffered anchor and whether\n   * it fits\n   * If so, skip secondary offset\n   */\n  const currentAnchorHasHighestPriority =\n    secondaryAnchorOptions.indexOf(anchor) === 0;\n  const currentAnchorFits = doesAnchorFitWithinScrollParents(\n    anchor,\n    rects,\n    triggerOffset,\n    scrollOffset,\n    null\n  );\n\n  if (currentAnchorHasHighestPriority && currentAnchorFits) {\n    return 0;\n  }\n\n  /**\n   * C.\n   * Retrieve the first anchor on same primary side (by priority) that\n   * does not fit.\n   * Check if there's a relevant side that has a negative offset.\n   * If not, skip secondary offset\n   */\n  const firstAnchorThatDoesNotFit = secondaryAnchorOptions.find(anchor => {\n    return !doesAnchorFitWithinScrollParents(\n      anchor,\n      rects,\n      triggerOffset,\n      scrollOffset,\n      null\n    );\n  })!;\n\n  const affectedSide = getSecondaryOffsetSide(\n    anchor,\n    firstAnchorThatDoesNotFit,\n    rects,\n    triggerOffset,\n    scrollOffset\n  );\n\n  if (!affectedSide) {\n    return 0;\n  }\n\n  /**\n   * Determine the final secondary offset\n   */\n  const currentOffsets = reduceOffsets(\n    getLayerOffsetsToScrollParentsByAnchor(\n      anchor,\n      rects,\n      triggerOffset,\n      scrollOffset\n    )\n  );\n\n  let secondaryOffset = -currentOffsets[affectedSide];\n\n  const triggerIsBigger = triggerIsBiggerThanLayer(\n    getLayerSideByAnchor(anchor),\n    rects.layer,\n    rects.trigger\n  );\n\n  const isCenter = anchor.includes(\"_CENTER\");\n  const isLeft = anchor.includes(\"_LEFT\");\n  const isTop = anchor.includes(\"_TOP\");\n\n  // when trigger is bigger, make `secondaryOffset` positive\n  // conditionally\n  if (\n    triggerIsBigger &&\n    ((isLeft && affectedSide === \"right\") ||\n      affectedSide === \"left\" ||\n      (isTop && affectedSide === \"bottom\") ||\n      affectedSide === \"top\")\n  ) {\n    secondaryOffset = -secondaryOffset;\n  } else if (\n    // when current anchor is center, make `secondaryOffset` positive\n    // when affectedSide is top or right\n    !triggerIsBigger &&\n    (isCenter && (affectedSide === \"top\" || affectedSide === \"left\"))\n  ) {\n    secondaryOffset = -secondaryOffset;\n  }\n\n  return secondaryOffset;\n}\n","import { LayerSide } from \"../types\";\nimport { triggerIsBiggerThanLayer } from \"../rect\";\nimport { minMax } from \"../util\";\n\nfunction getOffsets(layer: ClientRect, trigger: ClientRect, arrow: ClientRect) {\n  const left = layer.left + layer.width / 2 - trigger.left - arrow.width / 2;\n  const right = layer.right - layer.width / 2 - trigger.right + arrow.width / 2;\n  const top = layer.top + layer.height / 2 - trigger.top - arrow.height / 2;\n  const bottom =\n    layer.bottom - layer.height / 2 - trigger.bottom + arrow.height / 2;\n\n  return {\n    left: left < 0 ? -left : 0,\n    right: right > 0 ? -right : 0,\n    top: top < 0 ? -top : 0,\n    bottom: bottom > 0 ? -bottom : 0\n  };\n}\n\nexport default function getArrowStyle(\n  layer: ClientRect,\n  trigger: ClientRect,\n  layerSide: LayerSide,\n  arrow: ClientRect\n): React.CSSProperties {\n  const triggerIsBigger = triggerIsBiggerThanLayer(layerSide, layer, trigger);\n\n  const limitsDefault = {\n    left: {\n      min: arrow.width / 2,\n      max: layer.width - arrow.width / 2\n    },\n    top: {\n      min: arrow.height / 2,\n      max: layer.height - arrow.height / 2\n    }\n  };\n\n  const offsets = getOffsets(layer, trigger, arrow);\n\n  if (layerSide === \"bottom\") {\n    return {\n      bottom: \"100%\",\n      top: null,\n      left: minMax(\n        triggerIsBigger\n          ? layer.width / 2 + (offsets.left + offsets.right)\n          : trigger.left + trigger.width / 2 - layer.left,\n        limitsDefault.left\n      ),\n      right: null\n    } as any;\n  }\n  if (layerSide === \"right\") {\n    return {\n      right: \"100%\",\n      left: null,\n      top: minMax(\n        triggerIsBigger\n          ? layer.height / 2 + (offsets.top + offsets.bottom)\n          : trigger.top + trigger.height / 2 - layer.top,\n        limitsDefault.top\n      ),\n      bottom: null\n    } as any;\n  }\n  if (layerSide === \"top\") {\n    return {\n      top: \"100%\",\n      bottom: null,\n      left: minMax(\n        triggerIsBigger\n          ? layer.width / 2 + (offsets.left + offsets.right)\n          : trigger.left + trigger.width / 2 - layer.left,\n        limitsDefault.left\n      ),\n      right: null\n    } as any;\n  }\n\n  return {\n    left: \"100%\",\n    right: null,\n    top: minMax(\n      triggerIsBigger\n        ? layer.height / 2 + (offsets.top + offsets.bottom)\n        : trigger.top + trigger.height / 2 - layer.top,\n      limitsDefault.top\n    ),\n    bottom: null\n  } as any;\n}\n","import {\n  Rects,\n  AnchorEnum,\n  PreferedX,\n  PreferedY,\n  LayerDimensions\n} from \"../types\";\n\nimport { getAnchorPriority } from \"../anchor\";\n\nimport getAbsolutePositions from \"./getAbsolutePositions\";\nimport getSuitableAnchor from \"./getSuitableAnchor\";\nimport getSecondaryOffset from \"./getSecondaryOffset\";\nimport getLayerRectByAnchor from \"../rect/getLayerRectByAnchor\";\n\nexport { default as getArrowStyle } from \"./getArrowStyle\";\n\ntype GetAutoAdjustStyleArgs = {\n  rects: Rects;\n  scrollTop: number;\n  scrollLeft: number;\n  triggerOffset: number;\n  scrollOffset: number;\n  preferedAnchor: AnchorEnum;\n  preferedX: PreferedX;\n  preferedY: PreferedY;\n  possibleAnchors: AnchorEnum[];\n  autoAdjust: boolean;\n  snapToAnchor: boolean;\n  layerDimensions: LayerDimensions | null;\n};\n\nexport default function getAbsoluteStyle({\n  rects,\n  scrollTop,\n  scrollLeft,\n  triggerOffset,\n  scrollOffset,\n  possibleAnchors,\n  preferedAnchor,\n  preferedX,\n  preferedY,\n  autoAdjust,\n  snapToAnchor,\n  layerDimensions\n}: GetAutoAdjustStyleArgs): {\n  layerStyle: React.CSSProperties;\n  layerRect: ClientRect;\n  anchor: AnchorEnum;\n} {\n  // get a list of possible anchors bases on user set props\n  const possibleAnchorsByPriority = getAnchorPriority(\n    preferedAnchor,\n    possibleAnchors,\n    preferedX,\n    preferedY,\n    rects\n  );\n\n  // on `autoAdjust` find best suitable anchor based on\n  // window's / scrollParent's position\n  const anchor = autoAdjust\n    ? getSuitableAnchor(\n        rects,\n        possibleAnchorsByPriority,\n        triggerOffset,\n        scrollOffset,\n        layerDimensions\n      )\n    : preferedAnchor;\n\n  // calculate a secondary offset when `autoAdjust` is set\n  // and `snapToAnchor` is not.\n  // Basically it creates a visual effect where it seems that\n  // the layer has glued to it's parents sides\n  // Note: `offsetSecondary` is disabled when anchor is CENTER\n  const offsetSecondary =\n    autoAdjust && !snapToAnchor && anchor !== \"CENTER\"\n      ? getSecondaryOffset(\n          anchor,\n          possibleAnchorsByPriority,\n          rects,\n          triggerOffset,\n          scrollOffset\n        )\n      : 0;\n\n  const layerStyle = getAbsolutePositions({\n    anchor,\n    rects,\n    triggerOffset,\n    offsetSecondary,\n    scrollLeft,\n    scrollTop\n  });\n\n  const layerRect = getLayerRectByAnchor({\n    anchor,\n    trigger: rects.trigger,\n    layer: rects.layer,\n    triggerOffset,\n    offsetSecondary,\n    layerDimensions\n  });\n\n  if (layerDimensions) {\n    layerStyle.width = layerRect.width;\n    layerStyle.height = layerRect.height;\n  }\n\n  return {\n    layerStyle,\n    layerRect,\n    anchor\n  };\n}\n","import { Placement, ResultingStyles, Rects } from \"./types\";\nimport {\n  getWindowClientRect,\n  getContentBox,\n  EMPTY_STYLE,\n  isSet,\n  clientRectToObject\n} from \"./util\";\nimport { POSSIBLE_ANCHORS, getLayerSideByAnchor } from \"./anchor\";\nimport getAbsoluteStyle, { getArrowStyle } from \"./style\";\n\nfunction compensateScrollbars(\n  rect: ClientRect,\n  clientWidth: number,\n  clientHeight: number\n) {\n  const scrollbarWidth = rect.width - clientWidth;\n  const scrollbarHeight = rect.height - clientHeight;\n\n  return {\n    left: rect.left,\n    top: rect.top,\n    width: rect.width - scrollbarWidth,\n    right: rect.right - scrollbarWidth,\n    height: rect.height - scrollbarHeight,\n    bottom: rect.bottom - scrollbarHeight\n  };\n}\n\nfunction getArrowRect(\n  layerElement: HTMLElement,\n  arrowOffset: number\n): ClientRect {\n  const arrowElement = layerElement.querySelector(\"[data-arrow]\");\n  if (!arrowElement) {\n    return { top: 0, bottom: 0, left: 0, right: 0, width: 0, height: 0 };\n  }\n\n  const rect = arrowElement.getBoundingClientRect();\n\n  return {\n    ...clientRectToObject(rect),\n    width: rect.width + arrowOffset * 2,\n    height: rect.height + arrowOffset * 2\n  };\n}\n\nexport const defaultPlacement: Required<Placement> = {\n  autoAdjust: false,\n  snapToAnchor: false,\n  anchor: \"TOP_CENTER\",\n  layerDimensions: null,\n  possibleAnchors: POSSIBLE_ANCHORS,\n  preferX: \"RIGHT\",\n  preferY: \"BOTTOM\",\n  scrollOffset: 10,\n  triggerOffset: 0,\n  arrowOffset: 0\n};\n\ntype CalculateStyleProps = {\n  triggerRect: ClientRect;\n  layerElement: HTMLElement | null;\n  relativeParentElement: HTMLElement | null;\n  scrollParents: HTMLElement[];\n  placement: Placement;\n  fixed: boolean | undefined;\n  environment?: Window;\n};\n\nexport default function getPositioning({\n  triggerRect,\n  layerElement,\n  relativeParentElement,\n  scrollParents,\n  placement = {},\n  environment,\n  fixed\n}: CalculateStyleProps) {\n  /**\n   * A.\n   * Calculate new layer positions\n   */\n\n  // sometimes ResizeObserver calls this function when all values in the\n  // trigger ClientRect are 0. Return early in that case\n  if (triggerRect.height === 0) {\n    return;\n  }\n\n  if (!layerElement) {\n    return;\n  }\n\n  // gather all scroll parents (including the window ClientRect)\n  // in order to check for collisions\n  const scrollParentRects = fixed\n    ? [getWindowClientRect(environment)]\n    : [\n        ...scrollParents.map(parent =>\n          compensateScrollbars(\n            parent.getBoundingClientRect(),\n            parent.clientWidth,\n            parent.clientHeight\n          )\n        ),\n        getWindowClientRect(environment)\n      ];\n\n  const options = {\n    autoAdjust: placement.autoAdjust || defaultPlacement.autoAdjust,\n    snapToAnchor: placement.snapToAnchor || defaultPlacement.snapToAnchor,\n    triggerOffset: (isSet(placement.triggerOffset)\n      ? placement.triggerOffset\n      : defaultPlacement.triggerOffset) as number,\n    scrollOffset: (isSet(placement.scrollOffset)\n      ? placement.scrollOffset\n      : defaultPlacement.scrollOffset) as number,\n    possibleAnchors:\n      placement.possibleAnchors || defaultPlacement.possibleAnchors,\n    preferedAnchor: placement.anchor || defaultPlacement.anchor,\n    preferedX: placement.preferX || defaultPlacement.preferX,\n    preferedY: placement.preferY || defaultPlacement.preferY,\n    scrollLeft:\n      relativeParentElement === document.body\n        ? 0\n        : relativeParentElement!.scrollLeft,\n    scrollTop:\n      relativeParentElement === document.body\n        ? 0\n        : relativeParentElement!.scrollTop,\n    relativeParentElement,\n    layerDimensions:\n      placement.layerDimensions || defaultPlacement.layerDimensions\n  };\n\n  const layerBox = layerElement.getBoundingClientRect();\n\n  // construct layerRect\n  const layer = {\n    top: layerBox.top,\n    left: layerBox.left,\n    right: layerBox.right,\n    bottom: layerBox.bottom,\n\n    // use `window.getComputedProperty` for width / height in order\n    // to handle things like scale-transforms\n    ...getContentBox(layerElement!, environment)\n  };\n\n  const rects: Rects = {\n    layer,\n    relativeParent: relativeParentElement!.getBoundingClientRect(),\n    scrollParents: scrollParentRects,\n    trigger: triggerRect,\n    arrow: getArrowRect(\n      layerElement,\n      placement.arrowOffset || defaultPlacement.arrowOffset\n    )\n  };\n\n  const { layerRect, layerStyle, anchor } = getAbsoluteStyle({\n    rects,\n    ...options\n  });\n\n  if (fixed) {\n    layerStyle.top = layerRect.top;\n    layerStyle.left = layerRect.left;\n  }\n\n  // determine in which side to layer will be relative to\n  // the trigger\n  const layerSide = getLayerSideByAnchor(anchor);\n\n  // get optional arrow positions\n  // anchor-style is pointless when rendered anchor is CENTER\n  const arrowStyle =\n    anchor === \"CENTER\"\n      ? EMPTY_STYLE\n      : getArrowStyle(layerRect, triggerRect, layerSide, rects.arrow);\n\n  const styles: ResultingStyles = {\n    layer: layerStyle,\n    arrow: arrowStyle,\n    layerSide\n  };\n\n  return {\n    styles,\n    layerRect\n  };\n}\n","import * as React from \"react\";\n\n/**\n * Tracks an element and keeps it in state\n * (together with other relevant state that depends on the element)\n */\nfunction useElementRef<T = HTMLElement | null>(\n  initialState?: T,\n  elementToState?: (element: HTMLElement) => T\n) {\n  const [state, setState] = React.useState<T | null>(initialState || null);\n\n  const lastElement = React.useRef<HTMLElement | null>(null);\n\n  const setRef = React.useCallback(node => {\n    if (node && node !== lastElement.current) {\n      lastElement.current = node;\n      if (elementToState) {\n        setState(elementToState(node));\n      } else {\n        setState(node);\n      }\n    }\n  }, []);\n\n  return [setRef, state, lastElement] as [\n    any,\n    T,\n    React.MutableRefObject<HTMLElement | null>\n  ];\n}\n\nexport default useElementRef;\n","export default function findScrollContainers(\n  element: HTMLElement | null,\n  environment?: Window\n): HTMLElement[] {\n  const result: HTMLElement[] = [];\n\n  if (!element || !environment) {\n    return result;\n  }\n\n  if (element === document.body) {\n    return result;\n  }\n\n  const { overflow, overflowX, overflowY } = environment.getComputedStyle(\n    element\n  );\n\n  if (\n    [overflow, overflowX, overflowY].some(\n      prop => prop === \"auto\" || prop === \"scroll\"\n    )\n  ) {\n    result.push(element);\n  }\n\n  return [\n    ...result,\n    ...findScrollContainers(element.parentElement, environment)\n  ];\n}\n","import { Container } from \"./types\";\nimport useElementRef from \"./useElementRef\";\nimport * as React from \"react\";\nimport findScrollContainers from \"./findScrollContainers\";\n\ntype UseElementState = {\n  triggerElement: HTMLElement | null;\n  relativeParentElement: HTMLElement | null;\n  scrollParents: HTMLElement[];\n};\n\nexport default function useElementState(\n  container: Container | undefined,\n  fixed: boolean | undefined,\n  environment?: Window\n) {\n  return useElementRef<UseElementState>(\n    { triggerElement: null, relativeParentElement: null, scrollParents: [] },\n    React.useCallback((triggerElement: HTMLElement) => {\n      const scrollParents = findScrollContainers(triggerElement, environment);\n\n      const relativeParentElement = scrollParents[0] || document.body;\n\n      if (relativeParentElement === document.body) {\n        document.body.style.position = \"relative\";\n      } else if (process.env.NODE_ENV === \"development\" && environment) {\n        // Check if we should warn the user about 'position: relative; stuff...'\n        const containerElement =\n          typeof container === \"function\" ? container() : container;\n\n        const position = environment.getComputedStyle(relativeParentElement)\n          .position;\n        const shouldWarnAboutPositionStyle =\n          position !== \"relative\" &&\n          position !== \"absolute\" &&\n          position !== \"fixed\" &&\n          !fixed &&\n          !containerElement;\n\n        if (shouldWarnAboutPositionStyle) {\n          console.error(\n            `react-laag: Set the 'position' style of the nearest scroll-container to 'relative', 'absolute' or 'fixed', or set the 'fixed' prop to true. This is needed in order to position the layers properly. Currently the scroll-container is positioned: \"${position}\". Visit https://react-laag.com/docs/#position-relative for more info.`,\n            relativeParentElement\n          );\n        }\n      }\n\n      return {\n        triggerElement,\n        relativeParentElement,\n        scrollParents\n      };\n    }, [])\n  );\n}\n","import * as React from \"react\";\nimport { isSet } from \"./util\";\n\nexport default function useIsOpen(\n  internal: boolean,\n  external: boolean | undefined\n) {\n  const shouldOpenAfterMount = React.useRef<boolean>(external!);\n\n  const isOpen = shouldOpenAfterMount.current\n    ? false\n    : isSet(external)\n    ? external!\n    : internal;\n\n  const rerenderAfterMount = React.useState(false)[1];\n\n  React.useEffect(() => {\n    if (shouldOpenAfterMount.current) {\n      shouldOpenAfterMount.current = false;\n      rerenderAfterMount(true);\n    }\n  }, []);\n\n  return isOpen;\n}\n","import * as React from \"react\";\nimport {\n  LayerSide,\n  RenderLayer,\n  ToggleLayerOptions,\n  DisappearType\n} from \"./types\";\n\nimport useOutsideClick, { OutsideClickGroupProvider } from \"./useOutsideClick\";\nimport useOnScroll from \"./useOnScroll\";\nimport useOnWindowResize from \"./useOnWindowResize\";\nimport useTrackElementResize from \"./useTrackElementResize\";\nimport useIsomorphicLayoutEffect from \"./useIsomorphicLayoutEffect\";\nimport useStyleState from \"./useStyleState\";\nimport getPositioning, { defaultPlacement } from \"./getPositioning\";\nimport useElementState from \"./useElementState\";\nimport useIsOpen from \"./useIsOpen\";\n\nimport {\n  EMPTY_STYLE,\n  isSet,\n  shouldUpdateStyles,\n  getWindowClientRect\n} from \"./util\";\n\nimport {\n  doesEntireLayerFitWithinScrollParents,\n  isLayerCompletelyInvisible\n} from \"./rect\";\nimport { createPortal } from \"react-dom\";\n\ntype RenderChildrenProps = {\n  isOpen: boolean;\n  open: () => void;\n  close: () => void;\n  toggle: () => void;\n  triggerRef: React.RefObject<any>;\n  layerSide: LayerSide | null;\n};\n\nexport type ToggleLayerProps = {\n  children: (childrenProps: RenderChildrenProps) => React.ReactNode;\n  renderLayer: RenderLayer;\n  isOpen?: boolean;\n  onOutsideClick?: () => void;\n  onDisappear?: (type: DisappearType) => void;\n} & ToggleLayerOptions;\n\nexport const ToggleLayer = ({\n  children,\n  renderLayer,\n  placement = {},\n  onStyle,\n  isOpen: isOpenExternal,\n  closeOnOutsideClick,\n  onOutsideClick,\n  onDisappear,\n  closeOnDisappear,\n  fixed,\n  container,\n  environment = typeof window !== \"undefined\" ? window : undefined,\n  ...props\n}: ToggleLayerProps) => {\n  /**\n   * Tracks trigger element and keeps it in state together with it's\n   * relative/absolute positioned parent\n   */\n  const [\n    triggerRef,\n    { relativeParentElement, triggerElement, scrollParents },\n    normalTriggerRef\n  ] = useElementState(container, fixed, environment!);\n\n  const { styles, setStyles, lastStyles, resetLastStyles } = useStyleState(\n    placement.anchor || defaultPlacement.anchor\n  );\n\n  const layerRef = React.useRef<HTMLElement | null>(null);\n\n  const [isOpenInternal, setOpenInternal] = React.useState(false);\n\n  const isOpen = useIsOpen(isOpenInternal, isOpenExternal);\n\n  const handlePositioning = React.useCallback(() => {\n    if (!triggerElement) {\n      throw new Error(\n        \"Could not find a valid reference of the trigger element. See https://www.react-laag.com/docs/togglelayer/#children for more info.\"\n      );\n    }\n    const triggerRect = triggerElement.getBoundingClientRect();\n\n    const result = getPositioning({\n      triggerRect,\n      layerElement: layerRef.current,\n      placement,\n      relativeParentElement,\n      scrollParents,\n      fixed,\n      environment\n    });\n\n    if (!result) {\n      return;\n    }\n\n    const { layerRect, styles } = result;\n\n    // only update styles when necessary\n    if (shouldUpdateStyles(lastStyles.current, styles)) {\n      // is parent in control of styles? (onStyle)\n      if (isSet(onStyle)) {\n        lastStyles.current = styles;\n        onStyle!(styles.layer, styles.arrow, styles.layerSide);\n      }\n      // ... otherwise set styles internally\n      else {\n        setStyles(styles);\n      }\n    }\n\n    /**\n     * B.\n     * Manage disappearance\n     */\n\n    const hasOnDisappear = isSet(onDisappear);\n    const shouldCloseOnDisappear = closeOnDisappear && !isSet(isOpenExternal);\n\n    // Should we respond to the layer's partial or full disappearance?\n    // (trigger's disappearance when `fixed` props is set)\n    if (hasOnDisappear || shouldCloseOnDisappear) {\n      const allScrollParents = [\n        ...scrollParents.map(parent => parent.getBoundingClientRect()),\n        getWindowClientRect(environment)\n      ];\n\n      const partial = !doesEntireLayerFitWithinScrollParents(\n        fixed ? triggerRect : layerRect,\n        allScrollParents\n      );\n\n      const full = isLayerCompletelyInvisible(\n        fixed ? triggerRect : layerRect,\n        allScrollParents\n      );\n\n      // if parent is interested in diseappearance...\n      if (hasOnDisappear) {\n        if (partial || full) {\n          onDisappear!(full ? \"full\" : \"partial\");\n        }\n      }\n      // ... else close accordingly\n      else {\n        if (closeOnDisappear === \"partial\" && partial) {\n          setOpenInternal(false);\n        }\n        if (closeOnDisappear === \"full\" && full) {\n          setOpenInternal(false);\n        }\n      }\n    }\n  }, [\n    relativeParentElement,\n    isOpen,\n    triggerElement,\n    scrollParents,\n    fixed,\n    placement\n  ]);\n\n  // call `handlePositioning` when the layer's / trigger's\n  // height and / or width changes\n  const resizeObserver = useTrackElementResize(\n    props.ResizeObserver,\n    layerRef,\n    triggerElement,\n    isOpen,\n    handlePositioning,\n    environment\n  );\n\n  // On every render, check a few things...\n  useIsomorphicLayoutEffect(() => {\n    /**\n     * A.\n     * Ignore when render is caused by internal style change\n     */\n    const styleIsSetInterally = !isSet(onStyle);\n    const effectBecauseOfInternalStyleChange = styles !== lastStyles.current;\n\n    if (effectBecauseOfInternalStyleChange && styleIsSetInterally) {\n      lastStyles.current = styles;\n      return;\n    }\n\n    // reset lastStyles-ref when closed\n    if (!isOpen) {\n      resetLastStyles();\n      return;\n    }\n\n    /**\n     * B.\n     * Prepare to calculate new layer style\n     */\n\n    // if (!triggerElement) {\n    //   throw new Error(\"Please provide a valid ref to the trigger element\");\n    // } else if (!layerRef.current) {\n    //   throw new Error(\"Please provide a valid ref to the layer element\");\n    // }\n\n    handlePositioning();\n  });\n\n  // calculate new layer style when window size changes\n  useOnWindowResize(handlePositioning, environment, isOpen);\n\n  // calculate new layer style when user scrolls\n  useOnScroll(scrollParents, handlePositioning, environment, isOpen);\n\n  const outsideClickRefs = React.useRef(\n    new Set<React.RefObject<HTMLElement | null | undefined>>([\n      layerRef,\n      normalTriggerRef\n    ])\n  );\n\n  // handle clicks that are not originated from the trigger / layer\n  // element\n  useOutsideClick(\n    outsideClickRefs,\n    React.useCallback(() => {\n      if (!isOpen) {\n        return;\n      }\n\n      if (onOutsideClick) {\n        onOutsideClick();\n      }\n\n      if (closeOnOutsideClick && !isSet(isOpenExternal)) {\n        setOpenInternal(false);\n      }\n    }, [isOpen, setOpenInternal, isOpenExternal, onOutsideClick])\n  );\n\n  const containerElement =\n    typeof container === \"function\" ? container() : container;\n\n  return (\n    <>\n      {children({\n        isOpen,\n        close: () => {\n          /* istanbul ignore next */\n          if (isSet(isOpenExternal)) {\n            throw new Error(\n              \"You cannot call `close()` while using the `isOpen` prop\"\n            );\n          }\n          /* istanbul ignore next */\n          setOpenInternal(false);\n        },\n        open: () => {\n          /* istanbul ignore next */\n          if (isSet(isOpenExternal)) {\n            throw new Error(\n              \"You cannot call `open()` while using the `isOpen` prop\"\n            );\n          }\n          /* istanbul ignore next */\n          setOpenInternal(true);\n        },\n        toggle: () => {\n          /* istanbul ignore next */\n          if (isSet(isOpenExternal)) {\n            throw new Error(\n              \"You cannot call `toggle()` while using the `isOpen` prop\"\n            );\n          }\n          setOpenInternal(!isOpenInternal);\n        },\n        triggerRef,\n        layerSide: isOpen ? styles.layerSide : null\n      })}\n\n      {relativeParentElement && (\n        <OutsideClickGroupProvider refs={outsideClickRefs}>\n          {createPortal(\n            renderLayer({\n              layerProps: {\n                ref: element => {\n                  if (element) {\n                    // observe the layer for resizing\n                    // it's ok to observe the same element multiple times\n                    // since multiple observes of same element are ignored\n                    resizeObserver.observe(element!);\n                  }\n\n                  layerRef.current = element;\n                },\n                style: {\n                  ...(isSet(onStyle) ? EMPTY_STYLE : styles.layer),\n                  position: fixed ? \"fixed\" : \"absolute\",\n                  willChange: \"top, bottom, left, right, width, height\"\n                }\n              },\n              arrowStyle: {\n                ...(isSet(onStyle) ? EMPTY_STYLE : styles.arrow),\n                position: \"absolute\",\n                willChange: \"top, bottom, left, right\"\n              },\n              isOpen,\n              layerSide: styles.layerSide,\n              triggerRect: triggerElement\n                ? triggerElement.getBoundingClientRect()\n                : null,\n              close: () => {\n                /* istanbul ignore next */\n                if (isSet(isOpenExternal)) {\n                  throw new Error(\n                    \"You cannot call `close()` while using the `isOpen` prop\"\n                  );\n                }\n                /* istanbul ignore next */\n                setOpenInternal(false);\n              }\n            }),\n            containerElement || relativeParentElement\n          )}\n        </OutsideClickGroupProvider>\n      )}\n    </>\n  );\n}\n\nexport default ToggleLayer;\n","import * as React from \"react\";\nimport { LayerSide } from \"./types\";\n\nfunction getWidthBasedOnAngle(angle: number, size: number) {\n  return Math.tan(angle * (Math.PI / 180)) * size;\n}\n\nfunction getViewBox(\n  sizeA: number,\n  sizeB: number,\n  layerSide: LayerSide,\n  borderWidth: number\n) {\n  switch (layerSide) {\n    case \"bottom\":\n      return `0 ${-borderWidth} ${sizeB} ${sizeA}`;\n    case \"top\":\n      return `0 0 ${sizeB} ${sizeA + borderWidth}`;\n    case \"right\":\n      return `${-borderWidth} 0 ${sizeA} ${sizeB}`;\n    case \"left\":\n      return `0 0 ${sizeA + borderWidth} ${sizeB}`;\n  }\n\n  return \"\";\n}\n\ntype getTrianglePathProps = {\n  sizeA: number;\n  sizeB: number;\n  layerSide: LayerSide;\n  roundness: number;\n  angle: number;\n};\n\nfunction getTrianglePath({\n  sizeA,\n  sizeB,\n  layerSide,\n  roundness,\n  angle\n}: getTrianglePathProps) {\n  const relativeRoundness = (roundness / 10) * sizeA * 2;\n\n  const A =\n    layerSide === \"bottom\"\n      ? `0 ${sizeA}`\n      : layerSide === \"top\"\n      ? `0 0`\n      : layerSide === \"right\"\n      ? `${sizeA} ${sizeB}`\n      : `0 ${sizeB}`;\n\n  const B = `${layerSide === \"bottom\" || layerSide === \"top\" ? \"H\" : \"V\"} ${\n    layerSide === \"bottom\" || layerSide === \"top\" ? sizeB : 0\n  }`;\n\n  const cPoint = sizeB / 2;\n  const c1A = sizeB / 2 + getWidthBasedOnAngle(angle, sizeA / 8);\n  const c1B = sizeA / 8;\n\n  const C =\n    layerSide === \"bottom\"\n      ? `C ${c1A} ${c1B} ${cPoint + relativeRoundness} 0 ${cPoint} 0`\n      : layerSide === \"top\"\n      ? `C ${c1A} ${sizeA - c1B} ${cPoint +\n          relativeRoundness} ${sizeA} ${cPoint} ${sizeA}`\n      : layerSide === \"right\"\n      ? `C ${c1B} ${sizeB - c1A} 0 ${cPoint - relativeRoundness} 0 ${cPoint}`\n      : `C ${sizeA - c1B} ${sizeB - c1A} ${sizeA} ${cPoint -\n          relativeRoundness} ${sizeA} ${cPoint}`;\n\n  const d1A = sizeB / 2 - getWidthBasedOnAngle(angle, sizeA / 8);\n  const d1B = sizeA / 8;\n\n  const D =\n    layerSide === \"bottom\"\n      ? `C ${cPoint - relativeRoundness} 0 ${d1A} ${d1B} ${A}`\n      : layerSide === \"top\"\n      ? `C ${cPoint - relativeRoundness} ${sizeA} ${d1A} ${sizeA - d1B} ${A}`\n      : layerSide === \"right\"\n      ? `C 0 ${cPoint + relativeRoundness} ${d1B} ${sizeB - d1A} ${A}`\n      : `C${sizeA} ${cPoint + relativeRoundness} ${sizeA - d1B} ${sizeB -\n          d1A} ${A}`;\n\n  return `M ${A} ${B} ${C} ${D}`;\n}\n\ntype GetBorderMaskPathProps = {\n  sizeA: number;\n  sizeB: number;\n  borderWidth: number;\n  layerSide: LayerSide;\n  angle: number;\n};\n\nfunction getBorderMaskPath({\n  sizeA,\n  sizeB,\n  borderWidth,\n  layerSide,\n  angle\n}: GetBorderMaskPathProps) {\n  const borderOffset = getWidthBasedOnAngle(angle, borderWidth);\n\n  if (layerSide === \"bottom\" || layerSide === \"top\") {\n    return `M ${borderWidth} ${layerSide === \"bottom\" ? sizeA : 0} H ${sizeB -\n      borderWidth} L ${sizeB - borderWidth - borderOffset} ${\n      layerSide === \"bottom\" ? sizeA - borderWidth : borderWidth\n    } H ${borderOffset + borderWidth} Z`;\n  }\n\n  return `M ${layerSide === \"right\" ? sizeA : 0} ${borderWidth} V ${sizeB -\n    borderWidth} L ${\n    layerSide === \"right\" ? sizeA - borderWidth : borderWidth\n  } ${sizeB - borderWidth - borderOffset} V ${borderOffset + borderWidth} Z`;\n}\n\nexport type ArrowProps = {\n  angle?: number; // angle of triangle -> range(10, 80) | default 45\n  size?: number; // distance in pixels between point of triangle and layer | default 8\n  roundness?: number; // roundness of the point of the arrow -> range(0, 1) | default 0\n  borderWidth?: number; // default 0\n  borderColor?: string; // default \"black\"\n  backgroundColor?: string; // default \"white\"\n  layerSide?: LayerSide;\n  style?: React.CSSProperties;\n};\n\nexport const Arrow = ({\n  size = 8,\n  angle = 45,\n  borderWidth = 0,\n  borderColor = \"black\",\n  roundness = 0,\n  backgroundColor = \"white\",\n  layerSide = \"top\",\n  style = {}\n}: ArrowProps) => {\n  if (layerSide === \"center\") {\n    return null;\n  }\n\n  const sizeA = size;\n  const sizeB = getWidthBasedOnAngle(angle, size) * 2;\n\n  return (\n    <svg\n      style={{\n        ...style,\n        transform: `translate${\n          layerSide === \"left\" || layerSide === \"right\" ? \"Y\" : \"X\"\n        }(-50%)`\n      }}\n      data-arrow=\"true\"\n      width={layerSide === \"left\" || layerSide === \"right\" ? sizeA : sizeB}\n      viewBox={getViewBox(sizeA, sizeB, layerSide, borderWidth)}\n    >\n      <path\n        fill={backgroundColor}\n        strokeWidth={borderWidth}\n        stroke={borderColor}\n        d={getTrianglePath({\n          angle,\n          layerSide,\n          roundness,\n          sizeA,\n          sizeB\n        })}\n      />\n      <path\n        fill={backgroundColor}\n        d={getBorderMaskPath({ sizeA, sizeB, angle, borderWidth, layerSide })}\n      />\n    </svg>\n  );\n}\n\nexport default Arrow;\n","import * as React from \"react\";\nimport { createPortal } from \"react-dom\";\n\nimport { RenderLayer, ToggleLayerOptions, LayerSide } from \"./types\";\nimport {\n  isSet,\n  shouldUpdateStyles,\n  getWindowClientRect,\n  EMPTY_STYLE,\n  getElementFromAnchorNode\n} from \"./util\";\nimport {\n  doesEntireLayerFitWithinScrollParents,\n  isLayerCompletelyInvisible\n} from \"./rect\";\nimport getPositioning, { defaultPlacement } from \"./getPositioning\";\n\nimport useElementState from \"./useElementState\";\nimport useStyleState from \"./useStyleState\";\nimport useTrackElementResize from \"./useTrackElementResize\";\nimport useIsomorphicLayoutEffect from \"./useIsomorphicLayoutEffect\";\nimport useOnWindowResize from \"./useOnWindowResize\";\nimport useOnScroll from \"./useOnScroll\";\nimport useOutsideClick, { OutsideClickGroupProvider } from \"./useOutsideClick\";\n\ntype OpenProps = {\n  clientRect: ClientRect | (() => ClientRect);\n  target: HTMLElement;\n};\n\ntype UseToggleLayerPayload = {\n  open: (props: OpenProps) => void;\n  openFromContextMenuEvent: (event: React.MouseEvent<any, MouseEvent>) => void;\n  openFromMouseEvent: (event: React.MouseEvent<any, MouseEvent>) => void;\n  openFromSelection: (selection: Selection) => void;\n  openFromRef: (ref: React.MutableRefObject<any>) => void;\n  close: () => void;\n  isOpen: boolean;\n  layerSide: LayerSide | null;\n};\n\nexport default function useToggleLayer(\n  renderLayer: RenderLayer,\n  {\n    onStyle,\n    closeOnOutsideClick,\n    closeOnDisappear,\n    fixed,\n    container,\n    placement = {},\n    environment = typeof window !== \"undefined\" ? window : undefined,\n    ...props\n  }: ToggleLayerOptions = {}\n) {\n  /**\n   * Tracks trigger element and keeps it in state together with it's\n   * relative/absolute positioned parent\n   */\n  const [\n    setTargetRef,\n    { relativeParentElement, triggerElement: targetElement, scrollParents },\n    normalTriggerRef\n  ] = useElementState(container, fixed, environment);\n\n  const { styles, setStyles, lastStyles, resetLastStyles } = useStyleState(\n    placement.anchor || defaultPlacement.anchor\n  );\n\n  const layerRef = React.useRef<HTMLElement | null>(null);\n  const triggerRectRef = React.useRef<ClientRect | (() => ClientRect) | null>(\n    null\n  );\n\n  function getTriggerRect() {\n    return typeof triggerRectRef.current! === \"function\"\n      ? triggerRectRef.current()\n      : triggerRectRef.current!;\n  }\n\n  const [isOpen, setOpen] = React.useState(false);\n\n  function close() {\n    triggerRectRef.current = null;\n    setOpen(false);\n  }\n\n  const handlePositioning = React.useCallback(() => {\n    const triggerRect = getTriggerRect();\n\n    if (!triggerRect) {\n      return;\n    }\n\n    const result = getPositioning({\n      triggerRect,\n      layerElement: layerRef.current,\n      placement,\n      relativeParentElement,\n      scrollParents,\n      fixed,\n      environment\n    });\n\n    if (!result) {\n      return;\n    }\n\n    const { layerRect, styles } = result;\n\n    // only update styles when necessary\n    if (shouldUpdateStyles(lastStyles.current, styles)) {\n      // is parent in control of styles? (onStyle)\n      if (isSet(onStyle)) {\n        lastStyles.current = styles;\n        onStyle!(styles.layer, styles.arrow, styles.layerSide);\n      }\n      // ... otherwise set styles internally\n      else {\n        setStyles(styles);\n      }\n    }\n\n    /**\n     * B.\n     * Manage disappearance\n     */\n\n    // Should we respond to the layer's partial or full disappearance?\n    // (trigger's disappearance when `fixed` props is set)\n    if (closeOnDisappear) {\n      const allScrollParents = [\n        ...scrollParents.map(parent => parent.getBoundingClientRect()),\n        getWindowClientRect(environment)\n      ];\n\n      const partial = !doesEntireLayerFitWithinScrollParents(\n        fixed ? triggerRect : layerRect,\n        allScrollParents\n      );\n      const full = isLayerCompletelyInvisible(\n        fixed ? triggerRect : layerRect,\n        allScrollParents\n      );\n\n      if (closeOnDisappear === \"partial\" && partial) {\n        close();\n      }\n      if (closeOnDisappear === \"full\" && full) {\n        close();\n      }\n    }\n  }, [\n    relativeParentElement,\n    isOpen,\n    targetElement,\n    scrollParents,\n    fixed,\n    placement\n  ]);\n\n  // call `handlePositioning` when the layer's / targets's\n  // height and / or width changes\n  const resizeObserver = useTrackElementResize(\n    props.ResizeObserver,\n    layerRef,\n    targetElement,\n    isOpen,\n    handlePositioning,\n    environment\n  );\n\n  // On every render, check a few things...\n  useIsomorphicLayoutEffect(() => {\n    /**\n     * A.\n     * Ignore when render is caused by internal style change\n     */\n    const styleIsSetInterally = !isSet(onStyle);\n    const effectBecauseOfInternalStyleChange = styles !== lastStyles.current;\n\n    if (effectBecauseOfInternalStyleChange && styleIsSetInterally) {\n      lastStyles.current = styles;\n      return;\n    }\n\n    // reset `lastStyles` when closed\n    if (!isOpen) {\n      resetLastStyles();\n      return;\n    }\n\n    /**\n     * B.\n     * Prepare to calculate new layer style\n     */\n\n    handlePositioning();\n  });\n\n  // calculate new layer style when window size changes\n  useOnWindowResize(handlePositioning, environment, isOpen);\n\n  // calculate new layer style when user scrolls\n  useOnScroll(scrollParents, handlePositioning, environment, isOpen);\n\n  const outsideClickRefs = React.useRef(\n    new Set<React.RefObject<HTMLElement | null | undefined>>([\n      layerRef,\n      normalTriggerRef\n    ])\n  );\n\n  // handle clicks that are not originated from the trigger / layer\n  // element\n  useOutsideClick(\n    outsideClickRefs,\n    React.useCallback(() => {\n      if (!isOpen) {\n        return;\n      }\n\n      if (closeOnOutsideClick) {\n        close();\n      }\n    }, [isOpen, setOpen, closeOnOutsideClick])\n  );\n\n  const containerElement =\n    typeof container === \"function\" ? container() : container;\n\n  function open({ clientRect, target }: OpenProps) {\n    triggerRectRef.current = clientRect;\n\n    if (isOpen && target === targetElement) {\n      handlePositioning();\n    } else {\n      setTargetRef(target);\n      setOpen(true);\n    }\n  }\n\n  const payload: UseToggleLayerPayload = {\n    isOpen,\n    close,\n    open,\n    openFromContextMenuEvent: evt => {\n      evt.preventDefault();\n      const target = evt.target as HTMLElement;\n\n      const clientRect: ClientRect = {\n        top: evt.clientY,\n        left: evt.clientX,\n        bottom: evt.clientY + 1,\n        right: evt.clientX + 1,\n        width: 1,\n        height: 1\n      };\n\n      open({ clientRect, target });\n    },\n    openFromMouseEvent: evt => {\n      const currentTarget = evt.currentTarget as HTMLElement;\n\n      if (!currentTarget || !currentTarget.getBoundingClientRect) {\n        return;\n      }\n\n      const clientRect = () => currentTarget.getBoundingClientRect();\n\n      open({ clientRect, target: currentTarget });\n    },\n\n    openFromRef: (ref: React.MutableRefObject<any>) => {\n      if (!ref.current) {\n        console.error(\n          `Error inside useTooltip(): Expected a valid ref to a trigger element, but got ${typeof ref.current}`\n        );\n        return;\n      }\n      open({\n        target: ref.current,\n        clientRect: ref.current!.getBoundingClientRect()\n      });\n    },\n\n    openFromSelection: selection => {\n      if (!selection.anchorNode || selection.isCollapsed) {\n        return;\n      }\n\n      const element = getElementFromAnchorNode(selection.anchorNode);\n\n      if (!element) {\n        return;\n      }\n\n      const range = selection.getRangeAt(0);\n\n      open({\n        clientRect: () => range.getBoundingClientRect(),\n        target: element\n      });\n    },\n\n    layerSide: isOpen ? styles.layerSide : null\n  };\n\n  const element =\n    relativeParentElement &&\n    createPortal(\n      renderLayer({\n        layerProps: {\n          ref: element => {\n            if (element) {\n              // observe the layer for resizing\n              // it's ok to observe the same element multiple times\n              // since multiple observes of same element are ignored\n              resizeObserver.observe(element!);\n            }\n\n            layerRef.current = element;\n          },\n          style: {\n            ...(isSet(onStyle) ? EMPTY_STYLE : styles.layer),\n            position: fixed ? \"fixed\" : \"absolute\",\n            willChange: \"top, bottom, left, right, width, height\"\n          }\n        },\n        arrowStyle: {\n          ...(isSet(onStyle) ? EMPTY_STYLE : styles.arrow),\n          position: \"absolute\",\n          willChange: \"top, bottom, left, right\"\n        },\n        isOpen,\n        layerSide: styles.layerSide,\n        triggerRect: getTriggerRect(),\n        close: () => {\n          close();\n        }\n      }),\n      containerElement || relativeParentElement\n    );\n\n  return [\n    <OutsideClickGroupProvider refs={outsideClickRefs}>\n      {element}\n    </OutsideClickGroupProvider>,\n    payload\n  ] as [React.ReactElement<any>, UseToggleLayerPayload];\n}\n","import * as React from \"react\";\n\nexport interface HoverOptions {\n  delayEnter?: number;\n  delayLeave?: number;\n  hideOnScroll?: boolean;\n}\n\nexport interface CallbackHoverOptions extends HoverOptions {\n  onShow: () => void;\n  onHide?: () => void;\n}\n\nexport type HoverProps = {\n  onMouseEnter: () => void;\n  onMouseLeave: () => void;\n  onTouchStart: () => void;\n  onTouchMove: () => void;\n  onTouchEnd: () => void;\n};\n\ntype TimeoutState = \"entering\" | \"leaving\" | null;\n\nfunction useHover(config?: HoverOptions): readonly [boolean, HoverProps];\nfunction useHover(config?: CallbackHoverOptions): HoverProps;\nfunction useHover(config?: any): any {\n  const {\n    delayEnter = 0,\n    delayLeave = 0,\n    hideOnScroll = true,\n    onShow,\n    onHide\n  } = (config || {}) as CallbackHoverOptions;\n\n  const [show, setShow] = React.useState(false);\n  const timeoutRef = React.useRef<number | null>(null);\n\n  const timeoutState = React.useRef<TimeoutState>(null);\n\n  const hasTouchMoved = React.useRef<boolean>(false);\n\n  function handleShowHide(show: boolean) {\n    if (show) {\n      if (onShow) {\n        onShow();\n      }\n\n      setShow(true);\n      return;\n    }\n\n    if (onHide) {\n      onHide();\n    }\n\n    setShow(false);\n  }\n\n  function onMouseEnter() {\n    // if was leaving, stop leaving\n    if (timeoutState.current === \"leaving\" && timeoutRef.current) {\n      clearTimeout(timeoutRef.current);\n      timeoutRef.current = null;\n      timeoutState.current = null;\n    }\n\n    if (show) {\n      return;\n    }\n\n    timeoutState.current = \"entering\";\n    timeoutRef.current = setTimeout(() => {\n      handleShowHide(true);\n      timeoutRef.current = null;\n      timeoutState.current = null;\n    }, delayEnter) as any;\n  }\n\n  function onMouseLeave() {\n    // if was waiting for entering,\n    // clear timeout\n    if (timeoutState.current === \"entering\" && timeoutRef.current) {\n      clearTimeout(timeoutRef.current);\n      timeoutRef.current = null;\n    }\n\n    if (!show) {\n      return;\n    }\n\n    timeoutState.current = \"leaving\";\n    timeoutRef.current = setTimeout(() => {\n      handleShowHide(false);\n      timeoutRef.current = null;\n    }, delayLeave) as any;\n  }\n\n  // make sure to clear timeout on unmount\n  React.useEffect(() => {\n    const to = timeoutRef.current;\n\n    function clear() {\n      if (timeoutRef.current) {\n        clearTimeout(timeoutRef.current);\n        timeoutRef.current = null;\n      }\n    }\n\n    function onScroll() {\n      if (show && hideOnScroll) {\n        clear();\n        handleShowHide(false);\n      }\n    }\n\n    function onTouchEnd() {\n      if (show) {\n        clear();\n        handleShowHide(false);\n      }\n    }\n\n    window.addEventListener(\"scroll\", onScroll, true);\n    window.addEventListener(\"touchend\", onTouchEnd, true);\n\n    return () => {\n      window.removeEventListener(\"scroll\", onScroll, true);\n      window.removeEventListener(\"touchend\", onTouchEnd, true);\n\n      if (to) {\n        clearTimeout(to);\n      }\n    };\n  }, [show, hideOnScroll]);\n\n  const hoverProps: HoverProps = {\n    onMouseEnter,\n    onMouseLeave,\n    onTouchStart: () => {\n      hasTouchMoved.current = false;\n    },\n    onTouchMove: () => {\n      hasTouchMoved.current = true;\n    },\n    onTouchEnd: () => {\n      if (!hasTouchMoved.current && !show) {\n        handleShowHide(true);\n      }\n\n      hasTouchMoved.current = false;\n    }\n  };\n\n  // @ts-ignore\n  if (onShow) {\n    return hoverProps;\n  }\n\n  return [show, hoverProps] as const;\n}\n\nexport default useHover;\n","import * as React from \"react\";\n\nexport default function useBreakpoint(maxPixels: number) {\n  const [match, setMatch] = React.useState(\n    typeof window !== \"undefined\"\n      ? window.matchMedia(`(max-width: ${maxPixels}px)`).matches\n      : false\n  );\n\n  React.useEffect(() => {\n    const matcher = window.matchMedia(`(max-width: ${maxPixels}px)`);\n\n    function onMatch(evt: MediaQueryListEvent) {\n      setMatch(evt.matches);\n    }\n\n    matcher.addListener(onMatch);\n\n    return () => {\n      matcher.removeListener(onMatch);\n    };\n  }, [maxPixels]);\n\n  return match;\n}\n","import * as React from \"react\";\n\nexport type TransitionProps = {\n  isOpen: boolean;\n  children: (\n    isOpen: boolean,\n    onTransitionEnd: any,\n    isLeaving: boolean\n  ) => React.ReactElement;\n};\n\nexport default function Transition({\n  isOpen: isOpenExternal,\n  children\n}: TransitionProps) {\n  const [state, setState] = React.useState({\n    isOpenInternal: isOpenExternal,\n    isLeaving: false\n  });\n\n  const didMount = React.useRef(false);\n\n  React.useEffect(() => {\n    if (isOpenExternal) {\n      setState({\n        isOpenInternal: true,\n        isLeaving: false\n      });\n    } else if (didMount.current) {\n      setState({\n        isOpenInternal: false,\n        isLeaving: true\n      });\n    }\n  }, [isOpenExternal, setState]);\n\n  React.useEffect(() => {\n    didMount.current = true;\n  }, []);\n\n  if (!isOpenExternal && !state.isOpenInternal && !state.isLeaving) {\n    return null;\n  }\n\n  return children(\n    state.isOpenInternal,\n    () => {\n      if (!state.isOpenInternal) {\n        setState(s => ({ ...s, isLeaving: false }));\n      }\n    },\n    state.isLeaving\n  );\n}\n","import * as React from \"react\";\n\nimport useHover, { HoverOptions } from \"./useHover\";\nimport useToggleLayer from \"./ToggleLayer/useToggleLayer\";\nimport { ToggleLayerOptions, RenderLayer } from \"./ToggleLayer/types\";\n\nexport type TooltipOptions = HoverOptions & ToggleLayerOptions;\n\nexport default function useTooltip(\n  renderLayer: RenderLayer,\n  { delayEnter, delayLeave, hideOnScroll, ...rest }: TooltipOptions = {}\n) {\n  const triggerRef = React.useRef<any>();\n\n  const [element, { openFromRef, close }] = useToggleLayer(renderLayer, rest);\n\n  const hoverProps = useHover({\n    delayEnter,\n    delayLeave,\n    hideOnScroll,\n    onShow: () => openFromRef(triggerRef),\n    onHide: close\n  });\n\n  const triggerProps = {\n    ref: triggerRef,\n    ...hoverProps\n  };\n\n  return [element, triggerProps] as const;\n}\n"],"names":["useEvent","element","event","callback","enabled","capture","React","cb","el","Array","isArray","ev","forEach","e","addEventListener","removeEventListener","OutsideClickContext","createContext","isChildOf","parent","target","hasChildren","children","length","i","child","OutsideClickGroupProvider","refs","isPartOfGroup","useContext","useCallback","layerRef","current","add","useRegisterGroup","registerRefToGroup","useEffect","values","useOutsideClick","events","useState","document","evt","ref","useOnScroll","elements","onScroll","environment","trackScroll","memoElements","useOnWindowResize","onResize","trackResize","useIsomorphicLayoutEffect","window","useTrackElementResize","injectedResizeObserver","triggerElement","isOpen","callbackRef","ResizeObserver","Error","resizeObserver","observe","unobserve","disconnect","EMPTY_STYLE","isSet","value","undefined","areStylesTheSame","a","b","aKeys","Object","keys","bKeys","Math","max","key","shouldUpdateStyles","prev","next","layer","arrow","getWindowClientRect","top","left","right","innerWidth","bottom","innerHeight","height","width","convertFloat","parseFloat","replace","getContentBox","boxSizing","borderLeft","borderRight","borderTop","borderBottom","paddingLeft","paddingRight","paddingTop","paddingBottom","getComputedStyle","reduce","total","clientRectToObject","clientRect","getElementFromAnchorNode","anchorNode","currentElement","getBoundingClientRect","parentElement","minMax","min","useStyleState","anchor","INITIAL_STYLES","layerSide","split","toLowerCase","styles","setStyles","lastStyles","resetLastStyles","Anchor","BOTTOM_LEFT","BOTTOM_RIGHT","BOTTOM_CENTER","TOP_LEFT","TOP_CENTER","TOP_RIGHT","LEFT_BOTTOM","LEFT_CENTER","LEFT_TOP","RIGHT_BOTTOM","RIGHT_CENTER","RIGHT_TOP","POSSIBLE_ANCHORS","getPrimaryDirection","startsWith","primaryIsY","primary","getPrimaryByIndex","index","preferedPrimary","preferedX","preferedY","prefferedIsY","filter","x","getSecondaryByIndex","preferedSecondary","rects","triggerHasBiggerHeight","trigger","triggerHasBiggerWidth","getSecondaryAnchorOptionsByPrimary","anchorOptions","splitAnchor","secondary","getLayerSideByAnchor","getAnchorPriority","preferedAnchor","possibleAnchors","anchors","map","_","indexOf","getPrimaryStyle","scroll","triggerOffset","prop","size","relativeParent","getCenter","offsetSecondary","getLimits","topBase","leftBase","getSecondaryStyle","primaryDirection","getAbsolutePositions","scrollLeft","scrollTop","fixLayerDimensions","originalLayer","layerDimensions","dimensions","propMap","TOP","side1","side2","factor","BOTTOM","LEFT","RIGHT","getPrimaryRect","getSecondaryRect","getLayerRectByAnchor","scrollOffset","primaryRect","secondaryRect","layerRect","result","ALL_OFFSET_SIDES","getLayerOffsetsToParent","getLayerOffsetsToParents","parents","isLayerCompletelyInvisible","some","doesEntireLayerFitWithinScrollParents","parentOffsets","every","offsets","side","reduceOffsets","parentOffsetsCombined","sort","getNegativeOffsetSides","getVisibleLayerSurface","rect","affectedProperty","getVisibleLayerSurfaceWithinScrollParent","surfaces","doesAnchorFitWithinScrollParents","scrollParents","getLayerOffsetsToScrollParentsByAnchor","triggerIsBiggerThanLayer","getOffsetSurface","primarySize","secondarySize","findAnchorByLayerSurface","surface","offsetSurface","square","findBestSuitableAnchor","find","getSecondaryOffsetSide","currentAnchor","firstAnchorThatDoesNotFit","sides","findSecondaryOffset","secondaryAnchorOptions","currentAnchorHasHighestPriority","currentAnchorFits","affectedSide","currentOffsets","secondaryOffset","triggerIsBigger","isCenter","includes","isLeft","isTop","getOffsets","getArrowStyle","limitsDefault","getAbsoluteStyle","autoAdjust","snapToAnchor","possibleAnchorsByPriority","getSuitableAnchor","getSecondaryOffset","layerStyle","compensateScrollbars","clientWidth","clientHeight","scrollbarWidth","scrollbarHeight","getArrowRect","layerElement","arrowOffset","arrowElement","querySelector","defaultPlacement","preferX","preferY","getPositioning","triggerRect","relativeParentElement","placement","fixed","scrollParentRects","options","body","layerBox","arrowStyle","useElementRef","initialState","elementToState","state","setState","lastElement","setRef","node","findScrollContainers","overflow","overflowX","overflowY","push","useElementState","container","style","position","process","env","NODE_ENV","containerElement","shouldWarnAboutPositionStyle","console","error","useIsOpen","internal","external","shouldOpenAfterMount","rerenderAfterMount","ToggleLayer","renderLayer","onStyle","isOpenExternal","closeOnOutsideClick","onOutsideClick","onDisappear","closeOnDisappear","props","triggerRef","normalTriggerRef","isOpenInternal","setOpenInternal","handlePositioning","hasOnDisappear","shouldCloseOnDisappear","allScrollParents","partial","full","styleIsSetInterally","effectBecauseOfInternalStyleChange","outsideClickRefs","Set","React.createElement","close","open","toggle","createPortal","layerProps","willChange","getWidthBasedOnAngle","angle","tan","PI","getViewBox","sizeA","sizeB","borderWidth","getTrianglePath","roundness","relativeRoundness","A","B","cPoint","c1A","c1B","C","d1A","d1B","D","getBorderMaskPath","borderOffset","Arrow","borderColor","backgroundColor","transform","useToggleLayer","setTargetRef","targetElement","triggerRectRef","getTriggerRect","setOpen","payload","openFromContextMenuEvent","preventDefault","clientY","clientX","openFromMouseEvent","currentTarget","openFromRef","openFromSelection","selection","isCollapsed","range","getRangeAt","useHover","config","delayEnter","delayLeave","hideOnScroll","onShow","onHide","show","setShow","timeoutRef","timeoutState","hasTouchMoved","handleShowHide","onMouseEnter","clearTimeout","setTimeout","onMouseLeave","to","clear","onTouchEnd","hoverProps","onTouchStart","onTouchMove","useBreakpoint","maxPixels","match","setMatch","matchMedia","matches","matcher","onMatch","addListener","removeListener","Transition","isLeaving","didMount","s","useTooltip","rest","triggerProps"],"mappings":"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"}