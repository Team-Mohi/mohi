import React,{useEffect,useMemo,useLayoutEffect,useRef,useState,useCallback,createElement,Fragment}from"react";import{createPortal}from"react-dom";function useEvent(e,t,r,n=!0,o=!1){return useEffect(()=>{if(!n||!e)return;const i=r,s=Array.isArray(e)?e:[e],l=Array.isArray(t)?t:[t];return s.forEach(e=>{l.forEach(t=>{e.addEventListener(t,i,o)})}),()=>{s.forEach(e=>{l.forEach(t=>{e.removeEventListener(t,i,o)})})}},[r,e,n,t,o])}const OutsideClickContext=React.createContext({});function isChildOf(e,t){if(e===t)return!0;if(e.children&&e.children.length>0)for(let r=0;r<e.children.length;r++){const n=e.children[r];if(n&&isChildOf(n,t))return!0}return!1}function OutsideClickGroupProvider({refs:e,children:t}){return"function"==typeof React.useContext(OutsideClickContext)?t:React.createElement(OutsideClickContext.Provider,{value:React.useCallback(t=>{e.current.add(t)},[])},t)}function useRegisterGroup(e){const t=React.useContext(OutsideClickContext);React.useEffect(()=>{const[r]=e.current.values();"function"==typeof t&&r&&t(r)},[t,e])}function useOutsideClick(e,t){const[r]=React.useState(["click"]);useRegisterGroup(e),useEvent("undefined"!=typeof document?document:null,r,React.useCallback(r=>{for(const t of e.current)if(t.current&&isChildOf(t.current,r.target))return;t()},[t]),!0,!0)}function useOnScroll(e,t,r,n=!0){useEvent(useMemo(()=>void 0!==r?[r,...e]:[],[e]),"scroll",t,n)}function useOnWindowResize(e,t,r=!0){useEvent(void 0!==t?t:null,"resize",e,r)}const useIsomorphicLayoutEffect="undefined"!=typeof window?useLayoutEffect:useEffect;function useTrackElementResize(e,t,r,n,o,i){const s=useRef(o);s.current=o;const l=e||(void 0===i?class{}:i.ResizeObserver);if(!l)throw new Error("This browser does not support `ResizeObserver` out of the box. Please provide a polyfill as a prop.");const c=useRef(new l(()=>{t.current&&s.current()}));return useIsomorphicLayoutEffect(()=>{n?r&&c.current.observe(r):(r&&c.current.unobserve(r),t.current&&c.current.unobserve(t.current))},[n,r]),useEffect(()=>()=>{c.current.disconnect()},[]),c.current}const EMPTY_STYLE={};function isSet(e){return void 0!==e&&null!==e}function areStylesTheSame(e,t){const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(let o=0;o<Math.max(r.length,n.length);o++){const i=r[o]||n[o];if(e[i]!==t[i])return!1}return!0}function shouldUpdateStyles(e,t){return!areStylesTheSame(e.layer,t.layer)||!areStylesTheSame(e.arrow,t.arrow)}function getWindowClientRect(e){return{top:0,left:0,right:e?e.innerWidth:0,bottom:e?e.innerHeight:0,height:e?e.innerHeight:0,width:e?e.innerWidth:0}}const convertFloat=e=>parseFloat(e.replace("px",""));function getContentBox(e,t){if(!t)return{width:0,height:0};const{width:r,height:n,boxSizing:o,borderLeft:i,borderRight:s,borderTop:l,borderBottom:c,paddingLeft:a,paddingRight:u,paddingTop:f,paddingBottom:g}=t.getComputedStyle(e);return{width:"border-box"===o?convertFloat(r):[r,i,s,a,u].reduce((e,t)=>e+(t?convertFloat(t):0),0),height:"border-box"===o?convertFloat(n):[n,l,c,f,g].reduce((e,t)=>e+(t?convertFloat(t):0),0)}}function clientRectToObject(e){return{top:e.top,left:e.left,right:e.right,bottom:e.bottom,width:e.width,height:e.height}}function getElementFromAnchorNode(e){let t=e;for(;!t.getBoundingClientRect;){if(!t.parentElement)return null;t=t.parentElement}return t}function minMax(e,{min:t,max:r}){return e<t?t:e>r?r:e}function useStyleState(e){const[t]=useState({layer:EMPTY_STYLE,arrow:EMPTY_STYLE,layerSide:e.split("_")[0].toLowerCase()}),[r,n]=useState(t),o=useRef(r);return{styles:r,lastStyles:o,setStyles:n,resetLastStyles:()=>{o.current=t}}}const Anchor={BOTTOM_LEFT:"BOTTOM_LEFT",BOTTOM_RIGHT:"BOTTOM_RIGHT",BOTTOM_CENTER:"BOTTOM_CENTER",TOP_LEFT:"TOP_LEFT",TOP_CENTER:"TOP_CENTER",TOP_RIGHT:"TOP_RIGHT",LEFT_BOTTOM:"LEFT_BOTTOM",LEFT_CENTER:"LEFT_CENTER",LEFT_TOP:"LEFT_TOP",RIGHT_BOTTOM:"RIGHT_BOTTOM",RIGHT_CENTER:"RIGHT_CENTER",RIGHT_TOP:"RIGHT_TOP"},POSSIBLE_ANCHORS=Object.keys(Anchor);function getPrimaryDirection(e){return e.startsWith("TOP_")||e.startsWith("BOTTOM_")?"Y":"X"}function primaryIsY(e){return"TOP"===e||"BOTTOM"===e}function getPrimaryByIndex(e,t,r,n){const o=primaryIsY(t);return e<3?t:e<6?o?r:n:e<9?o?["LEFT","RIGHT"].filter(e=>e!==r)[0]:["TOP","BOTTOM"].filter(e=>e!==n)[0]:o?["TOP","BOTTOM"].filter(e=>e!==t)[0]:["LEFT","RIGHT"].filter(e=>e!==t)[0]}function getSecondaryByIndex(e,t,r,n){const o=primaryIsY(t),i=n.trigger.height>n.layer.height,s=n.trigger.width>n.layer.width;switch(e){case 9:case 0:return r;case 1:case 10:return"CENTER"===r?o?"RIGHT":"BOTTOM":"CENTER";case 4:case 7:return"CENTER";case 2:case 11:return o?["LEFT","RIGHT"].filter(e=>e!==r)[0]:["TOP","BOTTOM"].filter(e=>e!==r)[0];case 3:case 6:return o?"BOTTOM"===t?i?"BOTTOM":"TOP":i?"TOP":"BOTTOM":"LEFT"===t?s?"LEFT":"RIGHT":s?"RIGHT":"LEFT";case 5:case 8:return o?"BOTTOM"===t?i?"TOP":"BOTTOM":i?"BOTTOM":"TOP":"LEFT"===t?s?"RIGHT":"LEFT":s?"LEFT":"RIGHT"}return"LEFT"}function getSecondaryAnchorOptionsByPrimary(e,t){return t.filter(t=>t.startsWith(e))}function splitAnchor(e){const[t,r]=e.split("_");return{primary:t,secondary:r}}function getLayerSideByAnchor(e){return"CENTER"===e?"center":splitAnchor(e).primary.toLowerCase()}function getAnchorPriority(e,t,r,n,o){const{primary:i,secondary:s}="CENTER"!==e?splitAnchor(e):{primary:n,secondary:"CENTER"};let l=POSSIBLE_ANCHORS.map((e,t)=>getPrimaryByIndex(t,i,r,n)+"_"+getSecondaryByIndex(t,i,s,o)).filter(e=>t.indexOf(e)>-1);return-1===l.indexOf(e)&&(l=[e,...l]),l}function getPrimaryStyle(e,t,r,n){const o="TOP"===e||"BOTTOM"===e?"top":"left",i="TOP"===e||"BOTTOM"===e?"height":"width";return"TOP"===e||"LEFT"===e?{[o]:t.trigger[o]-t.layer[i]-(t.relativeParent[o]-r[o])-n}:{[o]:t.trigger[o]+t.trigger[i]-(t.relativeParent[o]-r[o])+n}}function getCenter(e,t,r,n,o){return minMax(e.trigger[n]-e.relativeParent[n]+t[n]+e.trigger[o]/2-e.layer[o]/2-r,getLimits(e,t)[n])}function getLimits(e,t){const r=e.trigger.top-e.relativeParent.top+t.top,n=e.trigger.left-e.relativeParent.left+t.left;return{top:{min:r-(e.layer.height-e.arrow.height),max:r+(e.trigger.height-e.arrow.height)},left:{min:n-(e.layer.width-e.arrow.width),max:n+(e.trigger.width-e.arrow.width)}}}function getSecondaryStyle(e,t,r,n,o){if("CENTER"===e){const e="X"===o?"top":"left";return{[e]:getCenter(t,r,n,e,"X"===o?"height":"width")}}const i="TOP"===e||"BOTTOM"===e?"top":"left",s="TOP"===e||"BOTTOM"===e?"height":"width";return"TOP"===e||"LEFT"===e?{[i]:minMax(t.trigger[i]-t.relativeParent[i]+r[i]+n,getLimits(t,r)[i])}:{[i]:minMax(t.trigger[i]+t.trigger[s]-t.layer[s]-(t.relativeParent[i]-r[i])-n,getLimits(t,r)[i])}}function getAbsolutePositions({anchor:e,rects:t,triggerOffset:r,offsetSecondary:n,scrollLeft:o,scrollTop:i}){const s={left:o,top:i};if("CENTER"===e)return{top:getCenter(t,s,0,"top","height"),left:getCenter(t,s,0,"left","width")};const{primary:l,secondary:c}=splitAnchor(e),a=getPrimaryDirection(e);return{...getPrimaryStyle(l,t,s,r),...getSecondaryStyle(c,t,s,n,a)}}function fixLayerDimensions(e,t,r){const n="function"==typeof r?r(getLayerSideByAnchor(t)):r;return{...clientRectToObject(e),...n}}const propMap={TOP:{side1:"bottom",side2:"top",size:"height",factor:-1},BOTTOM:{side1:"top",side2:"bottom",size:"height",factor:1},LEFT:{side1:"right",side2:"left",size:"width",factor:-1},RIGHT:{side1:"left",side2:"right",size:"width",factor:1}};function getPrimaryRect(e,t,r,n){const{side1:o,side2:i,size:s,factor:l}=propMap[e],c=t[i]+n*l;return{[o]:c,[i]:c+r[s]*l}}function getCenter$1(e,t,r,n,o){const i=e[n]+e[o]/2-t[o]/2-r;return{[n]:i,["left"===n?"right":"bottom"]:i+t[o]}}function getSecondaryRect(e,t,r,n,o){if("CENTER"===e){return getCenter$1(t,r,n,"X"===o?"top":"left","X"===o?"height":"width")}const{side1:i,side2:s,size:l,factor:c}=propMap[e],a=t[s]-n*c;return{[s]:a,[i]:a-r[l]*c}}function getLayerRectByAnchor({trigger:e,layer:t,anchor:r,triggerOffset:n,scrollOffset:o=0,offsetSecondary:i=0,layerDimensions:s}){let l,c;const a=s?fixLayerDimensions(t,r,s):t;if("CENTER"===r)l=getCenter$1(e,a,0,"top","height"),c=getCenter$1(e,a,0,"left","width");else{const{primary:t,secondary:o}=splitAnchor(r),s=getPrimaryDirection(r);l=getPrimaryRect(t,e,a,n),c=getSecondaryRect(o,e,a,i,s)}const u={...a,...l,...c};return u.top=u.top-o,u.right=u.right+o,u.left=u.left-o,u.bottom=u.bottom+o,u}const ALL_OFFSET_SIDES=["bottom","top","left","right"];function getLayerOffsetsToParent(e,t){return{top:e.top-t.top,bottom:t.bottom-e.bottom,left:e.left-t.left,right:t.right-e.right}}function getLayerOffsetsToParents(e,t){return t.map(t=>getLayerOffsetsToParent(e,t))}function isLayerCompletelyInvisible(e,t){return t.some(t=>e.bottom<=t.top||e.right<=t.left||e.top>=t.bottom||e.left>=t.right)}function doesEntireLayerFitWithinScrollParents(e,t){return getLayerOffsetsToParents(e,t).every(e=>ALL_OFFSET_SIDES.every(t=>e[t]>=0))}function reduceOffsets(e){const t=e.reduce((e,t)=>(ALL_OFFSET_SIDES.forEach(r=>{e[r]=[...e[r],t[r]]}),e),{top:[],bottom:[],left:[],right:[]});return ALL_OFFSET_SIDES.reduce((e,r)=>(e[r]=t[r].sort((e,t)=>e-t)[0],e),{})}function getNegativeOffsetSides(e){const t=reduceOffsets(e);return ALL_OFFSET_SIDES.filter(e=>t[e]<0)}function getVisibleLayerSurface(e,t){const r=getLayerOffsetsToParent(e,t),{width:n,height:o}=ALL_OFFSET_SIDES.filter(e=>r[e]<0).reduce((e,t)=>{const n="top"===t||"bottom"===t?"height":"width";return{...e,[n]:e[n]+r[t]}},e),i=n*o;return n<0&&o<0?-i:i}function getVisibleLayerSurfaceWithinScrollParent(e,t){return t.map(t=>getVisibleLayerSurface(e,t)).sort((e,t)=>e-t)[0]}function doesAnchorFitWithinScrollParents(e,t,r,n,o){return doesEntireLayerFitWithinScrollParents(getLayerRectByAnchor({anchor:e,trigger:t.trigger,layer:t.layer,triggerOffset:r,scrollOffset:n,layerDimensions:o}),t.scrollParents)}function getLayerOffsetsToScrollParentsByAnchor(e,t,r,n){return getLayerOffsetsToParents(getLayerRectByAnchor({anchor:e,trigger:t.trigger,layer:t.layer,triggerOffset:r,scrollOffset:n,layerDimensions:null}),t.scrollParents)}function triggerIsBiggerThanLayer(e,t,r){return("top"===e||"bottom"===e)&&r.width>t.width||("left"===e||"right"===e)&&r.height>t.height}function getOffsetSurface(e,t,r,n){const o=getPrimaryDirection(e);return(t["X"===o?"width":"height"]-r-2*n)*(t["X"===o?"height":"width"]-r-2*n)}function findAnchorByLayerSurface(e,t,r,n,o){return t.map(t=>{const i=getLayerRectByAnchor({anchor:t,layer:e.layer,trigger:e.trigger,scrollOffset:n,triggerOffset:r,layerDimensions:o});return{anchor:t,square:getVisibleLayerSurfaceWithinScrollParent(i,e.scrollParents)-getOffsetSurface(t,i,r,n)}}).sort((e,t)=>t.square-e.square)[0].anchor}function findBestSuitableAnchor(e,t,r,n,o){const i=t.find(t=>doesAnchorFitWithinScrollParents(t,e,r,n,o));return i||findAnchorByLayerSurface(e,t,r,n,o)}function getSecondaryOffsetSide(e,t,r,n,o){const i=getPrimaryDirection(e);return getNegativeOffsetSides(getLayerOffsetsToScrollParentsByAnchor(t,r,n,o)).find(e=>"X"===i?"top"===e||"bottom"===e:"left"===e||"right"===e)}function findSecondaryOffset(e,t,r,n,o){const{primary:i}=splitAnchor(e),s=getSecondaryAnchorOptionsByPrimary(i,t),l=0===s.indexOf(e),c=doesAnchorFitWithinScrollParents(e,r,n,o,null);if(l&&c)return 0;const a=getSecondaryOffsetSide(e,s.find(e=>!doesAnchorFitWithinScrollParents(e,r,n,o,null)),r,n,o);if(!a)return 0;let u=-reduceOffsets(getLayerOffsetsToScrollParentsByAnchor(e,r,n,o))[a];const f=triggerIsBiggerThanLayer(getLayerSideByAnchor(e),r.layer,r.trigger),g=e.includes("_CENTER"),h=e.includes("_LEFT"),d=e.includes("_TOP");return f&&(h&&"right"===a||"left"===a||d&&"bottom"===a||"top"===a)?u=-u:f||!g||"top"!==a&&"left"!==a||(u=-u),u}function getOffsets(e,t,r){const n=e.left+e.width/2-t.left-r.width/2,o=e.right-e.width/2-t.right+r.width/2,i=e.top+e.height/2-t.top-r.height/2,s=e.bottom-e.height/2-t.bottom+r.height/2;return{left:n<0?-n:0,right:o>0?-o:0,top:i<0?-i:0,bottom:s>0?-s:0}}function getArrowStyle(e,t,r,n){const o=triggerIsBiggerThanLayer(r,e,t),i={left:{min:n.width/2,max:e.width-n.width/2},top:{min:n.height/2,max:e.height-n.height/2}},s=getOffsets(e,t,n);return"bottom"===r?{bottom:"100%",top:null,left:minMax(o?e.width/2+(s.left+s.right):t.left+t.width/2-e.left,i.left),right:null}:"right"===r?{right:"100%",left:null,top:minMax(o?e.height/2+(s.top+s.bottom):t.top+t.height/2-e.top,i.top),bottom:null}:"top"===r?{top:"100%",bottom:null,left:minMax(o?e.width/2+(s.left+s.right):t.left+t.width/2-e.left,i.left),right:null}:{left:"100%",right:null,top:minMax(o?e.height/2+(s.top+s.bottom):t.top+t.height/2-e.top,i.top),bottom:null}}function getAbsoluteStyle({rects:e,scrollTop:t,scrollLeft:r,triggerOffset:n,scrollOffset:o,possibleAnchors:i,preferedAnchor:s,preferedX:l,preferedY:c,autoAdjust:a,snapToAnchor:u,layerDimensions:f}){const g=getAnchorPriority(s,i,l,c,e),h=a?findBestSuitableAnchor(e,g,n,o,f):s,d=a&&!u&&"CENTER"!==h?findSecondaryOffset(h,g,e,n,o):0,y=getAbsolutePositions({anchor:h,rects:e,triggerOffset:n,offsetSecondary:d,scrollLeft:r,scrollTop:t}),p=getLayerRectByAnchor({anchor:h,trigger:e.trigger,layer:e.layer,triggerOffset:n,offsetSecondary:d,layerDimensions:f});return f&&(y.width=p.width,y.height=p.height),{layerStyle:y,layerRect:p,anchor:h}}function compensateScrollbars(e,t,r){const n=e.width-t,o=e.height-r;return{left:e.left,top:e.top,width:e.width-n,right:e.right-n,height:e.height-o,bottom:e.bottom-o}}function getArrowRect(e,t){const r=e.querySelector("[data-arrow]");if(!r)return{top:0,bottom:0,left:0,right:0,width:0,height:0};const n=r.getBoundingClientRect();return{...clientRectToObject(n),width:n.width+2*t,height:n.height+2*t}}const defaultPlacement={autoAdjust:!1,snapToAnchor:!1,anchor:"TOP_CENTER",layerDimensions:null,possibleAnchors:POSSIBLE_ANCHORS,preferX:"RIGHT",preferY:"BOTTOM",scrollOffset:10,triggerOffset:0,arrowOffset:0};function getPositioning({triggerRect:e,layerElement:t,relativeParentElement:r,scrollParents:n,placement:o={},environment:i,fixed:s}){if(0===e.height)return;if(!t)return;const l=s?[getWindowClientRect(i)]:[...n.map(e=>compensateScrollbars(e.getBoundingClientRect(),e.clientWidth,e.clientHeight)),getWindowClientRect(i)],c={autoAdjust:o.autoAdjust||defaultPlacement.autoAdjust,snapToAnchor:o.snapToAnchor||defaultPlacement.snapToAnchor,triggerOffset:isSet(o.triggerOffset)?o.triggerOffset:defaultPlacement.triggerOffset,scrollOffset:isSet(o.scrollOffset)?o.scrollOffset:defaultPlacement.scrollOffset,possibleAnchors:o.possibleAnchors||defaultPlacement.possibleAnchors,preferedAnchor:o.anchor||defaultPlacement.anchor,preferedX:o.preferX||defaultPlacement.preferX,preferedY:o.preferY||defaultPlacement.preferY,scrollLeft:r===document.body?0:r.scrollLeft,scrollTop:r===document.body?0:r.scrollTop,relativeParentElement:r,layerDimensions:o.layerDimensions||defaultPlacement.layerDimensions},a=t.getBoundingClientRect(),u={layer:{top:a.top,left:a.left,right:a.right,bottom:a.bottom,...getContentBox(t,i)},relativeParent:r.getBoundingClientRect(),scrollParents:l,trigger:e,arrow:getArrowRect(t,o.arrowOffset||defaultPlacement.arrowOffset)},{layerRect:f,layerStyle:g,anchor:h}=getAbsoluteStyle({rects:u,...c});s&&(g.top=f.top,g.left=f.left);const d=getLayerSideByAnchor(h);return{styles:{layer:g,arrow:"CENTER"===h?EMPTY_STYLE:getArrowStyle(f,e,d,u.arrow),layerSide:d},layerRect:f}}function useElementRef(e,t){const[r,n]=useState(e||null),o=useRef(null);return[useCallback(e=>{e&&e!==o.current&&(o.current=e,n(t?t(e):e))},[]),r,o]}function findScrollContainers(e,t){const r=[];if(!e||!t)return r;if(e===document.body)return r;const{overflow:n,overflowX:o,overflowY:i}=t.getComputedStyle(e);return[n,o,i].some(e=>"auto"===e||"scroll"===e)&&r.push(e),[...r,...findScrollContainers(e.parentElement,t)]}function useElementState(e,t,r){return useElementRef({triggerElement:null,relativeParentElement:null,scrollParents:[]},useCallback(n=>{const o=findScrollContainers(n,r),i=o[0]||document.body;if(i===document.body)document.body.style.position="relative";else if("development"===process.env.NODE_ENV&&r){const n="function"==typeof e?e():e,o=r.getComputedStyle(i).position;"relative"!==o&&"absolute"!==o&&"fixed"!==o&&!t&&!n&&console.error("react-laag: Set the 'position' style of the nearest scroll-container to 'relative', 'absolute' or 'fixed', or set the 'fixed' prop to true. This is needed in order to position the layers properly. Currently the scroll-container is positioned: \""+o+'". Visit https://react-laag.com/docs/#position-relative for more info.',i)}return{triggerElement:n,relativeParentElement:i,scrollParents:o}},[]))}function useIsOpen(e,t){const r=useRef(t),n=!r.current&&(isSet(t)?t:e),o=useState(!1)[1];return useEffect(()=>{r.current&&(r.current=!1,o(!0))},[]),n}const ToggleLayer=({children:e,renderLayer:t,placement:r={},onStyle:n,isOpen:o,closeOnOutsideClick:i,onOutsideClick:s,onDisappear:l,closeOnDisappear:c,fixed:a,container:u,environment:f=("undefined"!=typeof window?window:void 0),...g})=>{const[h,{relativeParentElement:d,triggerElement:y,scrollParents:p},m]=useElementState(u,a,f),{styles:T,setStyles:O,lastStyles:S,resetLastStyles:E}=useStyleState(r.anchor||defaultPlacement.anchor),w=useRef(null),[R,P]=useState(!1),L=useIsOpen(R,o),b=useCallback(()=>{if(!y)throw new Error("Could not find a valid reference of the trigger element. See https://www.react-laag.com/docs/togglelayer/#children for more info.");const e=y.getBoundingClientRect(),t=getPositioning({triggerRect:e,layerElement:w.current,placement:r,relativeParentElement:d,scrollParents:p,fixed:a,environment:f});if(!t)return;const{layerRect:i,styles:s}=t;shouldUpdateStyles(S.current,s)&&(isSet(n)?(S.current=s,n(s.layer,s.arrow,s.layerSide)):O(s));const u=isSet(l),g=c&&!isSet(o);if(u||g){const t=[...p.map(e=>e.getBoundingClientRect()),getWindowClientRect(f)],r=!doesEntireLayerFitWithinScrollParents(a?e:i,t),n=isLayerCompletelyInvisible(a?e:i,t);u?(r||n)&&l(n?"full":"partial"):("partial"===c&&r&&P(!1),"full"===c&&n&&P(!1))}},[d,L,y,p,a,r]),C=useTrackElementResize(g.ResizeObserver,w,y,L,b,f);useIsomorphicLayoutEffect(()=>{const e=!isSet(n);T!==S.current&&e?S.current=T:L?b():E()}),useOnWindowResize(b,f,L),useOnScroll(p,b,f,L);const v=useRef(new Set([w,m]));useOutsideClick(v,useCallback(()=>{L&&(s&&s(),i&&!isSet(o)&&P(!1))},[L,P,o,s]));const B="function"==typeof u?u():u;return createElement(Fragment,null,e({isOpen:L,close:()=>{if(isSet(o))throw new Error("You cannot call `close()` while using the `isOpen` prop");P(!1)},open:()=>{if(isSet(o))throw new Error("You cannot call `open()` while using the `isOpen` prop");P(!0)},toggle:()=>{if(isSet(o))throw new Error("You cannot call `toggle()` while using the `isOpen` prop");P(!R)},triggerRef:h,layerSide:L?T.layerSide:null}),d&&createElement(OutsideClickGroupProvider,{refs:v},createPortal(t({layerProps:{ref:e=>{e&&C.observe(e),w.current=e},style:{...isSet(n)?EMPTY_STYLE:T.layer,position:a?"fixed":"absolute",willChange:"top, bottom, left, right, width, height"}},arrowStyle:{...isSet(n)?EMPTY_STYLE:T.arrow,position:"absolute",willChange:"top, bottom, left, right"},isOpen:L,layerSide:T.layerSide,triggerRect:y?y.getBoundingClientRect():null,close:()=>{if(isSet(o))throw new Error("You cannot call `close()` while using the `isOpen` prop");P(!1)}}),B||d)))};function getWidthBasedOnAngle(e,t){return Math.tan(e*(Math.PI/180))*t}function getViewBox(e,t,r,n){switch(r){case"bottom":return"0 "+-n+" "+t+" "+e;case"top":return"0 0 "+t+" "+(e+n);case"right":return-n+" 0 "+e+" "+t;case"left":return"0 0 "+(e+n)+" "+t}return""}function getTrianglePath({sizeA:e,sizeB:t,layerSide:r,roundness:n,angle:o}){const i=n/10*e*2,s="bottom"===r?"0 "+e:"top"===r?"0 0":"right"===r?e+" "+t:"0 "+t,l=("bottom"===r||"top"===r?"H":"V")+" "+("bottom"===r||"top"===r?t:0),c=t/2,a=t/2+getWidthBasedOnAngle(o,e/8),u=e/8,f="bottom"===r?"C "+a+" "+u+" "+(c+i)+" 0 "+c+" 0":"top"===r?"C "+a+" "+(e-u)+" "+(c+i)+" "+e+" "+c+" "+e:"right"===r?"C "+u+" "+(t-a)+" 0 "+(c-i)+" 0 "+c:"C "+(e-u)+" "+(t-a)+" "+e+" "+(c-i)+" "+e+" "+c,g=t/2-getWidthBasedOnAngle(o,e/8),h=e/8;return"M "+s+" "+l+" "+f+" "+("bottom"===r?"C "+(c-i)+" 0 "+g+" "+h+" "+s:"top"===r?"C "+(c-i)+" "+e+" "+g+" "+(e-h)+" "+s:"right"===r?"C 0 "+(c+i)+" "+h+" "+(t-g)+" "+s:"C"+e+" "+(c+i)+" "+(e-h)+" "+(t-g)+" "+s)}function getBorderMaskPath({sizeA:e,sizeB:t,borderWidth:r,layerSide:n,angle:o}){const i=getWidthBasedOnAngle(o,r);return"bottom"===n||"top"===n?"M "+r+" "+("bottom"===n?e:0)+" H "+(t-r)+" L "+(t-r-i)+" "+("bottom"===n?e-r:r)+" H "+(i+r)+" Z":"M "+("right"===n?e:0)+" "+r+" V "+(t-r)+" L "+("right"===n?e-r:r)+" "+(t-r-i)+" V "+(i+r)+" Z"}const Arrow=({size:e=8,angle:t=45,borderWidth:r=0,borderColor:n="black",roundness:o=0,backgroundColor:i="white",layerSide:s="top",style:l={}})=>{if("center"===s)return null;const c=e,a=2*getWidthBasedOnAngle(t,e);return createElement("svg",{style:{...l,transform:"translate"+("left"===s||"right"===s?"Y":"X")+"(-50%)"},"data-arrow":"true",width:"left"===s||"right"===s?c:a,viewBox:getViewBox(c,a,s,r)},createElement("path",{fill:i,strokeWidth:r,stroke:n,d:getTrianglePath({angle:t,layerSide:s,roundness:o,sizeA:c,sizeB:a})}),createElement("path",{fill:i,d:getBorderMaskPath({sizeA:c,sizeB:a,angle:t,borderWidth:r,layerSide:s})}))};function useToggleLayer(e,{onStyle:t,closeOnOutsideClick:r,closeOnDisappear:n,fixed:o,container:i,placement:s={},environment:l=("undefined"!=typeof window?window:void 0),...c}={}){const[a,{relativeParentElement:u,triggerElement:f,scrollParents:g},h]=useElementState(i,o,l),{styles:d,setStyles:y,lastStyles:p,resetLastStyles:m}=useStyleState(s.anchor||defaultPlacement.anchor),T=useRef(null),O=useRef(null);function S(){return"function"==typeof O.current?O.current():O.current}const[E,w]=useState(!1);function R(){O.current=null,w(!1)}const P=useCallback(()=>{const e=S();if(!e)return;const r=getPositioning({triggerRect:e,layerElement:T.current,placement:s,relativeParentElement:u,scrollParents:g,fixed:o,environment:l});if(!r)return;const{layerRect:i,styles:c}=r;if(shouldUpdateStyles(p.current,c)&&(isSet(t)?(p.current=c,t(c.layer,c.arrow,c.layerSide)):y(c)),n){const t=[...g.map(e=>e.getBoundingClientRect()),getWindowClientRect(l)],r=!doesEntireLayerFitWithinScrollParents(o?e:i,t),s=isLayerCompletelyInvisible(o?e:i,t);"partial"===n&&r&&R(),"full"===n&&s&&R()}},[u,E,f,g,o,s]),L=useTrackElementResize(c.ResizeObserver,T,f,E,P,l);useIsomorphicLayoutEffect(()=>{const e=!isSet(t);d!==p.current&&e?p.current=d:E?P():m()}),useOnWindowResize(P,l,E),useOnScroll(g,P,l,E);const b=useRef(new Set([T,h]));useOutsideClick(b,useCallback(()=>{E&&r&&R()},[E,w,r]));const C="function"==typeof i?i():i;function v({clientRect:e,target:t}){O.current=e,E&&t===f?P():(a(t),w(!0))}const B={isOpen:E,close:R,open:v,openFromContextMenuEvent:e=>{e.preventDefault();const t=e.target;v({clientRect:{top:e.clientY,left:e.clientX,bottom:e.clientY+1,right:e.clientX+1,width:1,height:1},target:t})},openFromMouseEvent:e=>{const t=e.currentTarget;if(!t||!t.getBoundingClientRect)return;v({clientRect:()=>t.getBoundingClientRect(),target:t})},openFromRef:e=>{e.current?v({target:e.current,clientRect:e.current.getBoundingClientRect()}):console.error("Error inside useTooltip(): Expected a valid ref to a trigger element, but got "+typeof e.current)},openFromSelection:e=>{if(!e.anchorNode||e.isCollapsed)return;const t=getElementFromAnchorNode(e.anchorNode);if(!t)return;const r=e.getRangeAt(0);v({clientRect:()=>r.getBoundingClientRect(),target:t})},layerSide:E?d.layerSide:null},A=u&&createPortal(e({layerProps:{ref:e=>{e&&L.observe(e),T.current=e},style:{...isSet(t)?EMPTY_STYLE:d.layer,position:o?"fixed":"absolute",willChange:"top, bottom, left, right, width, height"}},arrowStyle:{...isSet(t)?EMPTY_STYLE:d.arrow,position:"absolute",willChange:"top, bottom, left, right"},isOpen:E,layerSide:d.layerSide,triggerRect:S(),close:()=>{R()}}),C||u);return[createElement(OutsideClickGroupProvider,{refs:b},A),B]}function useHover(e){const{delayEnter:t=0,delayLeave:r=0,hideOnScroll:n=!0,onShow:o,onHide:i}=e||{},[s,l]=useState(!1),c=useRef(null),a=useRef(null),u=useRef(!1);function f(e){if(e)return o&&o(),void l(!0);i&&i(),l(!1)}useEffect(()=>{const e=c.current;function t(){c.current&&(clearTimeout(c.current),c.current=null)}function r(){s&&n&&(t(),f(!1))}function o(){s&&(t(),f(!1))}return window.addEventListener("scroll",r,!0),window.addEventListener("touchend",o,!0),()=>{window.removeEventListener("scroll",r,!0),window.removeEventListener("touchend",o,!0),e&&clearTimeout(e)}},[s,n]);const g={onMouseEnter:function(){"leaving"===a.current&&c.current&&(clearTimeout(c.current),c.current=null,a.current=null),s||(a.current="entering",c.current=setTimeout(()=>{f(!0),c.current=null,a.current=null},t))},onMouseLeave:function(){"entering"===a.current&&c.current&&(clearTimeout(c.current),c.current=null),s&&(a.current="leaving",c.current=setTimeout(()=>{f(!1),c.current=null},r))},onTouchStart:()=>{u.current=!1},onTouchMove:()=>{u.current=!0},onTouchEnd:()=>{u.current||s||f(!0),u.current=!1}};return o?g:[s,g]}function useBreakpoint(e){const[t,r]=useState("undefined"!=typeof window&&window.matchMedia("(max-width: "+e+"px)").matches);return useEffect(()=>{const t=window.matchMedia("(max-width: "+e+"px)");function n(e){r(e.matches)}return t.addListener(n),()=>{t.removeListener(n)}},[e]),t}function Transition({isOpen:e,children:t}){const[r,n]=useState({isOpenInternal:e,isLeaving:!1}),o=useRef(!1);return useEffect(()=>{e?n({isOpenInternal:!0,isLeaving:!1}):o.current&&n({isOpenInternal:!1,isLeaving:!0})},[e,n]),useEffect(()=>{o.current=!0},[]),e||r.isOpenInternal||r.isLeaving?t(r.isOpenInternal,()=>{r.isOpenInternal||n(e=>({...e,isLeaving:!1}))},r.isLeaving):null}function useTooltip(e,{delayEnter:t,delayLeave:r,hideOnScroll:n,...o}={}){const i=useRef(),[s,{openFromRef:l,close:c}]=useToggleLayer(e,o),a=useHover({delayEnter:t,delayLeave:r,hideOnScroll:n,onShow:()=>l(i),onHide:c});return[s,{ref:i,...a}]}export{Arrow,ToggleLayer,Transition,Anchor as anchor,useBreakpoint,useHover,useToggleLayer,useTooltip};