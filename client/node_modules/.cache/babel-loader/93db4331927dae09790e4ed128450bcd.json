{"ast":null,"code":"import { CRS, DomEvent, TileLayer, Util } from 'leaflet';\nimport { warn, getUrlParams, setEsriAttribution } from '../Util';\nimport mapService from '../Services/MapService';\nexport var TiledMapLayer = TileLayer.extend({\n  options: {\n    zoomOffsetAllowance: 0.1,\n    errorTileUrl: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEABAMAAACuXLVVAAAAA1BMVEUzNDVszlHHAAAAAXRSTlMAQObYZgAAAAlwSFlzAAAAAAAAAAAB6mUWpAAAADZJREFUeJztwQEBAAAAgiD/r25IQAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7waBAAABw08RwAAAAABJRU5ErkJggg=='\n  },\n  statics: {\n    MercatorZoomLevels: {\n      '0': 156543.03392799999,\n      '1': 78271.516963999893,\n      '2': 39135.758482000099,\n      '3': 19567.879240999901,\n      '4': 9783.9396204999593,\n      '5': 4891.9698102499797,\n      '6': 2445.9849051249898,\n      '7': 1222.9924525624899,\n      '8': 611.49622628138002,\n      '9': 305.74811314055802,\n      '10': 152.874056570411,\n      '11': 76.437028285073197,\n      '12': 38.218514142536598,\n      '13': 19.109257071268299,\n      '14': 9.5546285356341496,\n      '15': 4.7773142679493699,\n      '16': 2.38865713397468,\n      '17': 1.1943285668550501,\n      '18': 0.59716428355981699,\n      '19': 0.29858214164761698,\n      '20': 0.14929107082381,\n      '21': 0.07464553541191,\n      '22': 0.0373227677059525,\n      '23': 0.0186613838529763\n    }\n  },\n  initialize: function (options) {\n    options = Util.setOptions(this, options); // set the urls\n\n    options = getUrlParams(options);\n    this.tileUrl = (options.proxy ? options.proxy + '?' : '') + options.url + 'tile/{z}/{y}/{x}' + (options.requestParams && Object.keys(options.requestParams).length > 0 ? Util.getParamString(options.requestParams) : ''); // Remove subdomain in url\n    // https://github.com/Esri/esri-leaflet/issues/991\n\n    if (options.url.indexOf('{s}') !== -1 && options.subdomains) {\n      options.url = options.url.replace('{s}', options.subdomains[0]);\n    }\n\n    this.service = mapService(options);\n    this.service.addEventParent(this);\n    var arcgisonline = new RegExp(/tiles.arcgis(online)?\\.com/g);\n\n    if (arcgisonline.test(options.url)) {\n      this.tileUrl = this.tileUrl.replace('://tiles', '://tiles{s}');\n      options.subdomains = ['1', '2', '3', '4'];\n    }\n\n    if (this.options.token) {\n      this.tileUrl += '?token=' + this.options.token;\n    } // init layer by calling TileLayers initialize method\n\n\n    TileLayer.prototype.initialize.call(this, this.tileUrl, options);\n  },\n  getTileUrl: function (tilePoint) {\n    var zoom = this._getZoomForUrl();\n\n    return Util.template(this.tileUrl, Util.extend({\n      s: this._getSubdomain(tilePoint),\n      x: tilePoint.x,\n      y: tilePoint.y,\n      // try lod map first, then just default to zoom level\n      z: this._lodMap && this._lodMap[zoom] ? this._lodMap[zoom] : zoom\n    }, this.options));\n  },\n  createTile: function (coords, done) {\n    var tile = document.createElement('img');\n    DomEvent.on(tile, 'load', Util.bind(this._tileOnLoad, this, done, tile));\n    DomEvent.on(tile, 'error', Util.bind(this._tileOnError, this, done, tile));\n\n    if (this.options.crossOrigin) {\n      tile.crossOrigin = '';\n    }\n    /*\r\n     Alt tag is set to empty string to keep screen readers from reading URL and for compliance reasons\r\n     http://www.w3.org/TR/WCAG20-TECHS/H67\r\n    */\n\n\n    tile.alt = ''; // if there is no lod map or an lod map with a proper zoom load the tile\n    // otherwise wait for the lod map to become available\n\n    if (!this._lodMap || this._lodMap && this._lodMap[this._getZoomForUrl()]) {\n      tile.src = this.getTileUrl(coords);\n    } else {\n      this.once('lodmap', function () {\n        tile.src = this.getTileUrl(coords);\n      }, this);\n    }\n\n    return tile;\n  },\n  onAdd: function (map) {\n    // include 'Powered by Esri' in map attribution\n    setEsriAttribution(map);\n\n    if (!this._lodMap) {\n      this.metadata(function (error, metadata) {\n        if (!error && metadata.spatialReference) {\n          var sr = metadata.spatialReference.latestWkid || metadata.spatialReference.wkid; // display the copyright text from the service using leaflet's attribution control\n\n          if (!this.options.attribution && map.attributionControl && metadata.copyrightText) {\n            this.options.attribution = metadata.copyrightText;\n            map.attributionControl.addAttribution(this.getAttribution());\n          } // if the service tiles were published in web mercator using conventional LODs but missing levels, we can try and remap them\n\n\n          if (map.options.crs === CRS.EPSG3857 && (sr === 102100 || sr === 3857)) {\n            this._lodMap = {}; // create the zoom level data\n\n            var arcgisLODs = metadata.tileInfo.lods;\n            var correctResolutions = TiledMapLayer.MercatorZoomLevels;\n\n            for (var i = 0; i < arcgisLODs.length; i++) {\n              var arcgisLOD = arcgisLODs[i];\n\n              for (var ci in correctResolutions) {\n                var correctRes = correctResolutions[ci];\n\n                if (this._withinPercentage(arcgisLOD.resolution, correctRes, this.options.zoomOffsetAllowance)) {\n                  this._lodMap[ci] = arcgisLOD.level;\n                  break;\n                }\n              }\n            }\n\n            this.fire('lodmap');\n          } else if (map.options.crs && map.options.crs.code && map.options.crs.code.indexOf(sr) > -1) {// if the projection is WGS84, or the developer is using Proj4 to define a custom CRS, no action is required\n          } else {\n            // if the service was cached in a custom projection and an appropriate LOD hasn't been defined in the map, guide the developer to our Proj4 sample\n            warn('L.esri.TiledMapLayer is using a non-mercator spatial reference. Support may be available through Proj4Leaflet http://esri.github.io/esri-leaflet/examples/non-mercator-projection.html');\n          }\n        }\n      }, this);\n    }\n\n    TileLayer.prototype.onAdd.call(this, map);\n  },\n  metadata: function (callback, context) {\n    this.service.metadata(callback, context);\n    return this;\n  },\n  identify: function () {\n    return this.service.identify();\n  },\n  find: function () {\n    return this.service.find();\n  },\n  query: function () {\n    return this.service.query();\n  },\n  authenticate: function (token) {\n    var tokenQs = '?token=' + token;\n    this.tileUrl = this.options.token ? this.tileUrl.replace(/\\?token=(.+)/g, tokenQs) : this.tileUrl + tokenQs;\n    this.options.token = token;\n    this.service.authenticate(token);\n    return this;\n  },\n  _withinPercentage: function (a, b, percentage) {\n    var diff = Math.abs(a / b - 1);\n    return diff < percentage;\n  }\n});\nexport function tiledMapLayer(url, options) {\n  return new TiledMapLayer(url, options);\n}\nexport default tiledMapLayer;","map":{"version":3,"sources":["D:/mohi/mohi/client/node_modules/esri-leaflet/src/Layers/TiledMapLayer.js"],"names":["CRS","DomEvent","TileLayer","Util","warn","getUrlParams","setEsriAttribution","mapService","TiledMapLayer","extend","options","zoomOffsetAllowance","errorTileUrl","statics","MercatorZoomLevels","initialize","setOptions","tileUrl","proxy","url","requestParams","Object","keys","length","getParamString","indexOf","subdomains","replace","service","addEventParent","arcgisonline","RegExp","test","token","prototype","call","getTileUrl","tilePoint","zoom","_getZoomForUrl","template","s","_getSubdomain","x","y","z","_lodMap","createTile","coords","done","tile","document","createElement","on","bind","_tileOnLoad","_tileOnError","crossOrigin","alt","src","once","onAdd","map","metadata","error","spatialReference","sr","latestWkid","wkid","attribution","attributionControl","copyrightText","addAttribution","getAttribution","crs","EPSG3857","arcgisLODs","tileInfo","lods","correctResolutions","i","arcgisLOD","ci","correctRes","_withinPercentage","resolution","level","fire","code","callback","context","identify","find","query","authenticate","tokenQs","a","b","percentage","diff","Math","abs","tiledMapLayer"],"mappings":"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","sourcesContent":["import { CRS, DomEvent, TileLayer, Util } from 'leaflet';\r\nimport { warn, getUrlParams, setEsriAttribution } from '../Util';\r\nimport mapService from '../Services/MapService';\r\n\r\nexport var TiledMapLayer = TileLayer.extend({\r\n  options: {\r\n    zoomOffsetAllowance: 0.1,\r\n    errorTileUrl: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEABAMAAACuXLVVAAAAA1BMVEUzNDVszlHHAAAAAXRSTlMAQObYZgAAAAlwSFlzAAAAAAAAAAAB6mUWpAAAADZJREFUeJztwQEBAAAAgiD/r25IQAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7waBAAABw08RwAAAAABJRU5ErkJggg=='\r\n  },\r\n\r\n  statics: {\r\n    MercatorZoomLevels: {\r\n      '0': 156543.03392799999,\r\n      '1': 78271.516963999893,\r\n      '2': 39135.758482000099,\r\n      '3': 19567.879240999901,\r\n      '4': 9783.9396204999593,\r\n      '5': 4891.9698102499797,\r\n      '6': 2445.9849051249898,\r\n      '7': 1222.9924525624899,\r\n      '8': 611.49622628138002,\r\n      '9': 305.74811314055802,\r\n      '10': 152.874056570411,\r\n      '11': 76.437028285073197,\r\n      '12': 38.218514142536598,\r\n      '13': 19.109257071268299,\r\n      '14': 9.5546285356341496,\r\n      '15': 4.7773142679493699,\r\n      '16': 2.38865713397468,\r\n      '17': 1.1943285668550501,\r\n      '18': 0.59716428355981699,\r\n      '19': 0.29858214164761698,\r\n      '20': 0.14929107082381,\r\n      '21': 0.07464553541191,\r\n      '22': 0.0373227677059525,\r\n      '23': 0.0186613838529763\r\n    }\r\n  },\r\n\r\n  initialize: function (options) {\r\n    options = Util.setOptions(this, options);\r\n\r\n    // set the urls\r\n    options = getUrlParams(options);\r\n    this.tileUrl = (options.proxy ? options.proxy + '?' : '') + options.url + 'tile/{z}/{y}/{x}' + (options.requestParams && Object.keys(options.requestParams).length > 0 ? Util.getParamString(options.requestParams) : '');\r\n    // Remove subdomain in url\r\n    // https://github.com/Esri/esri-leaflet/issues/991\r\n    if (options.url.indexOf('{s}') !== -1 && options.subdomains) {\r\n      options.url = options.url.replace('{s}', options.subdomains[0]);\r\n    }\r\n    this.service = mapService(options);\r\n    this.service.addEventParent(this);\r\n\r\n    var arcgisonline = new RegExp(/tiles.arcgis(online)?\\.com/g);\r\n    if (arcgisonline.test(options.url)) {\r\n      this.tileUrl = this.tileUrl.replace('://tiles', '://tiles{s}');\r\n      options.subdomains = ['1', '2', '3', '4'];\r\n    }\r\n\r\n    if (this.options.token) {\r\n      this.tileUrl += ('?token=' + this.options.token);\r\n    }\r\n\r\n    // init layer by calling TileLayers initialize method\r\n    TileLayer.prototype.initialize.call(this, this.tileUrl, options);\r\n  },\r\n\r\n  getTileUrl: function (tilePoint) {\r\n    var zoom = this._getZoomForUrl();\r\n\r\n    return Util.template(this.tileUrl, Util.extend({\r\n      s: this._getSubdomain(tilePoint),\r\n      x: tilePoint.x,\r\n      y: tilePoint.y,\r\n      // try lod map first, then just default to zoom level\r\n      z: (this._lodMap && this._lodMap[zoom]) ? this._lodMap[zoom] : zoom\r\n    }, this.options));\r\n  },\r\n\r\n  createTile: function (coords, done) {\r\n    var tile = document.createElement('img');\r\n\r\n    DomEvent.on(tile, 'load', Util.bind(this._tileOnLoad, this, done, tile));\r\n    DomEvent.on(tile, 'error', Util.bind(this._tileOnError, this, done, tile));\r\n\r\n    if (this.options.crossOrigin) {\r\n      tile.crossOrigin = '';\r\n    }\r\n\r\n    /*\r\n     Alt tag is set to empty string to keep screen readers from reading URL and for compliance reasons\r\n     http://www.w3.org/TR/WCAG20-TECHS/H67\r\n    */\r\n    tile.alt = '';\r\n\r\n    // if there is no lod map or an lod map with a proper zoom load the tile\r\n    // otherwise wait for the lod map to become available\r\n    if (!this._lodMap || (this._lodMap && this._lodMap[this._getZoomForUrl()])) {\r\n      tile.src = this.getTileUrl(coords);\r\n    } else {\r\n      this.once('lodmap', function () {\r\n        tile.src = this.getTileUrl(coords);\r\n      }, this);\r\n    }\r\n\r\n    return tile;\r\n  },\r\n\r\n  onAdd: function (map) {\r\n    // include 'Powered by Esri' in map attribution\r\n    setEsriAttribution(map);\r\n\r\n    if (!this._lodMap) {\r\n      this.metadata(function (error, metadata) {\r\n        if (!error && metadata.spatialReference) {\r\n          var sr = metadata.spatialReference.latestWkid || metadata.spatialReference.wkid;\r\n          // display the copyright text from the service using leaflet's attribution control\r\n          if (!this.options.attribution && map.attributionControl && metadata.copyrightText) {\r\n            this.options.attribution = metadata.copyrightText;\r\n            map.attributionControl.addAttribution(this.getAttribution());\r\n          }\r\n\r\n          // if the service tiles were published in web mercator using conventional LODs but missing levels, we can try and remap them\r\n          if (map.options.crs === CRS.EPSG3857 && (sr === 102100 || sr === 3857)) {\r\n            this._lodMap = {};\r\n            // create the zoom level data\r\n            var arcgisLODs = metadata.tileInfo.lods;\r\n            var correctResolutions = TiledMapLayer.MercatorZoomLevels;\r\n\r\n            for (var i = 0; i < arcgisLODs.length; i++) {\r\n              var arcgisLOD = arcgisLODs[i];\r\n              for (var ci in correctResolutions) {\r\n                var correctRes = correctResolutions[ci];\r\n\r\n                if (this._withinPercentage(arcgisLOD.resolution, correctRes, this.options.zoomOffsetAllowance)) {\r\n                  this._lodMap[ci] = arcgisLOD.level;\r\n                  break;\r\n                }\r\n              }\r\n            }\r\n\r\n            this.fire('lodmap');\r\n          } else if (map.options.crs && map.options.crs.code && (map.options.crs.code.indexOf(sr) > -1)) {\r\n            // if the projection is WGS84, or the developer is using Proj4 to define a custom CRS, no action is required\r\n          } else {\r\n            // if the service was cached in a custom projection and an appropriate LOD hasn't been defined in the map, guide the developer to our Proj4 sample\r\n            warn('L.esri.TiledMapLayer is using a non-mercator spatial reference. Support may be available through Proj4Leaflet http://esri.github.io/esri-leaflet/examples/non-mercator-projection.html');\r\n          }\r\n        }\r\n      }, this);\r\n    }\r\n\r\n    TileLayer.prototype.onAdd.call(this, map);\r\n  },\r\n\r\n  metadata: function (callback, context) {\r\n    this.service.metadata(callback, context);\r\n    return this;\r\n  },\r\n\r\n  identify: function () {\r\n    return this.service.identify();\r\n  },\r\n\r\n  find: function () {\r\n    return this.service.find();\r\n  },\r\n\r\n  query: function () {\r\n    return this.service.query();\r\n  },\r\n\r\n  authenticate: function (token) {\r\n    var tokenQs = '?token=' + token;\r\n    this.tileUrl = (this.options.token) ? this.tileUrl.replace(/\\?token=(.+)/g, tokenQs) : this.tileUrl + tokenQs;\r\n    this.options.token = token;\r\n    this.service.authenticate(token);\r\n    return this;\r\n  },\r\n\r\n  _withinPercentage: function (a, b, percentage) {\r\n    var diff = Math.abs((a / b) - 1);\r\n    return diff < percentage;\r\n  }\r\n});\r\n\r\nexport function tiledMapLayer (url, options) {\r\n  return new TiledMapLayer(url, options);\r\n}\r\n\r\nexport default tiledMapLayer;\r\n"]},"metadata":{},"sourceType":"module"}