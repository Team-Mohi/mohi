{"ast":null,"code":"import axios from 'axios';\nimport { API_REFRESH_TOKEN } from './../Constants/Api.jsx';\nconst token = localStorage.getItem('ustk');\naxios.interceptors.request.use(config => {\n  if (token) {\n    config.headers['Authorization'] = 'Bearer ' + token;\n  }\n\n  return config;\n}, error => {\n  Promise.reject(error);\n});\nlet isRefreshing = false;\nlet failedQueue = [];\n\nconst processQueue = (error, token = null) => {\n  failedQueue.forEach(prom => {\n    if (error) {\n      prom.reject(error);\n    } else {\n      prom.resolve(token);\n    }\n  });\n  failedQueue = [];\n};\n\naxios.interceptors.response.use(response => {\n  return response;\n}, function (error) {\n  const originalRequest = error.config;\n  console.log(error.response);\n\n  if (error.response.status === 401 && !originalRequest._retry) {\n    if (isRefreshing) {\n      return new Promise(function (resolve, reject) {\n        failedQueue.push({\n          resolve,\n          reject\n        });\n      }).then(token => {\n        originalRequest.headers['Authorization'] = 'Bearer ' + token;\n        return axios(originalRequest);\n      }).catch(err => {\n        return Promise.reject(err);\n      });\n    }\n\n    originalRequest._retry = true;\n    isRefreshing = true;\n    return new Promise(function (resolve, reject) {\n      axios.post(API_REFRESH_TOKEN, {\n        'token': token\n      }).then(res => {\n        if (res.status === 200) {\n          localStorage.setItem('ustk', res.data.access_token);\n          let new_token = localStorage.getItem('ustk');\n          processQueue(null, res.data.access_token);\n          axios.defaults.headers.common['Authorization'] = 'Bearer ' + new_token;\n          originalRequest.headers['Authorization'] = 'Bearer ' + new_token;\n          resolve(axios(originalRequest));\n        }\n      }).then(() => {\n        isRefreshing = false;\n      });\n    });\n  }\n\n  return Promise.reject(error);\n});","map":{"version":3,"sources":["D:/Web/mohi/client/src/axios/inceptor.jsx"],"names":["axios","API_REFRESH_TOKEN","token","localStorage","getItem","interceptors","request","use","config","headers","error","Promise","reject","isRefreshing","failedQueue","processQueue","forEach","prom","resolve","response","originalRequest","console","log","status","_retry","push","then","catch","err","post","res","setItem","data","access_token","new_token","defaults","common"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAAQC,iBAAR,QAAgC,wBAAhC;AAEA,MAAMC,KAAK,GAAGC,YAAY,CAACC,OAAb,CAAqB,MAArB,CAAd;AAEAJ,KAAK,CAACK,YAAN,CAAmBC,OAAnB,CAA2BC,GAA3B,CACGC,MAAM,IAAI;AACN,MAAIN,KAAJ,EAAW;AACPM,IAAAA,MAAM,CAACC,OAAP,CAAe,eAAf,IAAkC,YAAYP,KAA9C;AACH;;AACD,SAAOM,MAAP;AACH,CANJ,EAOGE,KAAK,IAAI;AACLC,EAAAA,OAAO,CAACC,MAAR,CAAeF,KAAf;AACL,CATF;AAWC,IAAIG,YAAY,GAAG,KAAnB;AACA,IAAIC,WAAW,GAAG,EAAlB;;AAEA,MAAMC,YAAY,GAAG,CAACL,KAAD,EAAQR,KAAK,GAAG,IAAhB,KAAyB;AAC5CY,EAAAA,WAAW,CAACE,OAAZ,CAAoBC,IAAI,IAAI;AAC1B,QAAIP,KAAJ,EAAW;AACTO,MAAAA,IAAI,CAACL,MAAL,CAAYF,KAAZ;AACD,KAFD,MAEO;AACLO,MAAAA,IAAI,CAACC,OAAL,CAAahB,KAAb;AACD;AACF,GAND;AAQAY,EAAAA,WAAW,GAAG,EAAd;AACD,CAVD;;AAYDd,KAAK,CAACK,YAAN,CAAmBc,QAAnB,CAA4BZ,GAA5B,CAAiCY,QAAD,IAAc;AAC3C,SAAOA,QAAP;AACF,CAFD,EAGA,UAAUT,KAAV,EAAiB;AACd,QAAMU,eAAe,GAAGV,KAAK,CAACF,MAA9B;AACAa,EAAAA,OAAO,CAACC,GAAR,CAAYZ,KAAK,CAACS,QAAlB;;AACA,MAAIT,KAAK,CAACS,QAAN,CAAeI,MAAf,KAA0B,GAA1B,IAAiC,CAACH,eAAe,CAACI,MAAtD,EAA8D;AAE5D,QAAIX,YAAJ,EAAkB;AACf,aAAO,IAAIF,OAAJ,CAAY,UAASO,OAAT,EAAkBN,MAAlB,EAA0B;AAC3CE,QAAAA,WAAW,CAACW,IAAZ,CAAiB;AAACP,UAAAA,OAAD;AAAUN,UAAAA;AAAV,SAAjB;AACD,OAFM,EAEJc,IAFI,CAECxB,KAAK,IAAI;AACfkB,QAAAA,eAAe,CAACX,OAAhB,CAAwB,eAAxB,IAA2C,YAAYP,KAAvD;AACA,eAAOF,KAAK,CAACoB,eAAD,CAAZ;AACD,OALM,EAKJO,KALI,CAKEC,GAAG,IAAI;AACd,eAAOjB,OAAO,CAACC,MAAR,CAAegB,GAAf,CAAP;AACD,OAPM,CAAP;AAQD;;AAEAR,IAAAA,eAAe,CAACI,MAAhB,GAAyB,IAAzB;AACAX,IAAAA,YAAY,GAAG,IAAf;AACA,WAAO,IAAIF,OAAJ,CAAY,UAAUO,OAAV,EAAmBN,MAAnB,EAA2B;AAC5CZ,MAAAA,KAAK,CAAC6B,IAAN,CAAW5B,iBAAX,EACI;AACI,iBAAUC;AADd,OADJ,EAIKwB,IAJL,CAIUI,GAAG,IAAI;AACT,YAAIA,GAAG,CAACP,MAAJ,KAAe,GAAnB,EAAwB;AACpBpB,UAAAA,YAAY,CAAC4B,OAAb,CAAqB,MAArB,EAA6BD,GAAG,CAACE,IAAJ,CAASC,YAAtC;AACA,cAAIC,SAAS,GAAG/B,YAAY,CAACC,OAAb,CAAqB,MAArB,CAAhB;AACAW,UAAAA,YAAY,CAAC,IAAD,EAAOe,GAAG,CAACE,IAAJ,CAASC,YAAhB,CAAZ;AACAjC,UAAAA,KAAK,CAACmC,QAAN,CAAe1B,OAAf,CAAuB2B,MAAvB,CAA8B,eAA9B,IAAiD,YAAYF,SAA7D;AACAd,UAAAA,eAAe,CAACX,OAAhB,CAAwB,eAAxB,IAA2C,YAAYyB,SAAvD;AACAhB,UAAAA,OAAO,CAAClB,KAAK,CAACoB,eAAD,CAAN,CAAP;AACH;AACJ,OAbL,EAcKM,IAdL,CAcU,MAAM;AAAEb,QAAAA,YAAY,GAAG,KAAf;AAAsB,OAdxC;AAeA,KAhBK,CAAP;AAiBH;;AACD,SAAOF,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACF,CAxCD","sourcesContent":["import axios from 'axios';\r\nimport {API_REFRESH_TOKEN} from './../Constants/Api.jsx';\r\n\r\nconst token = localStorage.getItem('ustk');\r\n\r\naxios.interceptors.request.use(\r\n   config => {\r\n       if (token) {\r\n           config.headers['Authorization'] = 'Bearer ' + token;\r\n       }\r\n       return config;\r\n   },\r\n   error => {\r\n       Promise.reject(error)\r\n });\r\n\r\n let isRefreshing = false;\r\n let failedQueue = [];\r\n\r\n const processQueue = (error, token = null) => {\r\n   failedQueue.forEach(prom => {\r\n     if (error) {\r\n       prom.reject(error);\r\n     } else {\r\n       prom.resolve(token);\r\n     }\r\n   })\r\n\r\n   failedQueue = [];\r\n }\r\n\r\naxios.interceptors.response.use((response) => {\r\n   return response\r\n},\r\nfunction (error) {\r\n   const originalRequest = error.config;\r\n   console.log(error.response);\r\n   if (error.response.status === 401 && !originalRequest._retry) {\r\n\r\n     if (isRefreshing) {\r\n        return new Promise(function(resolve, reject) {\r\n          failedQueue.push({resolve, reject})\r\n        }).then(token => {\r\n          originalRequest.headers['Authorization'] = 'Bearer ' + token;\r\n          return axios(originalRequest);\r\n        }).catch(err => {\r\n          return Promise.reject(err);\r\n        })\r\n      }\r\n\r\n       originalRequest._retry = true;\r\n       isRefreshing = true;\r\n       return new Promise(function (resolve, reject) {\r\n         axios.post(API_REFRESH_TOKEN,\r\n             {\r\n                 'token' : token\r\n             })\r\n             .then(res => {\r\n                 if (res.status === 200) {\r\n                     localStorage.setItem('ustk', res.data.access_token);\r\n                     let new_token = localStorage.getItem('ustk');\r\n                     processQueue(null, res.data.access_token);\r\n                     axios.defaults.headers.common['Authorization'] = 'Bearer ' + new_token;\r\n                     originalRequest.headers['Authorization'] = 'Bearer ' + new_token;\r\n                     resolve(axios(originalRequest));\r\n                 }\r\n             })\r\n             .then(() => { isRefreshing = false })\r\n        })\r\n   }\r\n   return Promise.reject(error);\r\n});\r\n"]},"metadata":{},"sourceType":"module"}