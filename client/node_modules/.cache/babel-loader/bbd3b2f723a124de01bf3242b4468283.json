{"ast":null,"code":"import _slicedToArray from\"D:\\\\Web\\\\mohi\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{useHistory}from'react-router-dom';import{useForm}from'react-hook-form';import{RiErrorWarningLine}from\"react-icons/ri\";import{Tooltip}from'antd';import{useCookies}from\"react-cookie\";var CryptoJS=require(\"crypto-js\");function VeriCode(props){var history=useHistory();console.log(history);var code_encrypt=history.location.state?history.location.state.code:'';if(!code_encrypt){history.push('/');}//  Giải mã code\nvar bytes=CryptoJS.AES.decrypt(code_encrypt,'code_veri');var code=JSON.parse(bytes.toString(CryptoJS.enc.Utf8));var user_email=history.location.state.user_email;var user_password=history.location.state.user_password;var id_user=history.location.state.id_user;var _useForm=useForm(),register=_useForm.register,handleSubmit=_useForm.handleSubmit,errors=_useForm.errors;var _useState=useState(),_useState2=_slicedToArray(_useState,2),errorCode=_useState2[0],setErrorCode=_useState2[1];var _useCookies=useCookies([\"vrctrgt\"]),_useCookies2=_slicedToArray(_useCookies,3),cookies=_useCookies2[0],setCookie=_useCookies2[1],removeCookie=_useCookies2[2];var now=new Date().getTime();useEffect(function(){if(code){var timeExpiredCode=now+300000;setCookie(\"vrctrgt\",timeExpiredCode,{path:\"/\"});}},[code]);var onSubmit=function onSubmit(data){if(Number(data.code)===code){if(cookies.vrctrgt-new Date().getTime()>0){setErrorCode('');removeCookie(\"vrctrgt\");var new_data={id:id_user,user_email:user_email,user_password:user_password};props.submitVeriCode(new_data);}else{setErrorCode('Mã xác nhận đã hết hạn');}}else{setErrorCode('Mã xác nhận không đúng');}};var validateInputCode=function validateInputCode(value){if(!value)return false;if(!Number(value))return false;return true;};return/*#__PURE__*/React.createElement(\"div\",{className:\"veri-code-container\"},/*#__PURE__*/React.createElement(\"form\",{onSubmit:handleSubmit(onSubmit)},/*#__PURE__*/React.createElement(\"h2\",null,\"X\\xE1c nh\\u1EADn m\\xE3\"),/*#__PURE__*/React.createElement(\"div\",{className:\"veri-code-message\"},/*#__PURE__*/React.createElement(\"span\",{style:{color:'black'}},\"Ch\\xFAng t\\xF4i \\u0111\\xE3 g\\u1EEDi m\\xE3 \\u0111\\u1EBFn\"),\" \",user_email,/*#__PURE__*/React.createElement(\"span\",{style:{color:'black'}},\". M\\xE3 n\\xE0y s\\u1EBD t\\u1ED3n t\\u1EA1i trong v\\xF2ng 5 ph\\xFAt. Vui l\\xF2ng ki\\u1EC3m tra v\\xE0 ti\\u1EBFp t\\u1EE5c ho\\xE0n th\\xE0nh qu\\xE1 tr\\xECnh \\u0111\\u0103ng k\\xED t\\xE0i kho\\u1EA3n.\")),/*#__PURE__*/React.createElement(\"div\",{className:\"submit-error-veri-code\"},errorCode),/*#__PURE__*/React.createElement(\"div\",{className:\"form-veri-code-group\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"code\"},\"M\\xE3 code:\"),/*#__PURE__*/React.createElement(\"input\",{type:\"text\",name:\"code\",id:\"code\",placeholder:\"Nh\\u1EADp m\\xE3 g\\u1ED3m 6 s\\u1ED1...\",ref:register({validate:function validate(value){return validateInputCode(value);}}),style:errors.code?{border:'1px solid red'}:null}),errors.code&&/*#__PURE__*/React.createElement(Tooltip,{placement:\"right\",title:/*#__PURE__*/React.createElement(\"p\",{className:\"error_sex_tooltip\"},\" Vui l\\xF2ng nh\\u1EADp m\\xE3 g\\u1ED3m 6 s\\u1ED1\")},/*#__PURE__*/React.createElement(RiErrorWarningLine,{className:\"error_sex error_code\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"form-veri-code-group\"},/*#__PURE__*/React.createElement(\"button\",{type:\"submit\"},\"X\\xE1c nh\\u1EADn\"))));}export default VeriCode;","map":{"version":3,"sources":["D:/Web/mohi/client/src/app/Authen/VeriCodeForm.jsx"],"names":["React","useEffect","useState","useHistory","useForm","RiErrorWarningLine","Tooltip","useCookies","CryptoJS","require","VeriCode","props","history","console","log","code_encrypt","location","state","code","push","bytes","AES","decrypt","JSON","parse","toString","enc","Utf8","user_email","user_password","id_user","register","handleSubmit","errors","errorCode","setErrorCode","cookies","setCookie","removeCookie","now","Date","getTime","timeExpiredCode","path","onSubmit","data","Number","vrctrgt","new_data","id","submitVeriCode","validateInputCode","value","color","validate","border"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from 'react';\r\nimport {useHistory} from 'react-router-dom';\r\nimport {useForm} from 'react-hook-form';\r\nimport {RiErrorWarningLine} from \"react-icons/ri\";\r\nimport {Tooltip} from 'antd';\r\nimport { useCookies } from \"react-cookie\";\r\nvar CryptoJS = require(\"crypto-js\");\r\n\r\nfunction VeriCode(props) {\r\n  const history = useHistory();\r\n  console.log(history);\r\n  const code_encrypt = history.location.state ? history.location.state.code : '';\r\n  if (!code_encrypt) {\r\n    history.push('/')\r\n  }\r\n  //  Giải mã code\r\n  const bytes = CryptoJS.AES.decrypt(code_encrypt, 'code_veri');\r\n  const code = JSON.parse(bytes.toString(CryptoJS.enc.Utf8));\r\n  const user_email = history.location.state.user_email;\r\n  const user_password = history.location.state.user_password;\r\n  const id_user = history.location.state.id_user;\r\n  const {register, handleSubmit, errors} = useForm();\r\n  const [errorCode, setErrorCode] = useState();\r\n  const [cookies, setCookie, removeCookie] = useCookies([\"vrctrgt\"]);\r\n  const now = new Date().getTime();\r\n\r\n  useEffect(() => {\r\n    if(code){\r\n      const timeExpiredCode = now + 300000;\r\n      setCookie(\"vrctrgt\", timeExpiredCode, {\r\n        path: \"/\"\r\n      })\r\n    }\r\n  }, [code]);\r\n\r\n  const onSubmit = (data) => {\r\n\r\n    if(Number(data.code) === code){\r\n      if(cookies.vrctrgt - new Date().getTime() > 0){\r\n        setErrorCode('');\r\n        removeCookie(\"vrctrgt\");\r\n        let new_data = {\r\n          id: id_user,\r\n          user_email: user_email,\r\n          user_password: user_password\r\n        }\r\n        props.submitVeriCode(new_data)\r\n      }else {\r\n        setErrorCode('Mã xác nhận đã hết hạn');\r\n      }\r\n    }else {\r\n      setErrorCode('Mã xác nhận không đúng');\r\n    }\r\n\r\n  }\r\n\r\n  const validateInputCode = (value) => {\r\n    if(!value) return false\r\n    if(!Number(value)) return false\r\n\r\n    return true\r\n  }\r\n  return (<div className=\"veri-code-container\">\r\n    <form onSubmit={handleSubmit(onSubmit)}>\r\n      <h2>Xác nhận mã</h2>\r\n    <div className=\"veri-code-message\"><span style={{color: 'black'}}>Chúng tôi đã gửi mã đến</span> {user_email}<span style={{color: 'black'}}>. Mã này sẽ tồn tại trong vòng 5 phút. Vui lòng kiểm tra và tiếp tục hoàn thành quá trình đăng kí tài khoản.</span></div>\r\n      <div className=\"submit-error-veri-code\">{errorCode}</div>\r\n      <div className=\"form-veri-code-group\">\r\n        <label htmlFor=\"code\">Mã code:\r\n        </label>\r\n        <input\r\n          type=\"text\"\r\n          name=\"code\"\r\n          id=\"code\"\r\n          placeholder=\"Nhập mã gồm 6 số...\"\r\n          ref={register({\r\n              validate: value => validateInputCode(value)\r\n            })}\r\n          style={errors.code ? {border: '1px solid red'} : null}\r\n        />\r\n      {errors.code && <Tooltip placement=\"right\" title={<p className = \"error_sex_tooltip\" > Vui lòng nhập mã gồm 6 số</p>}><RiErrorWarningLine className=\"error_sex error_code\"/></Tooltip>}\r\n      </div>\r\n      <div className=\"form-veri-code-group\">\r\n        <button type=\"submit\">Xác nhận</button>\r\n      </div>\r\n    </form>\r\n  </div>)\r\n}\r\n\r\nexport default VeriCode;\r\n"]},"metadata":{},"sourceType":"module"}