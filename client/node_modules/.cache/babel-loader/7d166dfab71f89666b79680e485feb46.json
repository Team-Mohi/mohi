{"ast":null,"code":"var _jsxFileName = \"D:\\\\Web\\\\mohi\\\\client\\\\src\\\\Components\\\\Messenger\\\\SiderMessenger.jsx\";\nimport React, { useEffect, useState, useRef, Suspense, useContext } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { Image, Transformation } from 'cloudinary-react';\nimport useWindowSize from \"./useWindowSize.jsx\";\nimport moment from 'moment';\nimport 'moment/locale/vi';\nimport axios from 'axios';\nimport { BsSearch } from 'react-icons/bs';\nimport { useHistory } from 'react-router-dom';\nimport { searchFriendProfile } from './../../Actions/index.jsx';\nimport { readMessage } from './../../Actions/index.jsx';\nimport SocketContext from './../Socket/index.jsx';\n\nconst SiderMessenger = (props, {\n  message,\n  friends\n}) => {\n  const windowSize = useWindowSize();\n  const socket = useContext(SocketContext);\n  const dispatch = useDispatch();\n  const listFriends = useSelector(state => state.friends.list);\n  const {\n    list\n  } = useSelector(state => state.message);\n  const searchKeyWords = useSelector(state => state.friends.searchKeyWords);\n  const [scrollSider, setScrollSider] = useState();\n  const sider = useRef();\n  const currentUser = JSON.parse(localStorage.getItem('ustk')).info;\n  const heightScrollSider = window.innerHeight - 190;\n  const [showScroll, setShowScroll] = useState({\n    height: heightScrollSider\n  });\n  const [contentChat, setContentChat] = useState(false);\n  const [isSeach, setIsSeach] = useState(false);\n  const history = useHistory();\n  useEffect(() => {\n    setShowScroll({\n      height: heightScrollSider\n    });\n  }, [windowSize]);\n\n  function handleSiderScroll() {\n    const {\n      scrollTop\n    } = sider.current;\n    if (scrollTop > 0 && !scrollSider) setScrollSider({\n      boxShadow: '-4px 0.1px 3px rgba(0,0,0,0.2)'\n    });\n    if (scrollTop === 0) setScrollSider({});\n  }\n\n  const onChangeSearchFriend = e => {\n    dispatch(searchFriendProfile(e.target.value));\n\n    if (e.target.value) {\n      setIsSeach(true);\n    } else {\n      setIsSeach(false);\n    }\n  };\n\n  const openContentChat = async (idUser, user_username) => {\n    await axios.post(\"https://www.api.mohi.vn/api/auth/read-message\", {\n      id: idUser\n    }).then(res => {\n      dispatch(readMessage(idUser));\n      socket.emit('read-message', {\n        user_username: user_username,\n        idUser: idUser\n      });\n    });\n    history.push('/messenger/' + idUser);\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sider-messenger-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sider-messenger-head\",\n    style: scrollSider,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sider-messenger-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 61,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sider-messenger-title-left\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 62,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sider-messenger-avatar\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 17\n    }\n  }, currentUser.user_avatar_cropX === null ? /*#__PURE__*/React.createElement(\"img\", {\n    src: currentUser.user_avatar,\n    alt: currentUser.user_first_name + ' ' + currentUser.user_last_name,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 21\n    }\n  }) : /*#__PURE__*/React.createElement(Image, {\n    cloudName: \"mohi-vn\",\n    publicId: currentUser.user_avatar + \".jpg\",\n    version: \"1607061343\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(Transformation, {\n    height: currentUser.user_avatar_cropH,\n    width: currentUser.user_avatar_cropW,\n    x: currentUser.user_avatar_cropX,\n    y: currentUser.user_avatar_cropY,\n    crop: \"crop\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 23\n    }\n  }))), /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 17\n    }\n  }, \"Chat\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sider-messenger-title-right\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sider-messenger-search\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(BsSearch, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    placeholder: \"T\\xECm ki\\u1EBFm tr\\xEAn Messenger\",\n    onChange: onChangeSearchFriend,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 13\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sider-messenger-list-user-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sider-messenger-list-user\",\n    style: showScroll,\n    onScroll: () => handleSiderScroll(),\n    ref: sider,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"ul\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 15\n    }\n  }, searchKeyWords && listFriends.filter(fr => {\n    const name = fr.user_first_name + ' ' + fr.user_last_name;\n    return name.toLowerCase().replace(/\\s/g, '').indexOf(searchKeyWords.toLowerCase().replace(/\\s/g, '')) !== -1;\n  }).map((friends, index) => {\n    return /*#__PURE__*/React.createElement(\"li\", {\n      key: index,\n      onClick: () => openContentChat(friends.id, friends.user_username),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"sider-messenger-user-item\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 23\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"sider-messenger-user-item-avatar\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 25\n      }\n    }, friends.user_avatar_cropX === null ? /*#__PURE__*/React.createElement(\"img\", {\n      src: friends.user_avatar,\n      alt: friends.user_last_name,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 29\n      }\n    }) : /*#__PURE__*/React.createElement(Image, {\n      cloudName: \"mohi-vn\",\n      publicId: friends.user_avatar + \".jpg\",\n      version: \"1607061343\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(Transformation, {\n      height: friends.user_avatar_cropH,\n      width: friends.user_avatar_cropW,\n      x: friends.user_avatar_cropX,\n      y: friends.user_avatar_cropY,\n      crop: \"crop\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 31\n      }\n    }))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"sider-messenger-content\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"sider-messenger-username\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 27\n      }\n    }, friends.user_first_name + ' ' + friends.user_last_name))));\n  }), !listFriends.filter(fr => {\n    const name = fr.user_first_name + ' ' + fr.user_last_name;\n    return name.toLowerCase().replace(/\\s/g, '').indexOf(searchKeyWords.toLowerCase().replace(/\\s/g, '')) !== -1;\n  }).length && isSeach && /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      textAlign: 'center'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 17\n    }\n  }, \"Kh\\xF4ng c\\xF3 k\\u1EBFt qu\\u1EA3 t\\xECm ki\\u1EBFm\"), !list.length && !isSeach && /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      textAlign: 'center'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 17\n    }\n  }, \"T\\xECm ki\\u1EBFm b\\u1EA1n b\\xE8 \\u0111\\u1EC3 nh\\u1EAFn tin\"), !isSeach && list.map((mess, index) => {\n    return /*#__PURE__*/React.createElement(\"li\", {\n      key: index,\n      onClick: () => openContentChat(mess.id, mess.user_username),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"sider-messenger-user-item\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 23\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"sider-messenger-user-item-avatar\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 25\n      }\n    }, mess.user_avatar_cropX === null ? /*#__PURE__*/React.createElement(\"img\", {\n      src: mess.user_avatar,\n      alt: mess.user_last_name,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 29\n      }\n    }) : /*#__PURE__*/React.createElement(Image, {\n      cloudName: \"mohi-vn\",\n      publicId: mess.user_avatar + \".jpg\",\n      version: \"1607061343\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(Transformation, {\n      height: mess.user_avatar_cropH,\n      width: mess.user_avatar_cropW,\n      x: mess.user_avatar_cropX,\n      y: mess.user_avatar_cropY,\n      crop: \"crop\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 31\n      }\n    }))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"sider-messenger-content\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"sider-messenger-username\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 27\n      }\n    }, mess.user_first_name + ' ' + mess.user_last_name), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"sider-messenger-content-nearest\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 27\n      }\n    }, mess.pivot.messages_Message)), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"sider-messenger-time-send\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 25\n      }\n    }, moment(mess.pivot.created_at, \"YYYYMMDD\\h:m:s\").fromNow())), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"sider-messenger-user-item-status\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 23\n      }\n    }));\n  })))));\n};\n\nexport default SiderMessenger;","map":{"version":3,"sources":["D:/Web/mohi/client/src/Components/Messenger/SiderMessenger.jsx"],"names":["React","useEffect","useState","useRef","Suspense","useContext","useSelector","useDispatch","Image","Transformation","useWindowSize","moment","axios","BsSearch","useHistory","searchFriendProfile","readMessage","SocketContext","SiderMessenger","props","message","friends","windowSize","socket","dispatch","listFriends","state","list","searchKeyWords","scrollSider","setScrollSider","sider","currentUser","JSON","parse","localStorage","getItem","info","heightScrollSider","window","innerHeight","showScroll","setShowScroll","height","contentChat","setContentChat","isSeach","setIsSeach","history","handleSiderScroll","scrollTop","current","boxShadow","onChangeSearchFriend","e","target","value","openContentChat","idUser","user_username","post","id","then","res","emit","push","user_avatar_cropX","user_avatar","user_first_name","user_last_name","user_avatar_cropH","user_avatar_cropW","user_avatar_cropY","filter","fr","name","toLowerCase","replace","indexOf","map","index","length","textAlign","mess","pivot","messages_Message","created_at","fromNow"],"mappings":"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","sourcesContent":["import React, {useEffect, useState, useRef, Suspense, useContext} from 'react';\r\nimport {useSelector, useDispatch} from 'react-redux';\r\nimport {Image,Transformation} from 'cloudinary-react';\r\nimport useWindowSize from \"./useWindowSize.jsx\";\r\nimport moment from 'moment';\r\nimport 'moment/locale/vi';\r\nimport axios from 'axios';\r\nimport {BsSearch} from 'react-icons/bs';\r\nimport {useHistory} from 'react-router-dom';\r\nimport {searchFriendProfile} from './../../Actions/index.jsx';\r\nimport {readMessage} from './../../Actions/index.jsx';\r\nimport SocketContext from './../Socket/index.jsx';\r\n\r\n  const SiderMessenger = (props, {message, friends }) => {\r\n    const windowSize = useWindowSize();\r\n    const socket = useContext(SocketContext);\r\n    const dispatch = useDispatch();\r\n    const listFriends = useSelector(state => state.friends.list);\r\n    const {list} = useSelector(state => state.message);\r\n    const searchKeyWords = useSelector(state => state.friends.searchKeyWords);\r\n    const [scrollSider, setScrollSider] = useState();\r\n    const sider = useRef();\r\n    const currentUser = JSON.parse(localStorage.getItem('ustk')).info;\r\n    const heightScrollSider = window.innerHeight - 190;\r\n    const [showScroll, setShowScroll] = useState({height: heightScrollSider})\r\n    const [contentChat, setContentChat] = useState(false)\r\n    const [isSeach, setIsSeach] = useState(false)\r\n    const history = useHistory();\r\n\r\n    useEffect(() => {\r\n      setShowScroll({height: heightScrollSider})\r\n    },[windowSize]);\r\n\r\n    function handleSiderScroll(){\r\n      const {scrollTop} = sider.current;\r\n      if(scrollTop > 0 && !scrollSider) setScrollSider({boxShadow: '-4px 0.1px 3px rgba(0,0,0,0.2)'})\r\n      if(scrollTop === 0) setScrollSider({})\r\n    }\r\n\r\n    const onChangeSearchFriend = (e) => {\r\n      dispatch(searchFriendProfile(e.target.value))\r\n      if(e.target.value){\r\n        setIsSeach(true)\r\n      }else {\r\n        setIsSeach(false)\r\n      }\r\n    }\r\n\r\n\r\n    const openContentChat = async (idUser, user_username) => {\r\n      await axios.post(\"https://www.api.mohi.vn/api/auth/read-message\", {id: idUser}).then((res) => {\r\n        dispatch(readMessage(idUser))\r\n        socket.emit('read-message', {user_username: user_username, idUser: idUser})\r\n      })\r\n      history.push('/messenger/' + idUser)\r\n    }\r\n\r\n      return(\r\n        <div className=\"sider-messenger-container\">\r\n          <div className=\"sider-messenger-head\" style={scrollSider}>\r\n            <div className=\"sider-messenger-title\">\r\n              <div className=\"sider-messenger-title-left\">\r\n                <div className=\"sider-messenger-avatar\">\r\n                  {currentUser.user_avatar_cropX === null ?\r\n                    <img src={currentUser.user_avatar} alt={currentUser.user_first_name + ' ' + currentUser.user_last_name} />\r\n                    :\r\n                    <Image cloudName=\"mohi-vn\" publicId={currentUser.user_avatar+ \".jpg\"} version=\"1607061343\">\r\n                      <Transformation height={currentUser.user_avatar_cropH}  width={currentUser.user_avatar_cropW} x={currentUser.user_avatar_cropX} y={currentUser.user_avatar_cropY} crop=\"crop\" />\r\n                    </Image>\r\n                  }\r\n                </div>\r\n                <span>Chat</span>\r\n              </div>\r\n              <div className=\"sider-messenger-title-right\">\r\n              </div>\r\n            </div>\r\n            <div className=\"sider-messenger-search\">\r\n              <BsSearch />\r\n            <input type=\"text\" placeholder=\"Tìm kiếm trên Messenger\" onChange={onChangeSearchFriend}/>\r\n            </div>\r\n          </div>\r\n          <div className=\"sider-messenger-list-user-container\" >\r\n            <div className=\"sider-messenger-list-user\" style={showScroll} onScroll={() => handleSiderScroll()} ref={sider}>\r\n              <ul>\r\n                {searchKeyWords && listFriends.filter(fr => {\r\n                  const name = fr.user_first_name + ' ' + fr.user_last_name;\r\n\r\n                  return name.toLowerCase().replace(/\\s/g,'').indexOf(searchKeyWords.toLowerCase().replace(/\\s/g,'')) !== -1\r\n                }).map((friends, index) => {\r\n                  return(\r\n                    <li key={index} onClick={() => openContentChat(friends.id, friends.user_username)}>\r\n                      <div className=\"sider-messenger-user-item\">\r\n                        <div className=\"sider-messenger-user-item-avatar\">\r\n                          {friends.user_avatar_cropX === null ?\r\n                            <img src={friends.user_avatar} alt={friends.user_last_name} />\r\n                            :\r\n                            <Image cloudName=\"mohi-vn\" publicId={friends.user_avatar+ \".jpg\"} version=\"1607061343\">\r\n                              <Transformation height={friends.user_avatar_cropH}  width={friends.user_avatar_cropW} x={friends.user_avatar_cropX} y={friends.user_avatar_cropY} crop=\"crop\" />\r\n                            </Image>\r\n                          }\r\n                        </div>\r\n                        <div className=\"sider-messenger-content\">\r\n                          <div className=\"sider-messenger-username\">\r\n                            {friends.user_first_name + ' ' + friends.user_last_name}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </li>\r\n                  )\r\n                })}\r\n                {!listFriends.filter(fr => {\r\n                  const name = fr.user_first_name + ' ' + fr.user_last_name;\r\n\r\n                  return name.toLowerCase().replace(/\\s/g,'').indexOf(searchKeyWords.toLowerCase().replace(/\\s/g,'')) !== -1\r\n                }).length && isSeach &&\r\n                <div style={{textAlign: 'center'}}>Không có kết quả tìm kiếm</div>\r\n                }\r\n                {!list.length && !isSeach &&\r\n                <div style={{textAlign: 'center'}}>Tìm kiếm bạn bè để nhắn tin</div>\r\n                }\r\n                {!isSeach && list.map((mess, index) => {\r\n                  return(\r\n                    <li key={index} onClick={() => openContentChat(mess.id, mess.user_username)}>\r\n                      <div className=\"sider-messenger-user-item\">\r\n                        <div className=\"sider-messenger-user-item-avatar\">\r\n                          {mess.user_avatar_cropX === null ?\r\n                            <img src={mess.user_avatar} alt={mess.user_last_name} />\r\n                            :\r\n                            <Image cloudName=\"mohi-vn\" publicId={mess.user_avatar+ \".jpg\"} version=\"1607061343\">\r\n                              <Transformation height={mess.user_avatar_cropH}  width={mess.user_avatar_cropW} x={mess.user_avatar_cropX} y={mess.user_avatar_cropY} crop=\"crop\" />\r\n                            </Image>\r\n                          }\r\n                        </div>\r\n                        <div className=\"sider-messenger-content\">\r\n                          <div className=\"sider-messenger-username\">\r\n                            {mess.user_first_name + ' ' + mess.user_last_name}\r\n                          </div>\r\n                          <div className=\"sider-messenger-content-nearest\">\r\n                            {mess.pivot.messages_Message}\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"sider-messenger-time-send\">\r\n                          {moment(mess.pivot.created_at, \"YYYYMMDD\\h:m:s\").fromNow()}\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"sider-messenger-user-item-status\">\r\n                      </div>\r\n                    </li>\r\n                  )\r\n                })}\r\n              </ul>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )\r\n  }\r\n\r\nexport default SiderMessenger;\r\n"]},"metadata":{},"sourceType":"module"}