{"ast":null,"code":"import { latLng } from 'leaflet';\nimport { Identify } from './Identify';\nimport { responseToFeatureCollection, boundsToExtent, _setGeometry } from '../Util';\nexport var IdentifyFeatures = Identify.extend({\n  setters: {\n    'layers': 'layers',\n    'precision': 'geometryPrecision',\n    'tolerance': 'tolerance',\n    // skipped implementing this (for now) because the REST service implementation isnt consistent between operations.\n    // 'transform': 'datumTransformations'\n    'returnGeometry': 'returnGeometry'\n  },\n  params: {\n    sr: 4326,\n    layers: 'all',\n    tolerance: 3,\n    returnGeometry: true\n  },\n  on: function on(map) {\n    var extent = boundsToExtent(map.getBounds());\n    var size = map.getSize();\n    this.params.imageDisplay = [size.x, size.y, 96];\n    this.params.mapExtent = [extent.xmin, extent.ymin, extent.xmax, extent.ymax];\n    return this;\n  },\n  at: function at(geometry) {\n    // cast lat, long pairs in raw array form manually\n    if (geometry.length === 2) {\n      geometry = latLng(geometry);\n    }\n\n    this._setGeometryParams(geometry);\n\n    return this;\n  },\n  layerDef: function layerDef(id, where) {\n    this.params.layerDefs = this.params.layerDefs ? this.params.layerDefs + ';' : '';\n    this.params.layerDefs += [id, where].join(':');\n    return this;\n  },\n  simplify: function simplify(map, factor) {\n    var mapWidth = Math.abs(map.getBounds().getWest() - map.getBounds().getEast());\n    this.params.maxAllowableOffset = mapWidth / map.getSize().y * factor;\n    return this;\n  },\n  run: function run(callback, context) {\n    return this.request(function (error, response) {\n      // immediately invoke with an error\n      if (error) {\n        callback.call(context, error, undefined, response);\n        return; // ok no error lets just assume we have features...\n      } else {\n        var featureCollection = responseToFeatureCollection(response);\n        response.results = response.results.reverse();\n\n        for (var i = 0; i < featureCollection.features.length; i++) {\n          var feature = featureCollection.features[i];\n          feature.layerId = response.results[i].layerId;\n        }\n\n        callback.call(context, undefined, featureCollection, response);\n      }\n    });\n  },\n  _setGeometryParams: function _setGeometryParams(geometry) {\n    var converted = _setGeometry(geometry);\n\n    this.params.geometry = converted.geometry;\n    this.params.geometryType = converted.geometryType;\n  }\n});\nexport function identifyFeatures(options) {\n  return new IdentifyFeatures(options);\n}\nexport default identifyFeatures;","map":{"version":3,"sources":["D:/Web/mohi/client/node_modules/esri-leaflet/src/Tasks/IdentifyFeatures.js"],"names":["latLng","Identify","responseToFeatureCollection","boundsToExtent","_setGeometry","IdentifyFeatures","extend","setters","params","sr","layers","tolerance","returnGeometry","on","map","extent","getBounds","size","getSize","imageDisplay","x","y","mapExtent","xmin","ymin","xmax","ymax","at","geometry","length","_setGeometryParams","layerDef","id","where","layerDefs","join","simplify","factor","mapWidth","Math","abs","getWest","getEast","maxAllowableOffset","run","callback","context","request","error","response","call","undefined","featureCollection","results","reverse","i","features","feature","layerId","converted","geometryType","identifyFeatures","options"],"mappings":"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","sourcesContent":["import { latLng } from 'leaflet';\r\nimport { Identify } from './Identify';\r\nimport { responseToFeatureCollection,\r\n  boundsToExtent,\r\n  _setGeometry\r\n} from '../Util';\r\n\r\nexport var IdentifyFeatures = Identify.extend({\r\n  setters: {\r\n    'layers': 'layers',\r\n    'precision': 'geometryPrecision',\r\n    'tolerance': 'tolerance',\r\n    // skipped implementing this (for now) because the REST service implementation isnt consistent between operations.\r\n    // 'transform': 'datumTransformations'\r\n    'returnGeometry': 'returnGeometry'\r\n  },\r\n\r\n  params: {\r\n    sr: 4326,\r\n    layers: 'all',\r\n    tolerance: 3,\r\n    returnGeometry: true\r\n  },\r\n\r\n  on: function (map) {\r\n    var extent = boundsToExtent(map.getBounds());\r\n    var size = map.getSize();\r\n    this.params.imageDisplay = [size.x, size.y, 96];\r\n    this.params.mapExtent = [extent.xmin, extent.ymin, extent.xmax, extent.ymax];\r\n    return this;\r\n  },\r\n\r\n  at: function (geometry) {\r\n    // cast lat, long pairs in raw array form manually\r\n    if (geometry.length === 2) {\r\n      geometry = latLng(geometry);\r\n    }\r\n    this._setGeometryParams(geometry);\r\n    return this;\r\n  },\r\n\r\n  layerDef: function (id, where) {\r\n    this.params.layerDefs = (this.params.layerDefs) ? this.params.layerDefs + ';' : '';\r\n    this.params.layerDefs += ([id, where]).join(':');\r\n    return this;\r\n  },\r\n\r\n  simplify: function (map, factor) {\r\n    var mapWidth = Math.abs(map.getBounds().getWest() - map.getBounds().getEast());\r\n    this.params.maxAllowableOffset = (mapWidth / map.getSize().y) * factor;\r\n    return this;\r\n  },\r\n\r\n  run: function (callback, context) {\r\n    return this.request(function (error, response) {\r\n      // immediately invoke with an error\r\n      if (error) {\r\n        callback.call(context, error, undefined, response);\r\n        return;\r\n\r\n      // ok no error lets just assume we have features...\r\n      } else {\r\n        var featureCollection = responseToFeatureCollection(response);\r\n        response.results = response.results.reverse();\r\n        for (var i = 0; i < featureCollection.features.length; i++) {\r\n          var feature = featureCollection.features[i];\r\n          feature.layerId = response.results[i].layerId;\r\n        }\r\n        callback.call(context, undefined, featureCollection, response);\r\n      }\r\n    });\r\n  },\r\n\r\n  _setGeometryParams: function (geometry) {\r\n    var converted = _setGeometry(geometry);\r\n    this.params.geometry = converted.geometry;\r\n    this.params.geometryType = converted.geometryType;\r\n  }\r\n});\r\n\r\nexport function identifyFeatures (options) {\r\n  return new IdentifyFeatures(options);\r\n}\r\n\r\nexport default identifyFeatures;\r\n"]},"metadata":{},"sourceType":"module"}