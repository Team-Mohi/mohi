{"ast":null,"code":"var _jsxFileName = \"D:\\\\Web\\\\mohi\\\\client\\\\src\\\\Components\\\\Messenger\\\\ContentMessenger.jsx\";\nimport React, { useState, useEffect, useRef, useCallback, useContext } from 'react';\nimport { FaSmile } from 'react-icons/fa';\nimport { GiPhone } from 'react-icons/gi';\nimport { MdRadioButtonUnchecked } from 'react-icons/md';\nimport { AiOutlineCheckCircle } from 'react-icons/ai';\nimport { Image, Transformation } from 'cloudinary-react';\nimport { BsSearch, BsFillCameraVideoFill, BsThreeDotsVertical, BsImage, BsPencilSquare } from 'react-icons/bs';\nimport { AiTwotoneSetting, AiTwotoneLike, AiFillFile, AiFillCamera, AiFillCloseCircle } from 'react-icons/ai';\nimport { Row, Spin } from 'antd';\nimport useWindowSize from \"./useWindowSize.jsx\";\nimport { Link } from \"react-router-dom\";\nimport EditorEmoji from \"./EditorEmoji.jsx\";\nimport { useSelector, useDispatch } from 'react-redux';\nimport { useParams, useHistory } from 'react-router-dom';\nimport { setCurrentOneMessage } from './../../Actions/index.jsx';\nimport { addNewMessageOflist } from './../../Actions/index.jsx';\nimport { addNewMessage } from './../../Actions/index.jsx';\nimport { WaveLoading } from 'react-loadingg';\nimport axios from 'axios';\nimport SocketContext from './../Socket/index.jsx';\nimport moment from 'moment';\nimport 'moment/locale/vi';\nimport { readMessage } from './../../Actions/index.jsx';\nimport { readMessageOfList } from './../../Actions/index.jsx';\nimport { readMyMessage } from './../../Actions/index.jsx';\nimport { typingMess } from './../../Actions/index.jsx';\nexport const ContentMessenger = (props, {\n  oneMessage\n}) => {\n  const {\n    idUser\n  } = useParams();\n  const observer = useRef();\n  const inputImageRef = useRef();\n  const keepScrollToBottom = useRef();\n  const dispatch = useDispatch();\n  var {\n    list,\n    infoUser,\n    loading,\n    hasMore,\n    loadingMore,\n    typing\n  } = useSelector(state => state.oneMessage);\n  const socket = useContext(SocketContext);\n  const heightContent = window.innerHeight - 134;\n  const [setupFakeName, setSetupFakeName] = useState(false);\n  const [heightContentBody, setHeightContentBody] = useState({\n    height: heightContent\n  });\n  const windowSize = useWindowSize();\n  const [heightRoom, setHeightRoom] = useState({\n    height: heightContent - 56\n  });\n  const [showSearchRoomChat, setShowSearchRoomChat] = useState(false);\n  const [newImageMess, setNewImageMess] = useState();\n  const [newVideoMess, setNewVideoMess] = useState();\n  var currentUser = JSON.parse(localStorage.getItem('ustk')).info;\n  const [listNewMess, setListNewMess] = useState([]);\n  const [listOnline, setListOnline] = useState();\n  const history = useHistory();\n  useEffect(() => {\n    socket.on('private-chat', function (data) {\n      dispatch(addNewMessage(data.message));\n\n      if (keepScrollToBottom.current) {\n        keepScrollToBottom.current.scrollTop = keepScrollToBottom.current.scrollHeight;\n      }\n    });\n    socket.on('read-message', function (data) {\n      dispatch(readMessage({\n        id: data.idUser,\n        clientId: data.clientId\n      }));\n    });\n    socket.on('typing-mess', function (data) {\n      dispatch(typingMess({\n        from: data.from.id,\n        status: data.status\n      }));\n\n      if (keepScrollToBottom.current) {\n        keepScrollToBottom.current.scrollTop = keepScrollToBottom.current.scrollHeight;\n      }\n    });\n    socket.on('register', function (data) {\n      setListOnline(data);\n    });\n\n    if (history.location.state) {\n      dispatch(readMessageOfList({\n        id: currentUser.id,\n        clientId: history.location.state.id\n      }));\n    }\n  }, []);\n  useEffect(() => {\n    props.getMessageOneUser(idUser);\n  }, [idUser]);\n  useEffect(() => {\n    if (keepScrollToBottom.current) {\n      keepScrollToBottom.current.scrollTop = keepScrollToBottom.current.scrollHeight;\n    }\n  }, [loading]);\n  useEffect(() => {\n    setHeightContentBody({\n      height: heightContent\n    });\n    setHeightRoom({\n      height: heightContent - 56\n    });\n  }, [windowSize]);\n\n  const IsOnline = props => {\n    let result = '';\n\n    if (listOnline) {\n      Object.keys(listOnline).forEach(key => {\n        if (listOnline[key] === props.username) {\n          result = /*#__PURE__*/React.createElement(\"div\", {\n            className: \"content-messenger-info-status\",\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 94,\n              columnNumber: 22\n            }\n          }, /*#__PURE__*/React.createElement(\"span\", {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 94,\n              columnNumber: 69\n            }\n          }, \"\\u0110ang ho\\u1EA1t \\u0111\\u1ED9ng\"), \" \", /*#__PURE__*/React.createElement(\"p\", {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 94,\n              columnNumber: 97\n            }\n          }));\n        }\n      });\n    }\n\n    ;\n    return result;\n  };\n\n  const isTypingMess = status => {\n    socket.emit('typing-mess', {\n      from: currentUser,\n      to: infoUser,\n      status: status\n    });\n  };\n\n  const readMess = async () => {\n    await axios.post(\"https://www.api.mohi.vn/api/auth/read-message\", {\n      id: infoUser.id\n    }).then(res => {\n      dispatch(readMessageOfList({\n        id: currentUser.id,\n        clientId: infoUser.id\n      }));\n      socket.emit('read-message', {\n        user_username: infoUser.user_username,\n        idUser: infoUser.id,\n        clientId: currentUser.id\n      });\n    });\n  };\n\n  const onSubmitMess = async value => {\n    var newMsg = {\n      id: currentUser.id,\n      avtatar: currentUser.user_avatar,\n      name: currentUser.user_first_name + ' ' + currentUser.user_last_name,\n      message: value,\n      time: new Date()\n    };\n    setListNewMess([...listNewMess, newMsg]);\n    keepScrollToBottom.current.scrollTop = keepScrollToBottom.current.scrollHeight;\n    await axios.post(\"https://www.api.mohi.vn/api/auth/send-message\", {\n      messages_Message: value,\n      id: infoUser.id\n    }).then(res => {\n      dispatch(addNewMessage(res.data));\n      dispatch(addNewMessageOflist({\n        type: 'send',\n        to: res.data[0].user_receive,\n        message: res.data\n      }));\n      setListNewMess([]);\n      socket.emit('private-chat', {\n        from: currentUser,\n        to: res.data[0].user_receive,\n        message: res.data\n      });\n    });\n  };\n\n  const lastMessage = useCallback(node => {\n    if (loadingMore) return;\n    if (observer.current) observer.current.disconnect();\n    observer.current = new IntersectionObserver(entries => {\n      if (entries[0].isIntersecting && hasMore) {\n        dispatch(setCurrentOneMessage());\n        keepScrollToBottom.current.scrollTop = 500;\n      }\n    });\n    if (node) observer.current.observe(node);\n  }, [loadingMore, hasMore]);\n\n  function setupFakeNameFunc() {\n    setSetupFakeName(true);\n  }\n\n  function saveFakeNameFunc() {\n    setSetupFakeName(false);\n  }\n\n  function showSearchRoomChatFunc() {\n    setShowSearchRoomChat(true);\n  }\n\n  function hideSearchRoomChatFunc() {\n    setShowSearchRoomChat(false);\n  }\n\n  const onChangeSendImage = e => {\n    let file = e.target.files[0];\n    let blobUrl = URL.createObjectURL(file);\n    URL.revokeObjectURL(file);\n\n    if (file.type === 'video/ogg' || file.type === 'video/mp4') {\n      setNewVideoMess(blobUrl);\n      setNewImageMess();\n    }\n\n    if (file.type === 'image/png' || file.type === 'image/jpg' || file.type === 'image/jpeg') {\n      setNewImageMess(blobUrl);\n      setNewVideoMess();\n    }\n  };\n\n  const deleteImageMess = () => {\n    setNewImageMess();\n    setNewVideoMess();\n  };\n\n  if (loading) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"content-messenger-container\",\n      style: {\n        position: 'relative',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(WaveLoading, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 192,\n        columnNumber: 11\n      }\n    }));\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-messenger-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-messenger-head\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-messenger-info\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-messenger-info-avatar\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 15\n    }\n  }, infoUser.user_avatar_cropX === null ? /*#__PURE__*/React.createElement(\"img\", {\n    src: infoUser.user_avatar,\n    alt: infoUser.user_last_name,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 19\n    }\n  }) : /*#__PURE__*/React.createElement(Image, {\n    cloudName: \"mohi-vn\",\n    publicId: infoUser.user_avatar + \".jpg\",\n    version: \"1607061343\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(Transformation, {\n    height: infoUser.user_avatar_cropH,\n    width: infoUser.user_avatar_cropW,\n    x: infoUser.user_avatar_cropX,\n    y: infoUser.user_avatar_cropY,\n    crop: \"crop\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 21\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-messenger-info-name\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 17\n    }\n  }, infoUser.user_first_name + ' ' + infoUser.user_last_name), /*#__PURE__*/React.createElement(IsOnline, {\n    username: infoUser.user_username,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 17\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-messenger-option\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-messenger-body\",\n    style: heightContentBody,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-messenger-body-left\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-messenger-room\",\n    style: heightRoom,\n    ref: keepScrollToBottom,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 15\n    }\n  }, loadingMore && /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      textAlign: 'center',\n      background: 'rgba(0,128,128,0.3)',\n      marginBottom: '10px',\n      borderRadius: '3px',\n      padding: '3px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 33\n    }\n  }, \"\\u0110ang t\\u1EA3i th\\xEAm tin nh\\u1EAFn vui l\\xF2ng \\u0111\\u1EE3i...\"), list.map((mess, index) => {\n    if (mess.messages_From === currentUser.id) {\n      return /*#__PURE__*/React.createElement(React.Fragment, {\n        key: index,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"content-messenger-my-chat\",\n        ref: index === 0 ? lastMessage : null,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          textAlign: 'center',\n          fontSize: '11px',\n          fontWeight: '600',\n          color: 'rgba(0,0,0,0.7)'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 227,\n          columnNumber: 27\n        }\n      }, index > 0 && new Date(mess.created_at).getTime() - new Date(list[index - 1].created_at).getTime() > 600000 && moment(mess.created_at).format(\"\\h:m, DD-MM-YYYY\")), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"content-messenger-my-chat-content\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 230,\n          columnNumber: 27\n        }\n      }, /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 231,\n          columnNumber: 29\n        }\n      }, mess.messages_Message), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"content-messenger-my-chat-content-status\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 232,\n          columnNumber: 29\n        }\n      }, index < list.length - 1 && list[index + 1].messages_ReadAt === null && /*#__PURE__*/React.createElement(React.Fragment, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 33\n        }\n      }, mess.messages_ReadAt !== null ? /*#__PURE__*/React.createElement(React.Fragment, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 236,\n          columnNumber: 37\n        }\n      }, mess.user_receive.user_avatar_cropX === null ? /*#__PURE__*/React.createElement(\"img\", {\n        src: mess.user_receive.user_avatar,\n        alt: mess.user_receive.user_last_name,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 238,\n          columnNumber: 41\n        }\n      }) : /*#__PURE__*/React.createElement(Image, {\n        cloudName: \"mohi-vn\",\n        publicId: mess.user_receive.user_avatar + \".jpg\",\n        version: \"1607061343\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 240,\n          columnNumber: 41\n        }\n      }, /*#__PURE__*/React.createElement(Transformation, {\n        height: mess.user_receive.user_avatar_cropH,\n        width: mess.user_receive.user_avatar_cropW,\n        x: mess.user_receive.user_avatar_cropX,\n        y: mess.user_receive.user_avatar_cropY,\n        crop: \"crop\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 241,\n          columnNumber: 43\n        }\n      }))) : /*#__PURE__*/React.createElement(AiOutlineCheckCircle, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 246,\n          columnNumber: 37\n        }\n      })), index === list.length - 1 && /*#__PURE__*/React.createElement(React.Fragment, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 251,\n          columnNumber: 33\n        }\n      }, mess.messages_ReadAt !== null ? /*#__PURE__*/React.createElement(React.Fragment, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 253,\n          columnNumber: 37\n        }\n      }, mess.user_receive.user_avatar_cropX === null ? /*#__PURE__*/React.createElement(\"img\", {\n        src: mess.user_receive.user_avatar,\n        alt: mess.user_receive.user_last_name,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 255,\n          columnNumber: 41\n        }\n      }) : /*#__PURE__*/React.createElement(Image, {\n        cloudName: \"mohi-vn\",\n        publicId: mess.user_receive.user_avatar + \".jpg\",\n        version: \"1607061343\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 257,\n          columnNumber: 41\n        }\n      }, /*#__PURE__*/React.createElement(Transformation, {\n        height: mess.user_receive.user_avatar_cropH,\n        width: mess.user_receive.user_avatar_cropW,\n        x: mess.user_receive.user_avatar_cropX,\n        y: mess.user_receive.user_avatar_cropY,\n        crop: \"crop\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 258,\n          columnNumber: 43\n        }\n      }))) : /*#__PURE__*/React.createElement(AiOutlineCheckCircle, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 263,\n          columnNumber: 37\n        }\n      }))))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"clear\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 270,\n          columnNumber: 25\n        }\n      }));\n    } else {\n      return /*#__PURE__*/React.createElement(React.Fragment, {\n        key: index,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 275,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"content-messenger-user-chat\",\n        ref: index === 0 ? lastMessage : null,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 276,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          textAlign: 'center',\n          fontSize: '11px',\n          fontWeight: '600',\n          color: 'rgba(0,0,0,0.7)'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 277,\n          columnNumber: 27\n        }\n      }, index > 0 && new Date(mess.created_at).getTime() - new Date(list[index - 1].created_at).getTime() > 600000 && moment(mess.created_at).format(\"\\h:m, DD-MM-YYYY\")), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"content-messenger-user-chat-content\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 280,\n          columnNumber: 27\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"content-messenger-user-chat-content-avatar\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 281,\n          columnNumber: 29\n        }\n      }, index + 1 <= list.length - 1 && mess.messages_From !== list[index + 1].messages_From && /*#__PURE__*/React.createElement(React.Fragment, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 283,\n          columnNumber: 33\n        }\n      }, mess.user_send.user_avatar_cropX === null ? /*#__PURE__*/React.createElement(\"img\", {\n        src: mess.user_send.user_avatar,\n        alt: mess.user_send.user_last_name,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 285,\n          columnNumber: 37\n        }\n      }) : /*#__PURE__*/React.createElement(Image, {\n        cloudName: \"mohi-vn\",\n        publicId: mess.user_send.user_avatar + \".jpg\",\n        version: \"1607061343\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 287,\n          columnNumber: 37\n        }\n      }, /*#__PURE__*/React.createElement(Transformation, {\n        height: mess.user_send.user_avatar_cropH,\n        width: mess.user_send.user_avatar_cropW,\n        x: mess.user_send.user_avatar_cropX,\n        y: mess.user_send.user_avatar_cropY,\n        crop: \"crop\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 288,\n          columnNumber: 39\n        }\n      }))), index === list.length - 1 && /*#__PURE__*/React.createElement(React.Fragment, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 294,\n          columnNumber: 33\n        }\n      }, mess.user_send.user_avatar_cropX === null ? /*#__PURE__*/React.createElement(\"img\", {\n        src: mess.user_send.user_avatar,\n        alt: mess.user_send.user_last_name,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 296,\n          columnNumber: 37\n        }\n      }) : /*#__PURE__*/React.createElement(Image, {\n        cloudName: \"mohi-vn\",\n        publicId: mess.user_send.user_avatar + \".jpg\",\n        version: \"1607061343\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 298,\n          columnNumber: 37\n        }\n      }, /*#__PURE__*/React.createElement(Transformation, {\n        height: mess.user_send.user_avatar_cropH,\n        width: mess.user_send.user_avatar_cropW,\n        x: mess.user_send.user_avatar_cropX,\n        y: mess.user_send.user_avatar_cropY,\n        crop: \"crop\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 299,\n          columnNumber: 39\n        }\n      })))), /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 305,\n          columnNumber: 29\n        }\n      }, mess.messages_Message))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"clear\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 308,\n          columnNumber: 25\n        }\n      }));\n    }\n  }), listNewMess.map((msg, index) => {\n    return /*#__PURE__*/React.createElement(React.Fragment, {\n      key: index,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 315,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"content-messenger-my-chat\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 316,\n        columnNumber: 23\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"content-messenger-my-chat-content\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 317,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 318,\n        columnNumber: 27\n      }\n    }, msg.message), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"content-messenger-my-chat-content-status\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 319,\n        columnNumber: 27\n      }\n    }, /*#__PURE__*/React.createElement(MdRadioButtonUnchecked, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 320,\n        columnNumber: 27\n      }\n    })))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"clear\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 324,\n        columnNumber: 23\n      }\n    }));\n  }), typing && /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 328,\n      columnNumber: 28\n    }\n  }, infoUser.user_first_name + ' ' + infoUser.user_last_name, \" \\u0111ang nh\\u1EADp tin nh\\u1EAFn...\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-messenger-input\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 330,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"preview-image-send\",\n    style: newImageMess || newVideoMess ? {\n      opacity: 1\n    } : null,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 331,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"preview-image-send-img\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 332,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(AiFillCloseCircle, {\n    onClick: deleteImageMess,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 333,\n      columnNumber: 23\n    }\n  }), newImageMess && /*#__PURE__*/React.createElement(\"img\", {\n    src: newImageMess,\n    alt: \"Tin nh\\u1EAFn h\\xECnh \\u1EA3nh\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 335,\n      columnNumber: 25\n    }\n  }), newVideoMess && /*#__PURE__*/React.createElement(\"video\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 338,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"source\", {\n    src: newVideoMess,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 339,\n      columnNumber: 27\n    }\n  }), \"Your browser does not support HTML5 video.\"))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-messenger-input-text\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 345,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(EditorEmoji, {\n    onSubmitMess: onSubmitMess,\n    isTypingMess: isTypingMess,\n    readMess: readMess,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 346,\n      columnNumber: 19\n    }\n  })))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-messenger-body-right\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 350,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-messenger-body-right-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 351,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-messenger-body-right-head\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 352,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-messenger-body-right-head-avatar\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 353,\n      columnNumber: 19\n    }\n  }, infoUser.user_avatar_cropX === null ? /*#__PURE__*/React.createElement(\"img\", {\n    src: infoUser.user_avatar,\n    alt: infoUser.user_last_name,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 355,\n      columnNumber: 23\n    }\n  }) : /*#__PURE__*/React.createElement(Image, {\n    cloudName: \"mohi-vn\",\n    publicId: infoUser.user_avatar + \".jpg\",\n    version: \"1607061343\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 357,\n      columnNumber: 23\n    }\n  }, /*#__PURE__*/React.createElement(Transformation, {\n    height: infoUser.user_avatar_cropH,\n    width: infoUser.user_avatar_cropW,\n    x: infoUser.user_avatar_cropX,\n    y: infoUser.user_avatar_cropY,\n    crop: \"crop\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 358,\n      columnNumber: 25\n    }\n  })))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-messenger-body-right-head-name\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 363,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Link, {\n    to: \"profile/\" + infoUser.user_username,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 364,\n      columnNumber: 19\n    }\n  }, infoUser.user_first_name + ' ' + infoUser.user_last_name))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-messenger-body-right-support\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 367,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-messenger-body-right-support-item\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 368,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-messenger-body-right-list-iamge-share\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 369,\n      columnNumber: 19\n    }\n  }))))));\n};","map":{"version":3,"sources":["D:/Web/mohi/client/src/Components/Messenger/ContentMessenger.jsx"],"names":["React","useState","useEffect","useRef","useCallback","useContext","FaSmile","GiPhone","MdRadioButtonUnchecked","AiOutlineCheckCircle","Image","Transformation","BsSearch","BsFillCameraVideoFill","BsThreeDotsVertical","BsImage","BsPencilSquare","AiTwotoneSetting","AiTwotoneLike","AiFillFile","AiFillCamera","AiFillCloseCircle","Row","Spin","useWindowSize","Link","EditorEmoji","useSelector","useDispatch","useParams","useHistory","setCurrentOneMessage","addNewMessageOflist","addNewMessage","WaveLoading","axios","SocketContext","moment","readMessage","readMessageOfList","readMyMessage","typingMess","ContentMessenger","props","oneMessage","idUser","observer","inputImageRef","keepScrollToBottom","dispatch","list","infoUser","loading","hasMore","loadingMore","typing","state","socket","heightContent","window","innerHeight","setupFakeName","setSetupFakeName","heightContentBody","setHeightContentBody","height","windowSize","heightRoom","setHeightRoom","showSearchRoomChat","setShowSearchRoomChat","newImageMess","setNewImageMess","newVideoMess","setNewVideoMess","currentUser","JSON","parse","localStorage","getItem","info","listNewMess","setListNewMess","listOnline","setListOnline","history","on","data","message","current","scrollTop","scrollHeight","id","clientId","from","status","location","getMessageOneUser","IsOnline","result","Object","keys","forEach","key","username","isTypingMess","emit","to","readMess","post","then","res","user_username","onSubmitMess","value","newMsg","avtatar","user_avatar","name","user_first_name","user_last_name","time","Date","messages_Message","type","user_receive","lastMessage","node","disconnect","IntersectionObserver","entries","isIntersecting","observe","setupFakeNameFunc","saveFakeNameFunc","showSearchRoomChatFunc","hideSearchRoomChatFunc","onChangeSendImage","e","file","target","files","blobUrl","URL","createObjectURL","revokeObjectURL","deleteImageMess","position","display","alignItems","justifyContent","user_avatar_cropX","user_avatar_cropH","user_avatar_cropW","user_avatar_cropY","textAlign","background","marginBottom","borderRadius","padding","map","mess","index","messages_From","fontSize","fontWeight","color","created_at","getTime","format","length","messages_ReadAt","user_send","msg","opacity"],"mappings":"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","sourcesContent":["import React, {useState, useEffect, useRef, useCallback, useContext} from 'react';\r\nimport {FaSmile} from 'react-icons/fa';\r\nimport {GiPhone} from 'react-icons/gi';\r\nimport {MdRadioButtonUnchecked} from 'react-icons/md';\r\nimport {AiOutlineCheckCircle} from 'react-icons/ai';\r\nimport {Image,Transformation} from 'cloudinary-react';\r\nimport {BsSearch, BsFillCameraVideoFill, BsThreeDotsVertical, BsImage, BsPencilSquare} from 'react-icons/bs';\r\nimport {AiTwotoneSetting, AiTwotoneLike, AiFillFile, AiFillCamera, AiFillCloseCircle} from 'react-icons/ai';\r\nimport {Row, Spin} from 'antd';\r\nimport useWindowSize from \"./useWindowSize.jsx\";\r\nimport {Link} from \"react-router-dom\";\r\nimport EditorEmoji from \"./EditorEmoji.jsx\";\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { useParams, useHistory } from 'react-router-dom';\r\nimport {setCurrentOneMessage} from './../../Actions/index.jsx';\r\nimport {addNewMessageOflist} from './../../Actions/index.jsx';\r\nimport {addNewMessage} from './../../Actions/index.jsx';\r\nimport { WaveLoading } from 'react-loadingg';\r\nimport axios from 'axios';\r\nimport SocketContext from './../Socket/index.jsx';\r\nimport moment from 'moment';\r\nimport 'moment/locale/vi';\r\nimport {readMessage} from './../../Actions/index.jsx';\r\nimport {readMessageOfList} from './../../Actions/index.jsx';\r\nimport {readMyMessage} from './../../Actions/index.jsx';\r\nimport {typingMess} from './../../Actions/index.jsx';\r\n\r\nexport const ContentMessenger = (props, {oneMessage}) => {\r\n  const {idUser} = useParams();\r\n  const observer = useRef();\r\n  const inputImageRef = useRef();\r\n  const keepScrollToBottom = useRef();\r\n  const dispatch = useDispatch();\r\n  var {list, infoUser, loading, hasMore, loadingMore, typing} = useSelector(state => state.oneMessage);\r\n  const socket = useContext(SocketContext);\r\n  const heightContent = window.innerHeight - 134;\r\n  const [setupFakeName, setSetupFakeName] = useState(false)\r\n  const [heightContentBody, setHeightContentBody] = useState({height: heightContent})\r\n  const windowSize = useWindowSize();\r\n  const [heightRoom, setHeightRoom] = useState({height: heightContent - 56})\r\n  const [showSearchRoomChat, setShowSearchRoomChat] = useState(false)\r\n  const [newImageMess, setNewImageMess] = useState();\r\n  const [newVideoMess, setNewVideoMess] = useState();\r\n  var currentUser = JSON.parse(localStorage.getItem('ustk')).info;\r\n  const [listNewMess, setListNewMess] = useState([]);\r\n  const [listOnline, setListOnline] = useState();\r\n  const history = useHistory();\r\n\r\n  useEffect(() => {\r\n    socket.on('private-chat', function(data){\r\n        dispatch(addNewMessage(data.message))\r\n        if(keepScrollToBottom.current) {\r\n          keepScrollToBottom.current.scrollTop = keepScrollToBottom.current.scrollHeight;\r\n        }\r\n    });\r\n    socket.on('read-message', function(data){\r\n      dispatch(readMessage({id: data.idUser, clientId: data.clientId}))\r\n    });\r\n    socket.on('typing-mess', function(data){\r\n      dispatch(typingMess({from: data.from.id, status: data.status}));\r\n      if(keepScrollToBottom.current) {\r\n        keepScrollToBottom.current.scrollTop = keepScrollToBottom.current.scrollHeight;\r\n      }\r\n    });\r\n    socket.on('register', function(data){\r\n      setListOnline(data)\r\n    });\r\n\r\n    if(history.location.state){\r\n      dispatch(readMessageOfList({id: currentUser.id, clientId: history.location.state.id}))\r\n    }\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    props.getMessageOneUser(idUser)\r\n  }, [idUser])\r\n\r\n  useEffect(() => {\r\n    if(keepScrollToBottom.current) {\r\n        keepScrollToBottom.current.scrollTop = keepScrollToBottom.current.scrollHeight;\r\n    }\r\n  }, [loading])\r\n\r\n  useEffect(() => {\r\n    setHeightContentBody({height: heightContent})\r\n    setHeightRoom({height: heightContent - 56})\r\n  },[windowSize])\r\n\r\n  const IsOnline = (props) => {\r\n    let result = '';\r\n    if(listOnline){\r\n      Object.keys(listOnline).forEach(key => {\r\n          if(listOnline[key] === props.username){\r\n            result = <div className=\"content-messenger-info-status\"><span>Đang hoạt động</span> <p></p></div>;\r\n          }\r\n      });\r\n    };\r\n\r\n    return result;\r\n  }\r\n\r\n  const isTypingMess = (status) => {\r\n    socket.emit('typing-mess', {from : currentUser, to : infoUser, status: status})\r\n  }\r\n\r\n  const readMess = async () => {\r\n    await axios.post(\"https://www.api.mohi.vn/api/auth/read-message\", {id: infoUser.id}).then((res) => {\r\n      dispatch(readMessageOfList({id: currentUser.id, clientId: infoUser.id}))\r\n      socket.emit('read-message', {user_username: infoUser.user_username, idUser: infoUser.id, clientId: currentUser.id})\r\n    })\r\n  }\r\n\r\n  const onSubmitMess = async (value) => {\r\n\r\n    var newMsg = {\r\n      id: currentUser.id,\r\n      avtatar: currentUser.user_avatar,\r\n      name: currentUser.user_first_name + ' ' + currentUser.user_last_name,\r\n      message: value,\r\n      time: new Date()\r\n    }\r\n\r\n    setListNewMess([...listNewMess, newMsg]);\r\n    keepScrollToBottom.current.scrollTop = keepScrollToBottom.current.scrollHeight;\r\n    await axios.post(\"https://www.api.mohi.vn/api/auth/send-message\", {\r\n      messages_Message: value,\r\n      id: infoUser.id\r\n    })\r\n    .then((res) => {\r\n      dispatch(addNewMessage(res.data))\r\n      dispatch(addNewMessageOflist({type: 'send', to : res.data[0].user_receive, message: res.data}))\r\n      setListNewMess([]);\r\n      socket.emit('private-chat', {from : currentUser, to : res.data[0].user_receive, message: res.data})\r\n    })\r\n\r\n  }\r\n\r\n  const lastMessage = useCallback(node => {\r\n    if(loadingMore) return\r\n      if(observer.current) observer.current.disconnect()\r\n      observer.current = new IntersectionObserver(entries => {\r\n        if(entries[0].isIntersecting && hasMore){\r\n          dispatch(setCurrentOneMessage())\r\n          keepScrollToBottom.current.scrollTop = 500;\r\n        }\r\n      })\r\n    if(node) observer.current.observe(node)\r\n  }, [loadingMore, hasMore])\r\n\r\n  function setupFakeNameFunc(){\r\n    setSetupFakeName(true)\r\n  }\r\n\r\n  function saveFakeNameFunc(){\r\n    setSetupFakeName(false)\r\n  }\r\n\r\n  function showSearchRoomChatFunc(){\r\n    setShowSearchRoomChat(true)\r\n  }\r\n\r\n  function hideSearchRoomChatFunc(){\r\n    setShowSearchRoomChat(false)\r\n  }\r\n\r\n  const onChangeSendImage = (e) => {\r\n\r\n      let file = e.target.files[0];\r\n      let blobUrl = URL.createObjectURL(file)\r\n      URL.revokeObjectURL(file)\r\n\r\n      if(file.type === 'video/ogg' || file.type === 'video/mp4'){\r\n        setNewVideoMess(blobUrl)\r\n        setNewImageMess()\r\n      }\r\n      if(file.type === 'image/png' || file.type === 'image/jpg' || file.type === 'image/jpeg'){\r\n        setNewImageMess(blobUrl)\r\n        setNewVideoMess()\r\n      }\r\n\r\n  }\r\n\r\n  const deleteImageMess = () => {\r\n    setNewImageMess()\r\n    setNewVideoMess()\r\n\r\n  }\r\n\r\n    if(loading){\r\n      return(\r\n        <div className=\"content-messenger-container\" style={{position: 'relative', display: 'flex', alignItems:'center', justifyContent: 'center'}}>\r\n          <WaveLoading />\r\n        </div>\r\n      )\r\n    }\r\n\r\n      return(\r\n        <div className=\"content-messenger-container\">\r\n          <div className=\"content-messenger-head\">\r\n            <div className=\"content-messenger-info\">\r\n              <div className=\"content-messenger-info-avatar\">\r\n                {infoUser.user_avatar_cropX === null ?\r\n                  <img src={infoUser.user_avatar} alt={infoUser.user_last_name} />\r\n                  :\r\n                  <Image cloudName=\"mohi-vn\" publicId={infoUser.user_avatar+ \".jpg\"} version=\"1607061343\">\r\n                    <Transformation height={infoUser.user_avatar_cropH}  width={infoUser.user_avatar_cropW} x={infoUser.user_avatar_cropX} y={infoUser.user_avatar_cropY} crop=\"crop\" />\r\n                  </Image>\r\n                }\r\n              </div>\r\n              <div>\r\n                <div className=\"content-messenger-info-name\">{infoUser.user_first_name + ' ' + infoUser.user_last_name}</div>\r\n                <IsOnline username={infoUser.user_username} />\r\n              </div>\r\n            </div>\r\n            <div className=\"content-messenger-option\">\r\n            </div>\r\n          </div>\r\n          <div className=\"content-messenger-body\" style={heightContentBody}>\r\n            <div className=\"content-messenger-body-left\" >\r\n              <div className=\"content-messenger-room\" style={heightRoom} ref={keepScrollToBottom}>\r\n                {loadingMore && <div style={{textAlign: 'center', background: 'rgba(0,128,128,0.3)', marginBottom: '10px', borderRadius: '3px', padding: '3px' }}>Đang tải thêm tin nhắn vui lòng đợi...</div>}\r\n                {list.map((mess, index) => {\r\n                  if(mess.messages_From === currentUser.id){\r\n                    return(\r\n                      <React.Fragment key={index}>\r\n                        <div className=\"content-messenger-my-chat\" ref={index === 0 ? lastMessage : null}>\r\n                          <div style={{textAlign: 'center', fontSize: '11px', fontWeight: '600', color: 'rgba(0,0,0,0.7)'}}>\r\n                            {index > 0 && new Date(mess.created_at).getTime() - new Date(list[index - 1].created_at).getTime() > 600000 && moment(mess.created_at).format(\"\\h:m, DD-MM-YYYY\")}\r\n                          </div>\r\n                          <div className=\"content-messenger-my-chat-content\">\r\n                            <p>{mess.messages_Message}</p>\r\n                            <div className=\"content-messenger-my-chat-content-status\">\r\n                              {index < list.length - 1 && list[index + 1].messages_ReadAt === null &&\r\n                                <React.Fragment>\r\n                                  {mess.messages_ReadAt !== null ?\r\n                                    <React.Fragment>\r\n                                      {mess.user_receive.user_avatar_cropX === null ?\r\n                                        <img src={mess.user_receive.user_avatar} alt={mess.user_receive.user_last_name} />\r\n                                        :\r\n                                        <Image cloudName=\"mohi-vn\" publicId={mess.user_receive.user_avatar+ \".jpg\"} version=\"1607061343\">\r\n                                          <Transformation height={mess.user_receive.user_avatar_cropH}  width={mess.user_receive.user_avatar_cropW} x={mess.user_receive.user_avatar_cropX} y={mess.user_receive.user_avatar_cropY} crop=\"crop\" />\r\n                                        </Image>\r\n                                      }\r\n                                    </React.Fragment>\r\n                                    :\r\n                                    <AiOutlineCheckCircle />\r\n                                  }\r\n                                </React.Fragment>\r\n                              }\r\n                              {index === list.length - 1 &&\r\n                                <React.Fragment>\r\n                                  {mess.messages_ReadAt !== null ?\r\n                                    <React.Fragment>\r\n                                      {mess.user_receive.user_avatar_cropX === null ?\r\n                                        <img src={mess.user_receive.user_avatar} alt={mess.user_receive.user_last_name} />\r\n                                        :\r\n                                        <Image cloudName=\"mohi-vn\" publicId={mess.user_receive.user_avatar+ \".jpg\"} version=\"1607061343\">\r\n                                          <Transformation height={mess.user_receive.user_avatar_cropH}  width={mess.user_receive.user_avatar_cropW} x={mess.user_receive.user_avatar_cropX} y={mess.user_receive.user_avatar_cropY} crop=\"crop\" />\r\n                                        </Image>\r\n                                      }\r\n                                    </React.Fragment>\r\n                                    :\r\n                                    <AiOutlineCheckCircle />\r\n                                  }\r\n                                </React.Fragment>\r\n                              }\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"clear\"></div>\r\n                      </React.Fragment>\r\n                    )\r\n                  }else {\r\n                    return(\r\n                      <React.Fragment key={index}>\r\n                        <div className=\"content-messenger-user-chat\" ref={index === 0 ? lastMessage : null}>\r\n                          <div style={{textAlign: 'center', fontSize: '11px', fontWeight: '600', color: 'rgba(0,0,0,0.7)'}}>\r\n                            {index > 0 && new Date(mess.created_at).getTime() - new Date(list[index - 1].created_at).getTime() > 600000 && moment(mess.created_at).format(\"\\h:m, DD-MM-YYYY\")}\r\n                          </div>\r\n                          <div className=\"content-messenger-user-chat-content\">\r\n                            <div className=\"content-messenger-user-chat-content-avatar\">\r\n                              {index + 1 <= list.length -1 && mess.messages_From !== list[index + 1].messages_From &&\r\n                                <React.Fragment>\r\n                                  {mess.user_send.user_avatar_cropX === null ?\r\n                                    <img src={mess.user_send.user_avatar} alt={mess.user_send.user_last_name} />\r\n                                    :\r\n                                    <Image cloudName=\"mohi-vn\" publicId={mess.user_send.user_avatar+ \".jpg\"} version=\"1607061343\">\r\n                                      <Transformation height={mess.user_send.user_avatar_cropH}  width={mess.user_send.user_avatar_cropW} x={mess.user_send.user_avatar_cropX} y={mess.user_send.user_avatar_cropY} crop=\"crop\" />\r\n                                    </Image>\r\n                                  }\r\n                                </React.Fragment>\r\n                              }\r\n                              {index === list.length - 1 &&\r\n                                <React.Fragment>\r\n                                  {mess.user_send.user_avatar_cropX === null ?\r\n                                    <img src={mess.user_send.user_avatar} alt={mess.user_send.user_last_name} />\r\n                                    :\r\n                                    <Image cloudName=\"mohi-vn\" publicId={mess.user_send.user_avatar+ \".jpg\"} version=\"1607061343\">\r\n                                      <Transformation height={mess.user_send.user_avatar_cropH}  width={mess.user_send.user_avatar_cropW} x={mess.user_send.user_avatar_cropX} y={mess.user_send.user_avatar_cropY} crop=\"crop\" />\r\n                                    </Image>\r\n                                  }\r\n                                </React.Fragment>\r\n                              }\r\n                            </div>\r\n                            <p>{mess.messages_Message}</p>\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"clear\"></div>\r\n                      </React.Fragment>\r\n                    )\r\n                  }\r\n                })}\r\n                {listNewMess.map((msg, index) => {\r\n                  return(\r\n                    <React.Fragment key={index}>\r\n                      <div className=\"content-messenger-my-chat\">\r\n                        <div className=\"content-messenger-my-chat-content\">\r\n                          <p>{msg.message}</p>\r\n                          <div className=\"content-messenger-my-chat-content-status\">\r\n                          <MdRadioButtonUnchecked />\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"clear\"></div>\r\n                    </React.Fragment>\r\n                  )\r\n                })}\r\n                {typing && <div>{infoUser.user_first_name + ' ' + infoUser.user_last_name} đang nhập tin nhắn...</div>}\r\n              </div>\r\n              <div className=\"content-messenger-input\">\r\n                  <div className=\"preview-image-send\" style={newImageMess || newVideoMess ? {opacity: 1} : null}>\r\n                    <div className=\"preview-image-send-img\">\r\n                      <AiFillCloseCircle onClick={deleteImageMess}/>\r\n                      {newImageMess &&\r\n                        <img src={newImageMess} alt=\"Tin nhắn hình ảnh\" />\r\n                      }\r\n                      {newVideoMess &&\r\n                        <video>\r\n                          <source src={newVideoMess} />\r\n                          Your browser does not support HTML5 video.\r\n                        </video>\r\n                      }\r\n                    </div>\r\n                  </div>\r\n                <div className=\"content-messenger-input-text\">\r\n                  <EditorEmoji onSubmitMess={onSubmitMess} isTypingMess={isTypingMess} readMess={readMess}/>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"content-messenger-body-right\">\r\n              <div className=\"content-messenger-body-right-title\">\r\n                <div className=\"content-messenger-body-right-head\">\r\n                  <div className=\"content-messenger-body-right-head-avatar\">\r\n                    {infoUser.user_avatar_cropX === null ?\r\n                      <img src={infoUser.user_avatar} alt={infoUser.user_last_name} />\r\n                      :\r\n                      <Image cloudName=\"mohi-vn\" publicId={infoUser.user_avatar+ \".jpg\"} version=\"1607061343\">\r\n                        <Transformation height={infoUser.user_avatar_cropH}  width={infoUser.user_avatar_cropW} x={infoUser.user_avatar_cropX} y={infoUser.user_avatar_cropY} crop=\"crop\" />\r\n                      </Image>\r\n                    }\r\n                  </div>\r\n                </div>\r\n                <div className=\"content-messenger-body-right-head-name\">\r\n                  <Link to={\"profile/\" + infoUser.user_username}>{infoUser.user_first_name + ' ' + infoUser.user_last_name}</Link>\r\n                </div>\r\n              </div>\r\n              <div className=\"content-messenger-body-right-support\">\r\n                <div className=\"content-messenger-body-right-support-item\">\r\n                  <div className=\"content-messenger-body-right-list-iamge-share\">\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )\r\n  }\r\n"]},"metadata":{},"sourceType":"module"}