{"ast":null,"code":"import _regeneratorRuntime from\"D:\\\\Web\\\\mohi\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"D:\\\\Web\\\\mohi\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:\\\\Web\\\\mohi\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useRef,useEffect,useState}from'react';import{useSelector,useDispatch}from'react-redux';import Cropper from'cropperjs';import'cropperjs/dist/cropper.css';import{toggleStatusPresentialModal}from'./../../Actions/index.jsx';import{responseUpdateAvatar}from'./../../Actions/index.jsx';import{requestUpdateAvatar}from'./../../Actions/index.jsx';import axios from'axios';import{WaveLoading}from'react-loadingg';function ModalUpLoadAvatarProfile(_ref){var presentialModal=_ref.presentialModal,profile=_ref.profile;var _useSelector=useSelector(function(state){return state.presentialModal;}),data=_useSelector.data;var _useSelector2=useSelector(function(state){return state.profile;}),loadingUpdateAvatar=_useSelector2.loadingUpdateAvatar;var refCropper=useRef();var dispatch=useDispatch();var _useState=useState(),_useState2=_slicedToArray(_useState,2),imageX=_useState2[0],setImageX=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),imageY=_useState4[0],setImageY=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),imageW=_useState6[0],setImageW=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),imageH=_useState8[0],setImageH=_useState8[1];useEffect(function(){var current=refCropper.current;var cropper=new Cropper(current,{aspectRatio:1,zoomable:false,scalable:false,crop:function crop(event){setImageX(event.detail.x);setImageY(event.detail.y);setImageW(event.detail.width);setImageH(event.detail.height);}});},[]);var saveAvatar=function saveAvatar(){dispatch(requestUpdateAvatar());var formData=new FormData();formData.append('upload_preset','mohi_video');formData.append('file',data);upload(formData);};var upload=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(formData){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.post('/v1_1/mohi-vn/upload',formData).then(function(res){updateDtb(res.data.public_id);});case 2:case\"end\":return _context.stop();}}},_callee);}));return function upload(_x){return _ref2.apply(this,arguments);};}();var updateDtb=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(img){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.post('https://www.api.mohi.vn/api/auth/update-info-profile',{user_avatar:img,user_avatar_cropX:imageX,user_avatar_cropY:imageY,user_avatar_cropW:imageW,user_avatar_cropH:imageH}).then(function(){dispatch(responseUpdateAvatar({user_avatar:img,user_avatar_cropX:Math.round(imageX),user_avatar_cropY:Math.round(imageY),user_avatar_cropW:Math.round(imageW),user_avatar_cropH:Math.round(imageH)}));var ustk=JSON.parse(localStorage.getItem('ustk'));ustk.info.user_avatar=img;ustk.info.user_avatar_cropX=Math.round(imageX);ustk.info.user_avatar_cropY=Math.round(imageY);ustk.info.user_avatar_cropW=Math.round(imageW);ustk.info.user_avatar_cropH=Math.round(imageH);localStorage.setItem('ustk',JSON.stringify(ustk));dispatch(toggleStatusPresentialModal());});case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function updateDtb(_x2){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"modal-custom\"},/*#__PURE__*/React.createElement(\"div\",{className:\"image-cropper\"},/*#__PURE__*/React.createElement(\"img\",{src:URL.createObjectURL(data),ref:refCropper,alt:\"\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"action-cropper\"},/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return saveAvatar();}},\"L\\u01B0u\"),/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return dispatch(toggleStatusPresentialModal());}},\"H\\u1EE7y\")),loadingUpdateAvatar&&/*#__PURE__*/React.createElement(\"div\",{style:{background:'rgba(255,255,255,0.7)',position:'absolute',width:'100%',height:'100%',top:0,left:0}},/*#__PURE__*/React.createElement(WaveLoading,null))));}export default ModalUpLoadAvatarProfile;","map":{"version":3,"sources":["D:/Web/mohi/client/src/Components/PresentialModal/ModalUpLoadAvatarProfile.jsx"],"names":["React","useRef","useEffect","useState","useSelector","useDispatch","Cropper","toggleStatusPresentialModal","responseUpdateAvatar","requestUpdateAvatar","axios","WaveLoading","ModalUpLoadAvatarProfile","presentialModal","profile","state","data","loadingUpdateAvatar","refCropper","dispatch","imageX","setImageX","imageY","setImageY","imageW","setImageW","imageH","setImageH","current","cropper","aspectRatio","zoomable","scalable","crop","event","detail","x","y","width","height","saveAvatar","formData","FormData","append","upload","post","then","res","updateDtb","public_id","img","user_avatar","user_avatar_cropX","user_avatar_cropY","user_avatar_cropW","user_avatar_cropH","Math","round","ustk","JSON","parse","localStorage","getItem","info","setItem","stringify","URL","createObjectURL","background","position","top","left"],"mappings":"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","sourcesContent":["import React, { useRef, useEffect, useState } from 'react';\r\nimport {useSelector, useDispatch} from 'react-redux';\r\nimport Cropper from 'cropperjs';\r\nimport 'cropperjs/dist/cropper.css';\r\nimport {toggleStatusPresentialModal} from './../../Actions/index.jsx';\r\nimport {responseUpdateAvatar} from './../../Actions/index.jsx';\r\nimport {requestUpdateAvatar} from './../../Actions/index.jsx';\r\nimport axios from 'axios';\r\nimport { WaveLoading } from 'react-loadingg';\r\n\r\nfunction ModalUpLoadAvatarProfile({presentialModal, profile}){\r\n  const {data} = useSelector(state => state.presentialModal);\r\n  const {loadingUpdateAvatar} = useSelector(state => state.profile);\r\n  const refCropper = useRef();\r\n  const dispatch = useDispatch();\r\n  const [imageX, setImageX] = useState();\r\n  const [imageY, setImageY] = useState();\r\n  const [imageW, setImageW] = useState();\r\n  const [imageH, setImageH] = useState();\r\n\r\n  useEffect(() => {\r\n    const current = refCropper.current;\r\n    const cropper = new Cropper(current, {\r\n      aspectRatio: 1,\r\n      zoomable: false,\r\n      scalable: false,\r\n      crop(event) {\r\n        setImageX(event.detail.x)\r\n        setImageY(event.detail.y)\r\n        setImageW(event.detail.width)\r\n        setImageH(event.detail.height)\r\n      },\r\n    });\r\n  }, [])\r\n\r\n  const saveAvatar = () => {\r\n    dispatch(requestUpdateAvatar())\r\n\r\n    const formData = new FormData();\r\n    formData.append('upload_preset', 'mohi_video');\r\n    formData.append('file', data);\r\n    upload(formData)\r\n  }\r\n\r\n  const upload = async (formData) => {\r\n    await axios.post('/v1_1/mohi-vn/upload', formData)\r\n    .then((res) => {\r\n      updateDtb(res.data.public_id)\r\n    })\r\n  }\r\n\r\n  const updateDtb = async (img) => {\r\n    await axios.post('https://www.api.mohi.vn/api/auth/update-info-profile', {\r\n      user_avatar: img,\r\n      user_avatar_cropX: imageX,\r\n      user_avatar_cropY: imageY,\r\n      user_avatar_cropW: imageW,\r\n      user_avatar_cropH: imageH,\r\n    }).then(() => {\r\n      dispatch(responseUpdateAvatar({\r\n        user_avatar: img,\r\n        user_avatar_cropX: Math.round(imageX),\r\n        user_avatar_cropY: Math.round(imageY),\r\n        user_avatar_cropW: Math.round(imageW),\r\n        user_avatar_cropH: Math.round(imageH),\r\n      }))\r\n      let ustk = JSON.parse(localStorage.getItem('ustk'));\r\n      ustk.info.user_avatar = img;\r\n      ustk.info.user_avatar_cropX = Math.round(imageX);\r\n      ustk.info.user_avatar_cropY = Math.round(imageY);\r\n      ustk.info.user_avatar_cropW = Math.round(imageW);\r\n      ustk.info.user_avatar_cropH = Math.round(imageH);\r\n      localStorage.setItem('ustk', JSON.stringify(ustk))\r\n      dispatch(toggleStatusPresentialModal())\r\n    })\r\n  }\r\n\r\n  return(\r\n    <React.Fragment>\r\n      <div className=\"modal-custom\">\r\n        <div className=\"image-cropper\">\r\n          <img src={URL.createObjectURL(data)} ref={refCropper} alt=\"\" />\r\n        </div>\r\n        <div className=\"action-cropper\">\r\n          <button onClick={() => saveAvatar()}>Lưu</button>\r\n          <button onClick={() => dispatch(toggleStatusPresentialModal())}>Hủy</button>\r\n        </div>\r\n        { loadingUpdateAvatar && <div style={{background: 'rgba(255,255,255,0.7)', position: 'absolute', width: '100%', height: '100%', top: 0, left: 0}}><WaveLoading /></div>}\r\n      </div>\r\n    </React.Fragment>\r\n  )\r\n}\r\n\r\nexport default ModalUpLoadAvatarProfile;\r\n"]},"metadata":{},"sourceType":"module"}