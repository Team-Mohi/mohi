{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _draftJs = require('draft-js');\n\nvar _Entry = require('./Entry');\n\nvar _Entry2 = _interopRequireDefault(_Entry);\n\nvar _addEmoji = require('../../modifiers/addEmoji');\n\nvar _addEmoji2 = _interopRequireDefault(_addEmoji);\n\nvar _getSearchText3 = require('../../utils/getSearchText');\n\nvar _getSearchText4 = _interopRequireDefault(_getSearchText3);\n\nvar _decodeOffsetKey = require('../../utils/decodeOffsetKey');\n\nvar _decodeOffsetKey2 = _interopRequireDefault(_decodeOffsetKey);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _objectWithoutProperties(obj, keys) {\n  var target = {};\n\n  for (var i in obj) {\n    if (keys.indexOf(i) >= 0) continue;\n    if (!Object.prototype.hasOwnProperty.call(obj, i)) continue;\n    target[i] = obj[i];\n  }\n\n  return target;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nvar EmojiSuggestions = function (_Component) {\n  _inherits(EmojiSuggestions, _Component);\n\n  function EmojiSuggestions() {\n    var _ref;\n\n    var _temp, _this, _ret;\n\n    _classCallCheck(this, EmojiSuggestions);\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _ret = (_temp = (_this = _possibleConstructorReturn(this, (_ref = EmojiSuggestions.__proto__ || Object.getPrototypeOf(EmojiSuggestions)).call.apply(_ref, [this].concat(args))), _this), _this.state = {\n      isActive: false,\n      focusedOptionIndex: 0\n    }, _this.componentDidUpdate = function (prevProps, prevState) {\n      if (_this.popover) {\n        // In case the list shrinks there should be still an option focused.\n        // Note: this might run multiple times and deduct 1 until the condition is\n        // not fullfilled anymore.\n        var size = _this.filteredEmojis.size;\n\n        if (size > 0 && _this.state.focusedOptionIndex >= size) {\n          _this.setState({\n            focusedOptionIndex: size - 1\n          });\n        }\n\n        if (size <= 0) {\n          _this.closeDropdown();\n        }\n\n        var decoratorRect = _this.props.store.getPortalClientRect(_this.activeOffsetKey);\n\n        var newStyles = _this.props.positionSuggestions({\n          decoratorRect: decoratorRect,\n          prevProps: prevProps,\n          prevState: prevState,\n          props: _this.props,\n          state: _this.state,\n          filteredEmojis: _this.filteredEmojis,\n          popover: _this.popover\n        });\n\n        Object.keys(newStyles).forEach(function (key) {\n          _this.popover.style[key] = newStyles[key];\n        });\n      }\n    }, _this.componentWillUnmount = function () {\n      _this.props.callbacks.onChange = undefined;\n    }, _this.onEditorStateChange = function (editorState) {\n      var searches = _this.props.store.getAllSearches(); // if no search portal is active there is no need to show the popover\n\n\n      if (searches.size === 0) {\n        return editorState;\n      }\n\n      var removeList = function removeList() {\n        _this.props.store.resetEscapedSearch();\n\n        _this.closeDropdown();\n\n        return editorState;\n      }; // get the current selection\n\n\n      var selection = editorState.getSelection();\n      var anchorKey = selection.getAnchorKey();\n      var anchorOffset = selection.getAnchorOffset(); // the list should not be visible if a range is selected or the editor has no focus\n\n      if (!selection.isCollapsed() || !selection.getHasFocus()) return removeList(); // identify the start & end positon of each search-text\n\n      var offsetDetails = searches.map(function (offsetKey) {\n        return (0, _decodeOffsetKey2.default)(offsetKey);\n      }); // a leave can be empty when it is removed due e.g. using backspace\n\n      var leaves = offsetDetails.filter(function (_ref2) {\n        var blockKey = _ref2.blockKey;\n        return blockKey === anchorKey;\n      }).map(function (_ref3) {\n        var blockKey = _ref3.blockKey,\n            decoratorKey = _ref3.decoratorKey,\n            leafKey = _ref3.leafKey;\n        return editorState.getBlockTree(blockKey).getIn([decoratorKey, 'leaves', leafKey]);\n      }); // if all leaves are undefined the popover should be removed\n\n      if (leaves.every(function (leave) {\n        return leave === undefined;\n      })) {\n        return removeList();\n      } // Checks that the cursor is after the @ character but still somewhere in\n      // the word (search term). Setting it to allow the cursor to be left of\n      // the @ causes troubles due selection confusion.\n\n\n      var plainText = editorState.getCurrentContent().getPlainText();\n      var selectionIsInsideWord = leaves.filter(function (leave) {\n        return leave !== undefined;\n      }).map(function (_ref4) {\n        var start = _ref4.start,\n            end = _ref4.end;\n        return start === 0 && anchorOffset === 1 && plainText.charAt(anchorOffset) !== ':' && /(\\s|^):[\\w]*/.test(plainText) && anchorOffset <= end || // : is the first character\n        anchorOffset > start + 1 && anchorOffset <= end\n        /*: is in the text or at the end*/\n        ;\n      });\n      if (selectionIsInsideWord.every(function (isInside) {\n        return isInside === false;\n      })) return removeList();\n      _this.activeOffsetKey = selectionIsInsideWord.filter(function (value) {\n        return value === true;\n      }).keySeq().first();\n\n      _this.onSearchChange(editorState, selection); // make sure the escaped search is reseted in the cursor since the user\n      // already switched to another emoji search\n\n\n      if (!_this.props.store.isEscaped(_this.activeOffsetKey)) {\n        _this.props.store.resetEscapedSearch();\n      } // If none of the above triggered to close the window, it's safe to assume\n      // the dropdown should be open. This is useful when a user focuses on another\n      // input field and then comes back: the dropdown will again.\n\n\n      if (!_this.state.isActive && !_this.props.store.isEscaped(_this.activeOffsetKey)) {\n        _this.openDropdown();\n      } // makes sure the focused index is reseted every time a new selection opens\n      // or the selection was moved to another emoji search\n\n\n      if (_this.lastSelectionIsInsideWord === undefined || !selectionIsInsideWord.equals(_this.lastSelectionIsInsideWord)) {\n        _this.setState({\n          focusedOptionIndex: 0\n        });\n      }\n\n      _this.lastSelectionIsInsideWord = selectionIsInsideWord;\n      return editorState;\n    }, _this.onSearchChange = function (editorState, selection) {\n      var _getSearchText = (0, _getSearchText4.default)(editorState, selection),\n          word = _getSearchText.word;\n\n      var searchValue = word.substring(1, word.length);\n\n      if (_this.lastSearchValue !== searchValue && typeof _this.props.onSearchChange === 'function') {\n        _this.lastSearchValue = searchValue;\n\n        _this.props.onSearchChange({\n          value: searchValue\n        });\n      }\n    }, _this.onDownArrow = function (keyboardEvent) {\n      keyboardEvent.preventDefault();\n      var newIndex = _this.state.focusedOptionIndex + 1;\n\n      _this.onEmojiFocus(newIndex >= _this.filteredEmojis.size ? 0 : newIndex);\n    }, _this.onTab = function (keyboardEvent) {\n      keyboardEvent.preventDefault();\n\n      _this.commitSelection();\n    }, _this.onUpArrow = function (keyboardEvent) {\n      keyboardEvent.preventDefault();\n\n      if (_this.filteredEmojis.size > 0) {\n        var newIndex = _this.state.focusedOptionIndex - 1;\n\n        _this.onEmojiFocus(Math.max(newIndex, 0));\n      }\n    }, _this.onEscape = function (keyboardEvent) {\n      keyboardEvent.preventDefault();\n\n      var activeOffsetKey = _this.lastSelectionIsInsideWord.filter(function (value) {\n        return value === true;\n      }).keySeq().first();\n\n      _this.props.store.escapeSearch(activeOffsetKey);\n\n      _this.closeDropdown(); // to force a re-render of the outer component to change the aria props\n\n\n      _this.props.store.setEditorState(_this.props.store.getEditorState());\n    }, _this.onEmojiSelect = function (emoji) {\n      _this.closeDropdown();\n\n      var newEditorState = (0, _addEmoji2.default)(_this.props.store.getEditorState(), emoji, _addEmoji.Mode.REPLACE);\n\n      _this.props.store.setEditorState(newEditorState);\n    }, _this.onEmojiFocus = function (index) {\n      var descendant = 'emoji-option-' + _this.key + '-' + index;\n      _this.props.ariaProps.ariaActiveDescendantID = descendant;\n\n      _this.setState({\n        focusedOptionIndex: index\n      }); // to force a re-render of the outer component to change the aria props\n\n\n      _this.props.store.setEditorState(_this.props.store.getEditorState());\n    }, _this.getEmojisForFilter = function () {\n      var selection = _this.props.store.getEditorState().getSelection();\n\n      var _getSearchText2 = (0, _getSearchText4.default)(_this.props.store.getEditorState(), selection),\n          word = _getSearchText2.word;\n\n      var emojiValue = word.substring(1, word.length).toLowerCase();\n\n      var filteredValues = _this.props.shortNames.filter(function (emojiShortName) {\n        return !emojiValue || emojiShortName.indexOf(emojiValue) > -1;\n      });\n\n      var size = filteredValues.size < 9 ? filteredValues.size : 9;\n      return filteredValues.setSize(size);\n    }, _this.commitSelection = function () {\n      _this.onEmojiSelect(_this.filteredEmojis.get(_this.state.focusedOptionIndex));\n\n      return 'handled';\n    }, _this.openDropdown = function () {\n      // This is a really nasty way of attaching & releasing the key related functions.\n      // It assumes that the keyFunctions object will not loose its reference and\n      // by this we can replace inner parameters spread over different modules.\n      // This better be some registering & unregistering logic. PRs are welcome :)\n      _this.props.callbacks.handleReturn = _this.commitSelection;\n\n      _this.props.callbacks.keyBindingFn = function (keyboardEvent) {\n        // arrow down\n        if (keyboardEvent.keyCode === 40) {\n          _this.onDownArrow(keyboardEvent);\n        } // arrow up\n\n\n        if (keyboardEvent.keyCode === 38) {\n          _this.onUpArrow(keyboardEvent);\n        } // escape\n\n\n        if (keyboardEvent.keyCode === 27) {\n          _this.onEscape(keyboardEvent);\n        } // tab\n\n\n        if (keyboardEvent.keyCode === 9) {\n          _this.onTab(keyboardEvent);\n        }\n      };\n\n      var descendant = 'emoji-option-' + _this.key + '-' + _this.state.focusedOptionIndex;\n      _this.props.ariaProps.ariaActiveDescendantID = descendant;\n      _this.props.ariaProps.ariaOwneeID = 'emojis-list-' + _this.key;\n      _this.props.ariaProps.ariaHasPopup = 'true';\n      _this.props.ariaProps.ariaExpanded = true;\n\n      _this.setState({\n        isActive: true\n      });\n\n      if (_this.props.onOpen) {\n        _this.props.onOpen();\n      }\n    }, _this.closeDropdown = function () {\n      // make sure none of these callbacks are triggered\n      _this.props.callbacks.keyBindingFn = undefined;\n      _this.props.callbacks.handleReturn = undefined;\n      _this.props.ariaProps.ariaHasPopup = 'false';\n      _this.props.ariaProps.ariaExpanded = false;\n      _this.props.ariaProps.ariaActiveDescendantID = undefined;\n      _this.props.ariaProps.ariaOwneeID = undefined;\n\n      _this.setState({\n        isActive: false\n      });\n\n      if (_this.props.onClose) {\n        _this.props.onClose();\n      }\n    }, _temp), _possibleConstructorReturn(_this, _ret);\n  }\n\n  _createClass(EmojiSuggestions, [{\n    key: 'componentWillMount',\n    value: function componentWillMount() {\n      this.key = (0, _draftJs.genKey)();\n      this.props.callbacks.onChange = this.onEditorStateChange;\n    } // Get the first 6 emojis that match\n\n  }, {\n    key: 'render',\n    value: function render() {\n      var _this2 = this;\n\n      if (!this.state.isActive) {\n        return null;\n      }\n\n      this.filteredEmojis = this.getEmojisForFilter();\n\n      var _props = this.props,\n          _props$theme = _props.theme,\n          theme = _props$theme === undefined ? {} : _props$theme,\n          cacheBustParam = _props.cacheBustParam,\n          imagePath = _props.imagePath,\n          imageType = _props.imageType,\n          ariaProps = _props.ariaProps,\n          callbacks = _props.callbacks,\n          onClose = _props.onClose,\n          onOpen = _props.onOpen,\n          onSearchChange = _props.onSearchChange,\n          positionSuggestions = _props.positionSuggestions,\n          shortNames = _props.shortNames,\n          store = _props.store,\n          useNativeArt = _props.useNativeArt,\n          restProps = _objectWithoutProperties(_props, ['theme', 'cacheBustParam', 'imagePath', 'imageType', 'ariaProps', 'callbacks', 'onClose', 'onOpen', 'onSearchChange', 'positionSuggestions', 'shortNames', 'store', 'useNativeArt']);\n\n      return _react2.default.createElement('div', _extends({}, restProps, {\n        className: theme.emojiSuggestions,\n        role: 'listbox',\n        id: 'emojis-list-' + this.key,\n        ref: function ref(element) {\n          _this2.popover = element;\n        }\n      }), this.filteredEmojis.map(function (emoji, index) {\n        return _react2.default.createElement(_Entry2.default, {\n          key: emoji,\n          onEmojiSelect: _this2.onEmojiSelect,\n          onEmojiFocus: _this2.onEmojiFocus,\n          isFocused: _this2.state.focusedOptionIndex === index,\n          emoji: emoji,\n          index: index,\n          id: 'emoji-option-' + _this2.key + '-' + index,\n          theme: theme,\n          imagePath: imagePath,\n          imageType: imageType,\n          cacheBustParam: cacheBustParam,\n          useNativeArt: useNativeArt\n        });\n      }).toJS());\n    }\n  }]);\n\n  return EmojiSuggestions;\n}(_react.Component);\n\nexports.default = EmojiSuggestions;","map":{"version":3,"sources":["D:/mohi/mohi/client/node_modules/draft-js-emoji-plugin/lib/components/EmojiSuggestions/index.js"],"names":["Object","defineProperty","exports","value","_extends","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","_createClass","defineProperties","props","descriptor","enumerable","configurable","writable","Constructor","protoProps","staticProps","_react","require","_react2","_interopRequireDefault","_draftJs","_Entry","_Entry2","_addEmoji","_addEmoji2","_getSearchText3","_getSearchText4","_decodeOffsetKey","_decodeOffsetKey2","obj","__esModule","default","_objectWithoutProperties","keys","indexOf","_classCallCheck","instance","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","create","constructor","setPrototypeOf","__proto__","EmojiSuggestions","_Component","_ref","_temp","_this","_ret","_len","args","Array","_key","getPrototypeOf","apply","concat","state","isActive","focusedOptionIndex","componentDidUpdate","prevProps","prevState","popover","size","filteredEmojis","setState","closeDropdown","decoratorRect","store","getPortalClientRect","activeOffsetKey","newStyles","positionSuggestions","forEach","style","componentWillUnmount","callbacks","onChange","undefined","onEditorStateChange","editorState","searches","getAllSearches","removeList","resetEscapedSearch","selection","getSelection","anchorKey","getAnchorKey","anchorOffset","getAnchorOffset","isCollapsed","getHasFocus","offsetDetails","map","offsetKey","leaves","filter","_ref2","blockKey","_ref3","decoratorKey","leafKey","getBlockTree","getIn","every","leave","plainText","getCurrentContent","getPlainText","selectionIsInsideWord","_ref4","start","end","charAt","test","isInside","keySeq","first","onSearchChange","isEscaped","openDropdown","lastSelectionIsInsideWord","equals","_getSearchText","word","searchValue","substring","lastSearchValue","onDownArrow","keyboardEvent","preventDefault","newIndex","onEmojiFocus","onTab","commitSelection","onUpArrow","Math","max","onEscape","escapeSearch","setEditorState","getEditorState","onEmojiSelect","emoji","newEditorState","Mode","REPLACE","index","descendant","ariaProps","ariaActiveDescendantID","getEmojisForFilter","_getSearchText2","emojiValue","toLowerCase","filteredValues","shortNames","emojiShortName","setSize","get","handleReturn","keyBindingFn","keyCode","ariaOwneeID","ariaHasPopup","ariaExpanded","onOpen","onClose","componentWillMount","genKey","render","_this2","_props","_props$theme","theme","cacheBustParam","imagePath","imageType","useNativeArt","restProps","createElement","className","emojiSuggestions","role","id","ref","element","isFocused","toJS","Component"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\nObject.defineProperty(exports, \"__esModule\", {\r\n  value: true\r\n});\r\n\r\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\r\n\r\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\r\n\r\nvar _react = require('react');\r\n\r\nvar _react2 = _interopRequireDefault(_react);\r\n\r\nvar _draftJs = require('draft-js');\r\n\r\nvar _Entry = require('./Entry');\r\n\r\nvar _Entry2 = _interopRequireDefault(_Entry);\r\n\r\nvar _addEmoji = require('../../modifiers/addEmoji');\r\n\r\nvar _addEmoji2 = _interopRequireDefault(_addEmoji);\r\n\r\nvar _getSearchText3 = require('../../utils/getSearchText');\r\n\r\nvar _getSearchText4 = _interopRequireDefault(_getSearchText3);\r\n\r\nvar _decodeOffsetKey = require('../../utils/decodeOffsetKey');\r\n\r\nvar _decodeOffsetKey2 = _interopRequireDefault(_decodeOffsetKey);\r\n\r\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\r\n\r\nfunction _objectWithoutProperties(obj, keys) { var target = {}; for (var i in obj) { if (keys.indexOf(i) >= 0) continue; if (!Object.prototype.hasOwnProperty.call(obj, i)) continue; target[i] = obj[i]; } return target; }\r\n\r\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\r\n\r\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\r\n\r\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\r\n\r\nvar EmojiSuggestions = function (_Component) {\r\n  _inherits(EmojiSuggestions, _Component);\r\n\r\n  function EmojiSuggestions() {\r\n    var _ref;\r\n\r\n    var _temp, _this, _ret;\r\n\r\n    _classCallCheck(this, EmojiSuggestions);\r\n\r\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\r\n      args[_key] = arguments[_key];\r\n    }\r\n\r\n    return _ret = (_temp = (_this = _possibleConstructorReturn(this, (_ref = EmojiSuggestions.__proto__ || Object.getPrototypeOf(EmojiSuggestions)).call.apply(_ref, [this].concat(args))), _this), _this.state = {\r\n      isActive: false,\r\n      focusedOptionIndex: 0\r\n    }, _this.componentDidUpdate = function (prevProps, prevState) {\r\n      if (_this.popover) {\r\n        // In case the list shrinks there should be still an option focused.\r\n        // Note: this might run multiple times and deduct 1 until the condition is\r\n        // not fullfilled anymore.\r\n        var size = _this.filteredEmojis.size;\r\n        if (size > 0 && _this.state.focusedOptionIndex >= size) {\r\n          _this.setState({\r\n            focusedOptionIndex: size - 1\r\n          });\r\n        }\r\n\r\n        if (size <= 0) {\r\n          _this.closeDropdown();\r\n        }\r\n\r\n        var decoratorRect = _this.props.store.getPortalClientRect(_this.activeOffsetKey);\r\n        var newStyles = _this.props.positionSuggestions({\r\n          decoratorRect: decoratorRect,\r\n          prevProps: prevProps,\r\n          prevState: prevState,\r\n          props: _this.props,\r\n          state: _this.state,\r\n          filteredEmojis: _this.filteredEmojis,\r\n          popover: _this.popover\r\n        });\r\n        Object.keys(newStyles).forEach(function (key) {\r\n          _this.popover.style[key] = newStyles[key];\r\n        });\r\n      }\r\n    }, _this.componentWillUnmount = function () {\r\n      _this.props.callbacks.onChange = undefined;\r\n    }, _this.onEditorStateChange = function (editorState) {\r\n      var searches = _this.props.store.getAllSearches();\r\n\r\n      // if no search portal is active there is no need to show the popover\r\n      if (searches.size === 0) {\r\n        return editorState;\r\n      }\r\n\r\n      var removeList = function removeList() {\r\n        _this.props.store.resetEscapedSearch();\r\n        _this.closeDropdown();\r\n        return editorState;\r\n      };\r\n\r\n      // get the current selection\r\n      var selection = editorState.getSelection();\r\n      var anchorKey = selection.getAnchorKey();\r\n      var anchorOffset = selection.getAnchorOffset();\r\n\r\n      // the list should not be visible if a range is selected or the editor has no focus\r\n      if (!selection.isCollapsed() || !selection.getHasFocus()) return removeList();\r\n\r\n      // identify the start & end positon of each search-text\r\n      var offsetDetails = searches.map(function (offsetKey) {\r\n        return (0, _decodeOffsetKey2.default)(offsetKey);\r\n      });\r\n\r\n      // a leave can be empty when it is removed due e.g. using backspace\r\n      var leaves = offsetDetails.filter(function (_ref2) {\r\n        var blockKey = _ref2.blockKey;\r\n        return blockKey === anchorKey;\r\n      }).map(function (_ref3) {\r\n        var blockKey = _ref3.blockKey,\r\n            decoratorKey = _ref3.decoratorKey,\r\n            leafKey = _ref3.leafKey;\r\n        return editorState.getBlockTree(blockKey).getIn([decoratorKey, 'leaves', leafKey]);\r\n      });\r\n\r\n      // if all leaves are undefined the popover should be removed\r\n      if (leaves.every(function (leave) {\r\n        return leave === undefined;\r\n      })) {\r\n        return removeList();\r\n      }\r\n\r\n      // Checks that the cursor is after the @ character but still somewhere in\r\n      // the word (search term). Setting it to allow the cursor to be left of\r\n      // the @ causes troubles due selection confusion.\r\n      var plainText = editorState.getCurrentContent().getPlainText();\r\n      var selectionIsInsideWord = leaves.filter(function (leave) {\r\n        return leave !== undefined;\r\n      }).map(function (_ref4) {\r\n        var start = _ref4.start,\r\n            end = _ref4.end;\r\n        return start === 0 && anchorOffset === 1 && plainText.charAt(anchorOffset) !== ':' && /(\\s|^):[\\w]*/.test(plainText) && anchorOffset <= end || // : is the first character\r\n        anchorOffset > start + 1 && anchorOffset <= end /*: is in the text or at the end*/;\r\n      });\r\n      if (selectionIsInsideWord.every(function (isInside) {\r\n        return isInside === false;\r\n      })) return removeList();\r\n\r\n      _this.activeOffsetKey = selectionIsInsideWord.filter(function (value) {\r\n        return value === true;\r\n      }).keySeq().first();\r\n\r\n      _this.onSearchChange(editorState, selection);\r\n\r\n      // make sure the escaped search is reseted in the cursor since the user\r\n      // already switched to another emoji search\r\n      if (!_this.props.store.isEscaped(_this.activeOffsetKey)) {\r\n        _this.props.store.resetEscapedSearch();\r\n      }\r\n\r\n      // If none of the above triggered to close the window, it's safe to assume\r\n      // the dropdown should be open. This is useful when a user focuses on another\r\n      // input field and then comes back: the dropdown will again.\r\n      if (!_this.state.isActive && !_this.props.store.isEscaped(_this.activeOffsetKey)) {\r\n        _this.openDropdown();\r\n      }\r\n\r\n      // makes sure the focused index is reseted every time a new selection opens\r\n      // or the selection was moved to another emoji search\r\n      if (_this.lastSelectionIsInsideWord === undefined || !selectionIsInsideWord.equals(_this.lastSelectionIsInsideWord)) {\r\n        _this.setState({\r\n          focusedOptionIndex: 0\r\n        });\r\n      }\r\n\r\n      _this.lastSelectionIsInsideWord = selectionIsInsideWord;\r\n\r\n      return editorState;\r\n    }, _this.onSearchChange = function (editorState, selection) {\r\n      var _getSearchText = (0, _getSearchText4.default)(editorState, selection),\r\n          word = _getSearchText.word;\r\n\r\n      var searchValue = word.substring(1, word.length);\r\n      if (_this.lastSearchValue !== searchValue && typeof _this.props.onSearchChange === 'function') {\r\n        _this.lastSearchValue = searchValue;\r\n        _this.props.onSearchChange({ value: searchValue });\r\n      }\r\n    }, _this.onDownArrow = function (keyboardEvent) {\r\n      keyboardEvent.preventDefault();\r\n      var newIndex = _this.state.focusedOptionIndex + 1;\r\n      _this.onEmojiFocus(newIndex >= _this.filteredEmojis.size ? 0 : newIndex);\r\n    }, _this.onTab = function (keyboardEvent) {\r\n      keyboardEvent.preventDefault();\r\n      _this.commitSelection();\r\n    }, _this.onUpArrow = function (keyboardEvent) {\r\n      keyboardEvent.preventDefault();\r\n      if (_this.filteredEmojis.size > 0) {\r\n        var newIndex = _this.state.focusedOptionIndex - 1;\r\n        _this.onEmojiFocus(Math.max(newIndex, 0));\r\n      }\r\n    }, _this.onEscape = function (keyboardEvent) {\r\n      keyboardEvent.preventDefault();\r\n\r\n      var activeOffsetKey = _this.lastSelectionIsInsideWord.filter(function (value) {\r\n        return value === true;\r\n      }).keySeq().first();\r\n      _this.props.store.escapeSearch(activeOffsetKey);\r\n      _this.closeDropdown();\r\n\r\n      // to force a re-render of the outer component to change the aria props\r\n      _this.props.store.setEditorState(_this.props.store.getEditorState());\r\n    }, _this.onEmojiSelect = function (emoji) {\r\n      _this.closeDropdown();\r\n      var newEditorState = (0, _addEmoji2.default)(_this.props.store.getEditorState(), emoji, _addEmoji.Mode.REPLACE);\r\n      _this.props.store.setEditorState(newEditorState);\r\n    }, _this.onEmojiFocus = function (index) {\r\n      var descendant = 'emoji-option-' + _this.key + '-' + index;\r\n      _this.props.ariaProps.ariaActiveDescendantID = descendant;\r\n      _this.setState({ focusedOptionIndex: index });\r\n\r\n      // to force a re-render of the outer component to change the aria props\r\n      _this.props.store.setEditorState(_this.props.store.getEditorState());\r\n    }, _this.getEmojisForFilter = function () {\r\n      var selection = _this.props.store.getEditorState().getSelection();\r\n\r\n      var _getSearchText2 = (0, _getSearchText4.default)(_this.props.store.getEditorState(), selection),\r\n          word = _getSearchText2.word;\r\n\r\n      var emojiValue = word.substring(1, word.length).toLowerCase();\r\n      var filteredValues = _this.props.shortNames.filter(function (emojiShortName) {\r\n        return !emojiValue || emojiShortName.indexOf(emojiValue) > -1;\r\n      });\r\n      var size = filteredValues.size < 9 ? filteredValues.size : 9;\r\n      return filteredValues.setSize(size);\r\n    }, _this.commitSelection = function () {\r\n      _this.onEmojiSelect(_this.filteredEmojis.get(_this.state.focusedOptionIndex));\r\n      return 'handled';\r\n    }, _this.openDropdown = function () {\r\n      // This is a really nasty way of attaching & releasing the key related functions.\r\n      // It assumes that the keyFunctions object will not loose its reference and\r\n      // by this we can replace inner parameters spread over different modules.\r\n      // This better be some registering & unregistering logic. PRs are welcome :)\r\n      _this.props.callbacks.handleReturn = _this.commitSelection;\r\n      _this.props.callbacks.keyBindingFn = function (keyboardEvent) {\r\n        // arrow down\r\n        if (keyboardEvent.keyCode === 40) {\r\n          _this.onDownArrow(keyboardEvent);\r\n        }\r\n        // arrow up\r\n        if (keyboardEvent.keyCode === 38) {\r\n          _this.onUpArrow(keyboardEvent);\r\n        }\r\n        // escape\r\n        if (keyboardEvent.keyCode === 27) {\r\n          _this.onEscape(keyboardEvent);\r\n        }\r\n        // tab\r\n        if (keyboardEvent.keyCode === 9) {\r\n          _this.onTab(keyboardEvent);\r\n        }\r\n      };\r\n\r\n      var descendant = 'emoji-option-' + _this.key + '-' + _this.state.focusedOptionIndex;\r\n      _this.props.ariaProps.ariaActiveDescendantID = descendant;\r\n      _this.props.ariaProps.ariaOwneeID = 'emojis-list-' + _this.key;\r\n      _this.props.ariaProps.ariaHasPopup = 'true';\r\n      _this.props.ariaProps.ariaExpanded = true;\r\n      _this.setState({\r\n        isActive: true\r\n      });\r\n\r\n      if (_this.props.onOpen) {\r\n        _this.props.onOpen();\r\n      }\r\n    }, _this.closeDropdown = function () {\r\n      // make sure none of these callbacks are triggered\r\n      _this.props.callbacks.keyBindingFn = undefined;\r\n      _this.props.callbacks.handleReturn = undefined;\r\n      _this.props.ariaProps.ariaHasPopup = 'false';\r\n      _this.props.ariaProps.ariaExpanded = false;\r\n      _this.props.ariaProps.ariaActiveDescendantID = undefined;\r\n      _this.props.ariaProps.ariaOwneeID = undefined;\r\n      _this.setState({\r\n        isActive: false\r\n      });\r\n\r\n      if (_this.props.onClose) {\r\n        _this.props.onClose();\r\n      }\r\n    }, _temp), _possibleConstructorReturn(_this, _ret);\r\n  }\r\n\r\n  _createClass(EmojiSuggestions, [{\r\n    key: 'componentWillMount',\r\n    value: function componentWillMount() {\r\n      this.key = (0, _draftJs.genKey)();\r\n      this.props.callbacks.onChange = this.onEditorStateChange;\r\n    }\r\n\r\n    // Get the first 6 emojis that match\r\n\r\n  }, {\r\n    key: 'render',\r\n    value: function render() {\r\n      var _this2 = this;\r\n\r\n      if (!this.state.isActive) {\r\n        return null;\r\n      }\r\n\r\n      this.filteredEmojis = this.getEmojisForFilter();\r\n\r\n      var _props = this.props,\r\n          _props$theme = _props.theme,\r\n          theme = _props$theme === undefined ? {} : _props$theme,\r\n          cacheBustParam = _props.cacheBustParam,\r\n          imagePath = _props.imagePath,\r\n          imageType = _props.imageType,\r\n          ariaProps = _props.ariaProps,\r\n          callbacks = _props.callbacks,\r\n          onClose = _props.onClose,\r\n          onOpen = _props.onOpen,\r\n          onSearchChange = _props.onSearchChange,\r\n          positionSuggestions = _props.positionSuggestions,\r\n          shortNames = _props.shortNames,\r\n          store = _props.store,\r\n          useNativeArt = _props.useNativeArt,\r\n          restProps = _objectWithoutProperties(_props, ['theme', 'cacheBustParam', 'imagePath', 'imageType', 'ariaProps', 'callbacks', 'onClose', 'onOpen', 'onSearchChange', 'positionSuggestions', 'shortNames', 'store', 'useNativeArt']);\r\n\r\n      return _react2.default.createElement(\r\n        'div',\r\n        _extends({}, restProps, {\r\n          className: theme.emojiSuggestions,\r\n          role: 'listbox',\r\n          id: 'emojis-list-' + this.key,\r\n          ref: function ref(element) {\r\n            _this2.popover = element;\r\n          }\r\n        }),\r\n        this.filteredEmojis.map(function (emoji, index) {\r\n          return _react2.default.createElement(_Entry2.default, {\r\n            key: emoji,\r\n            onEmojiSelect: _this2.onEmojiSelect,\r\n            onEmojiFocus: _this2.onEmojiFocus,\r\n            isFocused: _this2.state.focusedOptionIndex === index,\r\n            emoji: emoji,\r\n            index: index,\r\n            id: 'emoji-option-' + _this2.key + '-' + index,\r\n            theme: theme,\r\n            imagePath: imagePath,\r\n            imageType: imageType,\r\n            cacheBustParam: cacheBustParam,\r\n            useNativeArt: useNativeArt\r\n          });\r\n        }).toJS()\r\n      );\r\n    }\r\n  }]);\r\n\r\n  return EmojiSuggestions;\r\n}(_react.Component);\r\n\r\nexports.default = EmojiSuggestions;"]},"metadata":{},"sourceType":"script"}