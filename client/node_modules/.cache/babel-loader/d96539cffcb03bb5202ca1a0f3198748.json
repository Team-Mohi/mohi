{"ast":null,"code":"import _regeneratorRuntime from\"D:\\\\Web\\\\mohi\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"D:\\\\Web\\\\mohi\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:\\\\Web\\\\mohi\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useRef,Suspense,useContext}from'react';import{useSelector,useDispatch}from'react-redux';import{Image,Transformation}from'cloudinary-react';import useWindowSize from\"./useWindowSize.jsx\";import moment from'moment';import'moment/locale/vi';import axios from'axios';import{BsSearch}from'react-icons/bs';import{useHistory}from'react-router-dom';import{searchFriendProfile}from'./../../Actions/index.jsx';import{readMessageOfList}from'./../../Actions/index.jsx';import{readMessage}from'./../../Actions/index.jsx';import SocketContext from'./../Socket/index.jsx';var SiderMessenger=function SiderMessenger(props,_ref){var message=_ref.message,friends=_ref.friends;var windowSize=useWindowSize();var socket=useContext(SocketContext);var dispatch=useDispatch();var listFriends=useSelector(function(state){return state.friends.list;});var _useSelector=useSelector(function(state){return state.message;}),list=_useSelector.list;var searchKeyWords=useSelector(function(state){return state.friends.searchKeyWords;});var _useState=useState(),_useState2=_slicedToArray(_useState,2),scrollSider=_useState2[0],setScrollSider=_useState2[1];var sider=useRef();var currentUser=JSON.parse(localStorage.getItem('ustk')).info;var heightScrollSider=window.innerHeight-190;var _useState3=useState({height:heightScrollSider}),_useState4=_slicedToArray(_useState3,2),showScroll=_useState4[0],setShowScroll=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),contentChat=_useState6[0],setContentChat=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isSeach=_useState8[0],setIsSeach=_useState8[1];var history=useHistory();useEffect(function(){setShowScroll({height:heightScrollSider});},[windowSize]);function handleSiderScroll(){var scrollTop=sider.current.scrollTop;if(scrollTop>0&&!scrollSider)setScrollSider({boxShadow:'-4px 0.1px 3px rgba(0,0,0,0.2)'});if(scrollTop===0)setScrollSider({});}var onChangeSearchFriend=function onChangeSearchFriend(e){dispatch(searchFriendProfile(e.target.value));if(e.target.value){setIsSeach(true);}else{setIsSeach(false);}};var openContentChat=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(idUser,user_username){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:axios.post(\"https://www.api.mohi.vn/api/auth/read-message\",{id:idUser}).then(function(res){dispatch(readMessageOfList({id:currentUser.id,clientId:idUser}));socket.emit('read-message',{user_username:user_username,idUser:idUser,clientId:currentUser.id});});history.push('/messenger/'+idUser);case 2:case\"end\":return _context.stop();}}},_callee);}));return function openContentChat(_x,_x2){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(\"div\",{className:\"sider-messenger-container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"sider-messenger-head\",style:scrollSider},/*#__PURE__*/React.createElement(\"div\",{className:\"sider-messenger-title\"},/*#__PURE__*/React.createElement(\"div\",{className:\"sider-messenger-title-left\"},/*#__PURE__*/React.createElement(\"div\",{className:\"sider-messenger-avatar\"},currentUser.user_avatar_cropX===null?/*#__PURE__*/React.createElement(\"img\",{src:currentUser.user_avatar,alt:currentUser.user_first_name+' '+currentUser.user_last_name}):/*#__PURE__*/React.createElement(Image,{cloudName:\"mohi-vn\",publicId:currentUser.user_avatar+\".jpg\",version:\"1607061343\"},/*#__PURE__*/React.createElement(Transformation,{height:currentUser.user_avatar_cropH,width:currentUser.user_avatar_cropW,x:currentUser.user_avatar_cropX,y:currentUser.user_avatar_cropY,crop:\"crop\"}))),/*#__PURE__*/React.createElement(\"span\",null,\"Chat\")),/*#__PURE__*/React.createElement(\"div\",{className:\"sider-messenger-title-right\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"sider-messenger-search\"},/*#__PURE__*/React.createElement(BsSearch,null),/*#__PURE__*/React.createElement(\"input\",{type:\"text\",placeholder:\"T\\xECm ki\\u1EBFm tr\\xEAn Messenger\",onChange:onChangeSearchFriend}))),/*#__PURE__*/React.createElement(\"div\",{className:\"sider-messenger-list-user-container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"sider-messenger-list-user\",style:showScroll,onScroll:function onScroll(){return handleSiderScroll();},ref:sider},/*#__PURE__*/React.createElement(\"ul\",null,searchKeyWords&&listFriends.filter(function(fr){var name=fr.user_first_name+' '+fr.user_last_name;return name.toLowerCase().replace(/\\s/g,'').indexOf(searchKeyWords.toLowerCase().replace(/\\s/g,''))!==-1;}).map(function(friends,index){return/*#__PURE__*/React.createElement(\"li\",{key:index,onClick:function onClick(){return openContentChat(friends.id,friends.user_username);}},/*#__PURE__*/React.createElement(\"div\",{className:\"sider-messenger-user-item\"},/*#__PURE__*/React.createElement(\"div\",{className:\"sider-messenger-user-item-avatar\"},friends.user_avatar_cropX===null?/*#__PURE__*/React.createElement(\"img\",{src:friends.user_avatar,alt:friends.user_last_name}):/*#__PURE__*/React.createElement(Image,{cloudName:\"mohi-vn\",publicId:friends.user_avatar+\".jpg\",version:\"1607061343\"},/*#__PURE__*/React.createElement(Transformation,{height:friends.user_avatar_cropH,width:friends.user_avatar_cropW,x:friends.user_avatar_cropX,y:friends.user_avatar_cropY,crop:\"crop\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"sider-messenger-content\"},/*#__PURE__*/React.createElement(\"div\",{className:\"sider-messenger-username\"},friends.user_first_name+' '+friends.user_last_name))));}),!listFriends.filter(function(fr){var name=fr.user_first_name+' '+fr.user_last_name;return name.toLowerCase().replace(/\\s/g,'').indexOf(searchKeyWords.toLowerCase().replace(/\\s/g,''))!==-1;}).length&&isSeach&&/*#__PURE__*/React.createElement(\"div\",{style:{textAlign:'center'}},\"Kh\\xF4ng c\\xF3 k\\u1EBFt qu\\u1EA3 t\\xECm ki\\u1EBFm\"),!list.length&&!isSeach&&/*#__PURE__*/React.createElement(\"div\",{style:{textAlign:'center'}},\"T\\xECm ki\\u1EBFm b\\u1EA1n b\\xE8 \\u0111\\u1EC3 nh\\u1EAFn tin\"),!isSeach&&list.map(function(mess,index){return/*#__PURE__*/React.createElement(\"li\",{key:index,onClick:function onClick(){return openContentChat(mess.id,mess.user_username);}},/*#__PURE__*/React.createElement(\"div\",{className:\"sider-messenger-user-item\"},/*#__PURE__*/React.createElement(\"div\",{className:\"sider-messenger-user-item-avatar\"},mess.user_avatar_cropX===null?/*#__PURE__*/React.createElement(\"img\",{src:mess.user_avatar,alt:mess.user_last_name}):/*#__PURE__*/React.createElement(Image,{cloudName:\"mohi-vn\",publicId:mess.user_avatar+\".jpg\",version:\"1607061343\"},/*#__PURE__*/React.createElement(Transformation,{height:mess.user_avatar_cropH,width:mess.user_avatar_cropW,x:mess.user_avatar_cropX,y:mess.user_avatar_cropY,crop:\"crop\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"sider-messenger-content\"},/*#__PURE__*/React.createElement(\"div\",{className:\"sider-messenger-username\"},mess.user_first_name+' '+mess.user_last_name),/*#__PURE__*/React.createElement(\"div\",{className:\"sider-messenger-content-nearest\"},mess.pivot.messages_Message)),/*#__PURE__*/React.createElement(\"div\",{className:\"sider-messenger-time-send\"},moment(moment.utc(mess.pivot.created_at).toDate()).locale('vi').fromNow())),/*#__PURE__*/React.createElement(\"div\",{className:\"sider-messenger-user-item-status\"}));})))));};export default SiderMessenger;","map":{"version":3,"sources":["D:/Web/mohi/client/src/Components/Messenger/SiderMessenger.jsx"],"names":["React","useEffect","useState","useRef","Suspense","useContext","useSelector","useDispatch","Image","Transformation","useWindowSize","moment","axios","BsSearch","useHistory","searchFriendProfile","readMessageOfList","readMessage","SocketContext","SiderMessenger","props","message","friends","windowSize","socket","dispatch","listFriends","state","list","searchKeyWords","scrollSider","setScrollSider","sider","currentUser","JSON","parse","localStorage","getItem","info","heightScrollSider","window","innerHeight","height","showScroll","setShowScroll","contentChat","setContentChat","isSeach","setIsSeach","history","handleSiderScroll","scrollTop","current","boxShadow","onChangeSearchFriend","e","target","value","openContentChat","idUser","user_username","post","id","then","res","clientId","emit","push","user_avatar_cropX","user_avatar","user_first_name","user_last_name","user_avatar_cropH","user_avatar_cropW","user_avatar_cropY","filter","fr","name","toLowerCase","replace","indexOf","map","index","length","textAlign","mess","pivot","messages_Message","utc","created_at","toDate","locale","fromNow"],"mappings":"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","sourcesContent":["import React, {useEffect, useState, useRef, Suspense, useContext} from 'react';\r\nimport {useSelector, useDispatch} from 'react-redux';\r\nimport {Image,Transformation} from 'cloudinary-react';\r\nimport useWindowSize from \"./useWindowSize.jsx\";\r\nimport moment from 'moment';\r\nimport 'moment/locale/vi';\r\nimport axios from 'axios';\r\nimport {BsSearch} from 'react-icons/bs';\r\nimport {useHistory} from 'react-router-dom';\r\nimport {searchFriendProfile} from './../../Actions/index.jsx';\r\nimport {readMessageOfList} from './../../Actions/index.jsx';\r\nimport {readMessage} from './../../Actions/index.jsx';\r\nimport SocketContext from './../Socket/index.jsx';\r\n\r\n  const SiderMessenger = (props, {message, friends }) => {\r\n    const windowSize = useWindowSize();\r\n    const socket = useContext(SocketContext);\r\n    const dispatch = useDispatch();\r\n    const listFriends = useSelector(state => state.friends.list);\r\n    const {list} = useSelector(state => state.message);\r\n    const searchKeyWords = useSelector(state => state.friends.searchKeyWords);\r\n    const [scrollSider, setScrollSider] = useState();\r\n    const sider = useRef();\r\n    const currentUser = JSON.parse(localStorage.getItem('ustk')).info;\r\n    const heightScrollSider = window.innerHeight - 190;\r\n    const [showScroll, setShowScroll] = useState({height: heightScrollSider})\r\n    const [contentChat, setContentChat] = useState(false)\r\n    const [isSeach, setIsSeach] = useState(false)\r\n    const history = useHistory();\r\n\r\n    useEffect(() => {\r\n      setShowScroll({height: heightScrollSider})\r\n    },[windowSize]);\r\n\r\n    function handleSiderScroll(){\r\n      const {scrollTop} = sider.current;\r\n      if(scrollTop > 0 && !scrollSider) setScrollSider({boxShadow: '-4px 0.1px 3px rgba(0,0,0,0.2)'})\r\n      if(scrollTop === 0) setScrollSider({})\r\n    }\r\n\r\n    const onChangeSearchFriend = (e) => {\r\n      dispatch(searchFriendProfile(e.target.value))\r\n      if(e.target.value){\r\n        setIsSeach(true)\r\n      }else {\r\n        setIsSeach(false)\r\n      }\r\n    }\r\n\r\n\r\n    const openContentChat = async (idUser, user_username) => {\r\n      axios.post(\"https://www.api.mohi.vn/api/auth/read-message\", {id: idUser}).then((res) => {\r\n        dispatch(readMessageOfList({id: currentUser.id, clientId: idUser}))\r\n        socket.emit('read-message', {user_username: user_username, idUser: idUser, clientId: currentUser.id})\r\n      })\r\n      history.push('/messenger/' + idUser)\r\n    }\r\n\r\n      return(\r\n        <div className=\"sider-messenger-container\">\r\n          <div className=\"sider-messenger-head\" style={scrollSider}>\r\n            <div className=\"sider-messenger-title\">\r\n              <div className=\"sider-messenger-title-left\">\r\n                <div className=\"sider-messenger-avatar\">\r\n                  {currentUser.user_avatar_cropX === null ?\r\n                    <img src={currentUser.user_avatar} alt={currentUser.user_first_name + ' ' + currentUser.user_last_name} />\r\n                    :\r\n                    <Image cloudName=\"mohi-vn\" publicId={currentUser.user_avatar+ \".jpg\"} version=\"1607061343\">\r\n                      <Transformation height={currentUser.user_avatar_cropH}  width={currentUser.user_avatar_cropW} x={currentUser.user_avatar_cropX} y={currentUser.user_avatar_cropY} crop=\"crop\" />\r\n                    </Image>\r\n                  }\r\n                </div>\r\n                <span>Chat</span>\r\n              </div>\r\n              <div className=\"sider-messenger-title-right\">\r\n              </div>\r\n            </div>\r\n            <div className=\"sider-messenger-search\">\r\n              <BsSearch />\r\n            <input type=\"text\" placeholder=\"Tìm kiếm trên Messenger\" onChange={onChangeSearchFriend}/>\r\n            </div>\r\n          </div>\r\n          <div className=\"sider-messenger-list-user-container\" >\r\n            <div className=\"sider-messenger-list-user\" style={showScroll} onScroll={() => handleSiderScroll()} ref={sider}>\r\n              <ul>\r\n                {searchKeyWords && listFriends.filter(fr => {\r\n                  const name = fr.user_first_name + ' ' + fr.user_last_name;\r\n\r\n                  return name.toLowerCase().replace(/\\s/g,'').indexOf(searchKeyWords.toLowerCase().replace(/\\s/g,'')) !== -1\r\n                }).map((friends, index) => {\r\n                  return(\r\n                    <li key={index} onClick={() => openContentChat(friends.id, friends.user_username)}>\r\n                      <div className=\"sider-messenger-user-item\">\r\n                        <div className=\"sider-messenger-user-item-avatar\">\r\n                          {friends.user_avatar_cropX === null ?\r\n                            <img src={friends.user_avatar} alt={friends.user_last_name} />\r\n                            :\r\n                            <Image cloudName=\"mohi-vn\" publicId={friends.user_avatar+ \".jpg\"} version=\"1607061343\">\r\n                              <Transformation height={friends.user_avatar_cropH}  width={friends.user_avatar_cropW} x={friends.user_avatar_cropX} y={friends.user_avatar_cropY} crop=\"crop\" />\r\n                            </Image>\r\n                          }\r\n                        </div>\r\n                        <div className=\"sider-messenger-content\">\r\n                          <div className=\"sider-messenger-username\">\r\n                            {friends.user_first_name + ' ' + friends.user_last_name}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </li>\r\n                  )\r\n                })}\r\n                {!listFriends.filter(fr => {\r\n                  const name = fr.user_first_name + ' ' + fr.user_last_name;\r\n\r\n                  return name.toLowerCase().replace(/\\s/g,'').indexOf(searchKeyWords.toLowerCase().replace(/\\s/g,'')) !== -1\r\n                }).length && isSeach &&\r\n                <div style={{textAlign: 'center'}}>Không có kết quả tìm kiếm</div>\r\n                }\r\n                {!list.length && !isSeach &&\r\n                <div style={{textAlign: 'center'}}>Tìm kiếm bạn bè để nhắn tin</div>\r\n                }\r\n                {!isSeach && list.map((mess, index) => {\r\n                  return(\r\n                    <li key={index} onClick={() => openContentChat(mess.id, mess.user_username)}>\r\n                      <div className=\"sider-messenger-user-item\">\r\n                        <div className=\"sider-messenger-user-item-avatar\">\r\n                          {mess.user_avatar_cropX === null ?\r\n                            <img src={mess.user_avatar} alt={mess.user_last_name} />\r\n                            :\r\n                            <Image cloudName=\"mohi-vn\" publicId={mess.user_avatar+ \".jpg\"} version=\"1607061343\">\r\n                              <Transformation height={mess.user_avatar_cropH}  width={mess.user_avatar_cropW} x={mess.user_avatar_cropX} y={mess.user_avatar_cropY} crop=\"crop\" />\r\n                            </Image>\r\n                          }\r\n                        </div>\r\n                        <div className=\"sider-messenger-content\">\r\n                          <div className=\"sider-messenger-username\">\r\n                            {mess.user_first_name + ' ' + mess.user_last_name}\r\n                          </div>\r\n                          <div className=\"sider-messenger-content-nearest\">\r\n                            {mess.pivot.messages_Message}\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"sider-messenger-time-send\">\r\n                          {moment(moment.utc(mess.pivot.created_at).toDate()).locale('vi').fromNow()}\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"sider-messenger-user-item-status\">\r\n                      </div>\r\n                    </li>\r\n                  )\r\n                })}\r\n              </ul>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )\r\n  }\r\n\r\nexport default SiderMessenger;\r\n"]},"metadata":{},"sourceType":"module"}