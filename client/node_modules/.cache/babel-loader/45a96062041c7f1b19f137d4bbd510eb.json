{"ast":null,"code":"import _slicedToArray from\"D:\\\\Web\\\\mohi\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{useForm}from'react-hook-form';import{RiErrorWarningLine}from\"react-icons/ri\";import{Tooltip}from'antd';import{useHistory}from'react-router-dom';import{useDispatch}from'react-redux';import{toggleStatusSpin}from'./../../Actions/index.jsx';import{useCookies}from\"react-cookie\";import{Image,Transformation}from'cloudinary-react';function VeriChangePass(props){var history=useHistory();if(!history.location.state){history.push('/');}var _useCookies=useCookies([\"vrct\"]),_useCookies2=_slicedToArray(_useCookies,3),cookies=_useCookies2[0],setCookie=_useCookies2[1],removeCookie=_useCookies2[2];var dispatch=useDispatch();var avatar=history.location.state?history.location.state.user_avatar:'';var name=history.location.state?history.location.state.user_name:'';var code=history.location.state?history.location.state.code:'';var email=history.location.state?history.location.state.user_email:'';var idUser=history.location.state?history.location.state.id_user:'';var _useForm=useForm(),register=_useForm.register,handleSubmit=_useForm.handleSubmit,errors=_useForm.errors,setError=_useForm.setError;var _useState=useState('Vui lòng nhập mã gồm 6 số'),_useState2=_slicedToArray(_useState,2),errorEmailAndPhone=_useState2[0],setErrorEmailAndPhone=_useState2[1];var now=new Date().getTime();useEffect(function(){if(code){var timeExpiredCode=now+300000;setCookie(\"vrct\",timeExpiredCode,{path:\"/\"});}},[code]);var onSubmit=function onSubmit(data){//load Spin\ndispatch(toggleStatusSpin());if(code===Number(data.code_change_pass)){if(cookies.vrct-new Date().getTime()>0){removeCookie();history.push('/change-password',{idUser:idUser,user_email:email});}else{setError(\"code_change_pass\",{type:\"manual\",message:\"Mã xác nhận đã hết hạn\"});setErrorEmailAndPhone('Mã xác nhận đã hết hạn');}}else{setError(\"code_change_pass\",{type:\"manual\",message:\"Mã xác nhận không khớp với mã chúng tôi đã gửi\"});setErrorEmailAndPhone('Mã xác nhận không khớp với mã chúng tôi đã gửi');}//close Spin\ndispatch(toggleStatusSpin());};var validateInputCode=function validateInputCode(value){if(!value)return false;if(!Number(value))return false;return true;};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"veri-code-container\"},/*#__PURE__*/React.createElement(\"form\",{onSubmit:handleSubmit(onSubmit)},/*#__PURE__*/React.createElement(\"h2\",{style:{marginBottom:'20px'}},\"X\\xE1c nh\\u1EADn \\u0111\\u1ED5i m\\u1EADt kh\\u1EA9u\"),/*#__PURE__*/React.createElement(\"div\",{className:\"preview-info-user\"},/*#__PURE__*/React.createElement(\"div\",{className:\"preview-info-user-avatar\"},avatar.toLowerCase().indexOf('https://')!==-1?/*#__PURE__*/React.createElement(\"img\",{src:avatar,alt:name}):/*#__PURE__*/React.createElement(Image,{cloudName:\"mohi-vn\",publicId:avatar+\".jpg\",version:\"1607061343\"},/*#__PURE__*/React.createElement(Transformation,null))),/*#__PURE__*/React.createElement(\"div\",{className:\"preview-info-user-name\"},name)),/*#__PURE__*/React.createElement(\"div\",{className:\"veri-code-message\"},/*#__PURE__*/React.createElement(\"span\",{style:{color:'black'}},\"Ch\\xFAng t\\xF4i \\u0111\\xE3 g\\u1EEDi m\\xE3 x\\xE1c nh\\u1EADn \\u0111\\u1EBFn \"),email,/*#__PURE__*/React.createElement(\"span\",{style:{color:'black'}},\". M\\xE3 n\\xE0y s\\u1EBD t\\u1ED3n t\\u1EA1i trong v\\xF2ng 5 ph\\xFAt. Vui l\\xF2ng ki\\u1EC3m tra v\\xE0 ho\\xE0n t\\u1EA5t qu\\xE1 tr\\xECnh \\u0111\\u1ED5i m\\u1EADt kh\\u1EA9u.\")),/*#__PURE__*/React.createElement(\"div\",{className:\"submit-error-veri-code\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"form-veri-code-group\"},/*#__PURE__*/React.createElement(\"input\",{type:\"text\",name:\"code_change_pass\",placeholder:\"Nh\\u1EADp m\\xE3 g\\u1ED3m 6 s\\u1ED1\",ref:register({validate:function validate(value){return validateInputCode(value);}}),style:errors.code_change_pass?{border:'1px solid red'}:null}),errors.code_change_pass&&/*#__PURE__*/React.createElement(Tooltip,{placement:\"right\",title:/*#__PURE__*/React.createElement(\"p\",{className:\"error_sex_tooltip\"},errorEmailAndPhone)},/*#__PURE__*/React.createElement(RiErrorWarningLine,{className:\"error_sex error_code\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"form-veri-code-group\"},/*#__PURE__*/React.createElement(\"button\",{type:\"submit\"},\"X\\xE1c nh\\u1EADn\")))));}export default VeriChangePass;","map":{"version":3,"sources":["D:/Web/mohi/client/src/app/Authen/VeriChangePass.jsx"],"names":["React","useState","useEffect","useForm","RiErrorWarningLine","Tooltip","useHistory","useDispatch","toggleStatusSpin","useCookies","Image","Transformation","VeriChangePass","props","history","location","state","push","cookies","setCookie","removeCookie","dispatch","avatar","user_avatar","name","user_name","code","email","user_email","idUser","id_user","register","handleSubmit","errors","setError","errorEmailAndPhone","setErrorEmailAndPhone","now","Date","getTime","timeExpiredCode","path","onSubmit","data","Number","code_change_pass","vrct","type","message","validateInputCode","value","marginBottom","toLowerCase","indexOf","color","validate","border"],"mappings":"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","sourcesContent":["import React, {useState, useEffect} from 'react';\r\nimport {useForm} from 'react-hook-form';\r\nimport {RiErrorWarningLine} from \"react-icons/ri\";\r\nimport {Tooltip} from 'antd';\r\nimport {useHistory} from 'react-router-dom';\r\nimport { useDispatch } from 'react-redux';\r\nimport { toggleStatusSpin } from './../../Actions/index.jsx';\r\nimport { useCookies } from \"react-cookie\";\r\nimport {Image,Transformation} from 'cloudinary-react';\r\n\r\nfunction VeriChangePass(props){\r\n  const history = useHistory();\r\n  if(!history.location.state){\r\n    history.push('/')\r\n  }\r\n  const [cookies, setCookie, removeCookie] = useCookies([\"vrct\"]);\r\n  const dispatch = useDispatch();\r\n  const avatar = history.location.state ? history.location.state.user_avatar : '';\r\n  const name = history.location.state ? history.location.state.user_name : '';\r\n  const code = history.location.state ? history.location.state.code : '';\r\n  const email = history.location.state ? history.location.state.user_email : '';\r\n  const idUser = history.location.state ? history.location.state.id_user : '';\r\n  const {register, handleSubmit, errors, setError} = useForm();\r\n  const [errorEmailAndPhone, setErrorEmailAndPhone] = useState('Vui lòng nhập mã gồm 6 số');\r\n  const now = new Date().getTime();\r\n\r\n  useEffect(() => {\r\n    if(code){\r\n      const timeExpiredCode = now + 300000;\r\n      setCookie(\"vrct\", timeExpiredCode, {\r\n        path: \"/\"\r\n      })\r\n    }\r\n  }, [code]);\r\n\r\n  const onSubmit = (data) => {\r\n    //load Spin\r\n    dispatch(toggleStatusSpin())\r\n\r\n    if(code === Number(data.code_change_pass)){\r\n      if(cookies.vrct - new Date().getTime() > 0){\r\n        removeCookie();\r\n        history.push('/change-password',{idUser: idUser, user_email: email})\r\n      }else {\r\n        setError(\"code_change_pass\", {\r\n              type: \"manual\",\r\n              message: \"Mã xác nhận đã hết hạn\"\r\n            });\r\n        setErrorEmailAndPhone('Mã xác nhận đã hết hạn')\r\n      }\r\n    }else {\r\n      setError(\"code_change_pass\", {\r\n            type: \"manual\",\r\n            message: \"Mã xác nhận không khớp với mã chúng tôi đã gửi\"\r\n          });\r\n      setErrorEmailAndPhone('Mã xác nhận không khớp với mã chúng tôi đã gửi')\r\n    }\r\n\r\n    //close Spin\r\n    dispatch(toggleStatusSpin())\r\n  }\r\n\r\n  const validateInputCode = (value) => {\r\n    if(!value) return false\r\n    if(!Number(value)) return false\r\n\r\n    return true\r\n  }\r\n\r\n  return(\r\n    <React.Fragment>\r\n      <div className=\"veri-code-container\">\r\n        <form onSubmit={handleSubmit(onSubmit)}>\r\n          <h2 style={{marginBottom: '20px'}}>Xác nhận đổi mật khẩu</h2>\r\n          <div className=\"preview-info-user\">\r\n            <div className=\"preview-info-user-avatar\">\r\n                {avatar.toLowerCase().indexOf('https://') !== -1 ?\r\n                  <img src={avatar} alt={name} />\r\n                  :\r\n                  <Image cloudName=\"mohi-vn\" publicId={avatar+ \".jpg\"} version=\"1607061343\">\r\n                    <Transformation />\r\n                  </Image>\r\n                }\r\n            </div>\r\n            <div className=\"preview-info-user-name\">{name}</div>\r\n          </div>\r\n          <div className=\"veri-code-message\">\r\n            <span style={{color: 'black'}}>Chúng tôi đã gửi mã xác nhận đến </span>{email}\r\n            <span style={{color: 'black'}}>. Mã này sẽ tồn tại trong vòng 5 phút. Vui lòng kiểm tra và hoàn tất quá trình đổi mật khẩu.</span>\r\n          </div>\r\n          <div className=\"submit-error-veri-code\"></div>\r\n          <div className=\"form-veri-code-group\">\r\n            <input\r\n              type=\"text\"\r\n              name=\"code_change_pass\"\r\n              placeholder=\"Nhập mã gồm 6 số\"\r\n              ref={register({\r\n                  validate: value => validateInputCode(value)\r\n                })}\r\n              style={errors.code_change_pass ? {border: '1px solid red'} : null}\r\n            />\r\n          {errors.code_change_pass && <Tooltip placement=\"right\" title={<p className = \"error_sex_tooltip\" >{errorEmailAndPhone}</p>}><RiErrorWarningLine className=\"error_sex error_code\"/></Tooltip>}\r\n          </div>\r\n          <div className=\"form-veri-code-group\">\r\n            <button type=\"submit\">Xác nhận</button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </React.Fragment>\r\n  )\r\n}\r\n\r\nexport default VeriChangePass;\r\n"]},"metadata":{},"sourceType":"module"}